/** LightPivotTable
 ** A lightweight pivot table for MDX2JSON source for InterSystems Cache
 ** @author ZitRo
 ** @version 1.8.0
 ** @license Apache 2.0
 ** @see https://github.com/ZitRos/LightPivotTable
 **/
LightPivotTable=function(){var DataController=function(e,t){if(t&&"function"!=typeof t)throw new Error("dataChangeTrigger parameter must be a function");this._dataStack=[],this.controller=e,this.pushData(),this.dataChangeTrigger=t,this.SUMMARY_SHOWN=!1};DataController.prototype.isValidData=function(e){return e.dimensions instanceof Array&&e.dimensions[0]instanceof Array&&!e.dimensions[0].length&&(e.dimensions[0]=[{}]),e.dimensions instanceof Array&&e.dimensions[0]instanceof Array&&e.dataArray instanceof Array&&"object"==typeof e.info&&e.info.cubeName},DataController.prototype.pushData=function(){var e;this._dataStack.push(e={data:null,SUMMARY_SHOWN:this.SUMMARY_SHOWN,SORT_STATE:{column:null,order:-1}}),this.SORT_STATE=e.SORT_STATE},DataController.prototype.popData=function(){if(!(this._dataStack.length<2)){var e=this._dataStack[this._dataStack.length-2];this._dataStack.pop(),this.SUMMARY_SHOWN=e.SUMMARY_SHOWN,this.SORT_STATE=e.SORT_STATE}},DataController.prototype.getData=function(){return this._dataStack[this._dataStack.length-1].data||{}},DataController.prototype.setData=function(e){return this.isValidData(e)?(this._dataStack[this._dataStack.length-1].data=e,this.setLeftHeaderColumnsNumber(e),this.pivotDataProcess(e),this.resetDimensionProps(),this.resetConditionalFormatting(),this.resetRawData(),this.modifyRawData(e),this.postDataProcessing(e),"drillthrough"===e.info.mdxType&&this.setDrillThroughHandler(this.controller.pivotView.listingClickHandler.bind(this.controller.pivotView)),this._trigger(),e):void console.error("Invalid data to set.",e)},DataController.prototype.pivotDataProcess=function(e){var t=this.controller.getPivotProperty(["rowTotals"]);"boolean"==typeof t&&(this.controller.CONFIG.showSummary=t)},DataController.prototype.setDrillThroughHandler=function(e){this._dataStack[this._dataStack.length-1].data.info.drillThroughHandler=e},DataController.prototype.resetDimensionProps=function(){var e,t,r;if(!(e=this._dataStack[this._dataStack.length-1].data))return void console.error("Unable to get dimension props for given data set.");t=[],r=[];var o=function(e){var t,r={};for(t in e)r[t]=e[t];return r},n=function(e,t,r){var a,i,l;if(t.children&&t.children.length>0)for(l in t.children)i=o(r),a=t.children[l],a.format&&(i.format=a.format),a.style&&(i.style=(i.style||"")+a.style),a.summary&&(i.summary=a.summary),a.total&&(i.summary=(a.total||"").toLowerCase().replace(/:.*/,"")),a.type&&(i.type=a.type),n(e,a,i);else e.push(o(r))};n(t,{children:e.dimensions[0]},{}),n(r,{children:e.dimensions[1]},{}),e.columnProps=t,e.rowProps=r},DataController.prototype.getTypeByValue=function(e){return isNaN(e)?(e+"").match(/[0-9]{2}\.[0-9]{2}\.[0-9]{2,4}/)?{type:"date",comparator:function(e){var t=e.split(".");return new Date(t[2],t[1],t[0])}}:Date.parse(e)?{type:"date",comparator:function(e){return new Date(e)}}:{type:"string"}:{type:"number"}},DataController.prototype.postDataProcessing=function(e){var t,r;if(e&&e.rawData&&e.rawData[e.info.topHeaderRowsNumber])for(e.columnProps||(e.columnProps=[]),r=e.info.leftHeaderColumnsNumber;t=e.rawData[e.info.topHeaderRowsNumber][r];r++)e.columnProps[r]||(e.columnProps[r]={}),e.columnProps[r].$FORMAT=this.getTypeByValue(t.value)},DataController.prototype.resetConditionalFormatting=function(){var e,t,r,o,n,a,i,l,s={};if(!(e=this._dataStack[this._dataStack.length-1].data))return void console.error("Unable to get conditional formatting for given data set.");if(!this.controller.CONFIG.pivotProperties)return void(e.conditionalFormatting=s);(t=this.controller.CONFIG.pivotProperties.colorScale)&&(t.indexOf("custom:")>-1?(n=t.split(":")[1].split(","),o={r:parseInt(n[0]),g:parseInt(n[1]),b:parseInt(n[2])},n=t.split(":")[2].split(","),r={r:parseInt(n[0]),g:parseInt(n[1]),b:parseInt(n[2])}):(n=t.split("-to-"),r=this.controller.pivotView.colorNameToRGB(n[0]),o=this.controller.pivotView.colorNameToRGB(n[1])),s.colorScale={from:o,to:r,min:a=Math.min.apply(Math,e.dataArray||[]),max:i=Math.max.apply(Math,e.dataArray||[]),diff:i-a,invert:(o.r+o.b+o.g)/3<128}),l=this.controller.CONFIG.pivotProperties.formatRules||[],l.length&&"undefined"==typeof this.controller.CONFIG.conditionalFormattingOn&&(this.controller.CONFIG.conditionalFormattingOn=!0);for(var c in l)s[l[c].range]||(s[l[c].range]=[]),s[l[c].range].push(l[c]);e.conditionalFormatting=s},DataController.prototype.TOTAL_FUNCTIONS={isNumber:function(e){return""!=e&&isFinite(e)},totalSUM:function(e,t,r,o,n,a){for(var i=0,l=t;l<r;l++){var s="undefined"==typeof a?l:a,c="undefined"==typeof o?l:o;this.isNumber(e[s][c].value)&&(i+=parseFloat(e[s][c].value)||0)}return i},totalAVG:function(e,t,r,o,n,a){for(var i=0,l=t;l<r;l++){var s="undefined"==typeof a?l:a,c="undefined"==typeof o?l:o;if(!this.isNumber(e[s][c].value)){i=0;break}i+=parseFloat(e[s][c].value)||0}return i/(r-t)||""},totalCOUNT:function(e,t,r,o,n,a){for(var i=0,l=t;l<r;l++){var s="undefined"==typeof a?l:a,c="undefined"==typeof o?l:o;e[s][c].value&&i++}return i},totalMIN:function(e,t,r,o,n,a){for(var i=1/0,l=t;l<r;l++){var s="undefined"==typeof a?l:a,c="undefined"==typeof o?l:o;this.isNumber(e[s][c].value)&&e[s][c].value<i&&(i=e[s][c].value)}return i},totalMAX:function(e,t,r,o,n,a){for(var i=-(1/0),l=t;l<r;l++){var s="undefined"==typeof a?l:a,c="undefined"==typeof o?l:o;this.isNumber(e[s][c].value)&&e[s][c].value>i&&(i=e[s][c].value)}return i},totalPERCENTAGE:function(e,t,r,o,n,a){var i,l,s=[];for(i=n;i<typeof o==="undefined"?e.length:e[0].length;i++)s.push(this.totalSUM(e,t,r,"undefined"==typeof o?o:i,n,"undefined"==typeof a?a:i));return l=s.reduce(function(e,t){return e+t}),(s[("undefined"==typeof a?o:a)-n]/l*100||0).toFixed(2)+"%"},totalNONE:function(){return""}},DataController.prototype.setLeftHeaderColumnsNumber=function(e){function t(e,r){if(!(e.children instanceof Array))return r;for(var o=r+1,n=0;n<e.children.length;n++)r=Math.max(t(e.children[n],o),r);return r}e.info.leftHeaderColumnsNumber=t({children:e.dimensions[1]||[]},0)},DataController.prototype.resetRawData=function(){var e,t,r,o,n,a="font-weight: bold;text-align: right;",i=this;if(!(e=this._dataStack[this._dataStack.length-1].data))return console.error("Unable to create raw data for given data set."),null;var l=[],s=[],c=2,u=[],h=function(e){return Object.keys(e[0]).map(function(t){return e.map(function(e){return e[t]})})},p=function(e,t,r){m(l,t,r,!0);var o,n=0;for(o in l)l[o].length>n&&(n=l[o].length);for(o in l)for(var a=l[o].length;a<n;a++)l[o].push(l[o][l[o].length-1]);l=h(l)},d=function(e,t){i.controller.CONFIG.pivotProperties&&(i.controller.CONFIG.pivotProperties.columnHeaderStyle&&t?e.style=i.controller.CONFIG.pivotProperties.columnHeaderStyle:i.controller.CONFIG.pivotProperties.rowHeaderStyle&&!t&&(e.style=i.controller.CONFIG.pivotProperties.rowHeaderStyle))},f=function(e){var t=0;for(var r in e)e[r].children&&e[r].children.length&&(t=Math.max(t,f(e[r].children)));return t+1},m=function(e,t,r,o,n,a){var i,l,s;r||(r=[]);for(var u in t)i=c,!(n<a)||t[u].children&&t[u].children.length||(t[u].children=[{}],s=!0),t[u].children&&t[u].children.length?(s?s=!1:c++,l={group:i,source:t[u],isCaption:!0,value:t[u].caption||""},d(l,o),m(e,t[u].children,r.concat(l),o,n?++n:n,a)):(l={group:c,source:t[u],isCaption:!0,value:t[u].caption||""},d(l,o),e.push(r.concat(l)),c++)},g=function(e){if(!i.controller.CONFIG.pivotProperties)return e;var t,r,o,n=e[0].length,a=i.controller.getPivotProperty(["columnLevels"]),l=i.controller.getPivotProperty(["rowLevels"]),s={},c={},u=function(e,t){if("undefined"!=typeof t)for(var r in t.childLevels)t.childLevels[r]&&t.childLevels[r].spec&&(e[(t.childLevels[r].spec||"").replace(/[^.]*$/,"")]={style:t.childLevels[r].levelStyle||"",headStyle:t.childLevels[r].levelHeaderStyle||""}),u(t.childLevels[r])};for(o in a)u(s,{childLevels:[a[o]]}),u(c,{childLevels:[l[o]]});for(r=0;r<e.length;r++)for(t=0;t<n;t++){if(!e[r][t].isCaption){n=t;break}if(e[r][t].source&&e[r][t].source.path)for(o in s)if(e[r][t].source.path.indexOf(o)>=0){var h;for(h=r;h<e.length;h++)e[h][t].isCaption?s[o].headStyle&&(e[h][t].style=(e[h][t].style||"")+s[o].headStyle||""):s[o].style&&(e[h][t].style=(e[h][t].style||"")+s[o].style||"");break}}return e};e.dimensions[0].length&&p(l,e.dimensions[0]),e.dimensions[1].length&&m(s,e.dimensions[1],void 0,void 0,1,f(e.dimensions[1])),s[0]&&(n=(s[0][s[0].length-1]||{source:{}}).source.dimension);var v=(l[0]||[]).length,C=s.length||e.info.rowCount||0,y=l.length||e.info.colCount||0,N=(s[0]||[]).length,S=!!this.controller.CONFIG.attachTotals;for(r=0;r<y+C;r++)for(u[r]||(u[r]=[]),o=0;o<N+v;o++)o<N?r<y?(u[r][o]={group:1,isCaption:!0,value:this.controller.getPivotProperty(["showRowCaption"])===!1?"":this.controller.CONFIG.caption||n||(e.info||{}).cubeName||""},d(u[r][o],!1)):u[r][o]=s[r-y][o]:r<y?u[r][o]=l[r][o-N]:u[r][o]={value:e.dataArray[v*(r-y)+o-N]};for(e.info.topHeaderRowsNumber=y,e.info.SUMMARY_SHOWN=!1,e.info.leftHeaderColumnsNumber=N,this.SUMMARY_SHOWN=!1,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!1,b=0;b<e.info.leftHeaderColumnsNumber;b++)e.columnProps.unshift({});for(b=0;b<e.info.topHeaderRowsNumber;b++)e.rowProps.unshift({});var w=function(t,r){var o=i.controller.getPivotProperty(["rowTotalAgg"])||"sum",n=i.controller.getPivotProperty(["columnTotalAgg"])||"sum",a=r?"rowProps":"columnProps";if(!e[a][t]&&!(r?n:o))return i.TOTAL_FUNCTIONS.totalSUM;switch((e[a][t]||{}).summary||o){case"count":return i.TOTAL_FUNCTIONS.totalCOUNT;case"avg":return i.TOTAL_FUNCTIONS.totalAVG;case"min":return i.TOTAL_FUNCTIONS.totalMIN;case"max":return i.TOTAL_FUNCTIONS.totalMAX;case"pct":return i.TOTAL_FUNCTIONS.totalPERCENTAGE;case"none":return i.TOTAL_FUNCTIONS.totalNONE;default:return i.TOTAL_FUNCTIONS.totalSUM}};if(this.controller.CONFIG.showSummary&&u.length-e.info.topHeaderRowsNumber>1&&(u[u.length-1][0]||{}).isCaption){e.info.SUMMARY_SHOWN=!0,this.SUMMARY_SHOWN=!0,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!0,t=[],o=u.length-2;for(var b in u[o])u[o][b].isCaption?(t[b]={group:c,isCaption:!0,source:{},noDrillDown:!0,value:pivotLocale.get(0)},d(t[b],!1)):t[b]={value:w(parseInt(b)).call(this.TOTAL_FUNCTIONS,u,y,u.length,b,e.info.leftHeaderColumnsNumber),style:a};c++,S?(u.splice(e.info.topHeaderRowsNumber,0,t),e.info.topHeaderRowsNumber++):u.push(t)}if(this.controller.getPivotProperty(["columnTotals"])&&u.length-e.info.topHeaderRowsNumber>1&&e.info.leftHeaderColumnsNumber>0){var O,E=++c;for(O=0;O<e.info.topHeaderRowsNumber;O++)u[O].push({group:E,isCaption:!0,value:pivotLocale.get(0)});for(O=e.info.topHeaderRowsNumber;O<u.length;O++)u[O].push({isCaption:!0,value:w(O,!0).call(this.TOTAL_FUNCTIONS,u,e.info.leftHeaderColumnsNumber,u[O].length,void 0,e.info.leftHeaderColumnsNumber,O),style:a})}return u=g(u),e.rawData=e._rawDataOrigin=u,e.rawData},DataController.prototype._trigger=function(){this.dataChangeTrigger&&this.dataChangeTrigger()},DataController.prototype.sortByColumn=function(e){var t,r=this._dataStack[this._dataStack.length-1].data,o=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0;this.SORT_STATE.column!==e&&(i=this.SORT_STATE.order=0);var n=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!o?1:0)),a=r.info.leftHeaderColumnsNumber+e,i=this.SORT_STATE.order===-1?1:1===this.SORT_STATE.order?0:-1;this.SORT_STATE.order=i,this.SORT_STATE.column=e;for(var l in r.rawData[r.info.topHeaderRowsNumber-o-1])r.rawData[r.info.topHeaderRowsNumber-o-1][l].className&&delete r.rawData[r.info.topHeaderRowsNumber-o-1][l].className;return 0===i?(r.rawData=r._rawDataOrigin,this.modifyRawData(r),void this._trigger()):(i=-i,"function"==typeof(t=((r.columnProps[e]||{}).$FORMAT||{}).comparator)?n.sort(function(e,r){return t(r[a].value)>t(e[a].value)?i:t(r[a].value)<t(e[a].value)?-i:0}):n.sort(function(e,t){return t[a].value>e[a].value?i:t[a].value<e[a].value?-i:0}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(n).concat(this.SUMMARY_SHOWN&&!o?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),r.rawData[r.info.topHeaderRowsNumber-o-1][r.info.leftHeaderColumnsNumber+e].className=0===i?"":1===i?"lpt-sortDesc":"lpt-sortAsc",this.modifyRawData(r),void this._trigger())},DataController.prototype.filterByValue=function(e,t){var r=this._dataStack[this._dataStack.length-1].data,o=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,n=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!o?1:0)),a=null;try{a=new RegExp(e,"i")}catch(i){try{a=new RegExp(e.replace(/([()[{*+.$^\\|?])/g,"\\$1"),"i")}catch(i){return}}n=n.filter(function(e){return(e[t].value||"").toString().match(a)}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(n).concat(this.SUMMARY_SHOWN&&!o?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),this.modifyRawData(r),this._trigger()},DataController.prototype.modifyRawData=function(e){var t=-1;this.controller.CONFIG.showRowNumbers&&!e.info.leftHeaderColumnsNumber&&(e.rawData[0]&&e.rawData[0][0].special?e.rawData.forEach(function(e){e[0].value=0===++t?"#":t,e[0].isCaption=0===t}):(e.rawData.forEach(function(e){e.unshift({value:0===++t?"#":t,isCaption:0===t,special:!0,noClick:!0})}),e.columnProps instanceof Array&&e.columnProps.unshift({}),e.info.colCount++));var r=e.info.topHeaderRowsNumber-1;for(t=e.info.leftHeaderColumnsNumber;t<e.rawData[r].length;t++)e.rawData[r][t].style="min-width:"+(this.controller.CONFIG.pivotProperties.cellWidth||100)+"px;"+(e.rawData[r][t].style?e.rawData[r][t].style:"")};var DataSource=function(e,t,r,o){this.SOURCE_URL=e.MDX2JSONSource||location.host+":"+location.port+"/"+(location.pathname.split("/")||[])[1],this.NAMESPACE=e.namespace,this.USERNAME=e.username,this.PASSWORD=e.password,this.LPT=r,this.GLOBAL_CONFIG=t,this.SEND_COOKIES=e.sendCookies||!1,this.DRILL_LEVEL="number"!=typeof o?1:o,this.BASIC_MDX=e.basicMDX,this.DATA_SOURCE_PIVOT=e.pivot||"",this.FILTERS=[]};DataSource.prototype._post=function(url,data,callback){var xhr=new XMLHttpRequest,self=this;xhr.open("POST",url),this.SEND_COOKIES&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){var handler;4===xhr.readyState&&(handler=self.LPT.CONFIG.triggers.responseHandler,"function"==typeof handler&&handler.call(self.LPT,{url:url,status:xhr.status})),4===xhr.readyState&&200===xhr.status?callback(function(){try{return JSON.parse(xhr.responseText)||{}}catch(e){try{var temp=null;return eval("temp="+xhr.responseText),temp}catch(e){return{error:"<h1>Unable to parse server response</h1><p>"+xhr.responseText+"</p>"}}}}()):4===xhr.readyState&&200!==xhr.status&&callback({error:xhr.responseText||pivotLocale.get(3)+"<br/>"+xhr.status+": "+xhr.statusText})},this.USERNAME&&this.PASSWORD&&xhr.setRequestHeader("Authorization","Basic "+btoa(this.USERNAME+":"+this.PASSWORD)),xhr.send(JSON.stringify(data))},DataSource.prototype._convert=function(e){var t;if("object"!=typeof e||e.error)return{error:e.error||!0};try{return t={dimensions:[e.Cols[0].tuples,e.Cols[1].tuples],dataArray:e.Data,info:e.Info}}catch(r){return console.error("Error while parsing data:",r),{error:e.error||!0}}},DataSource.prototype.setFilter=function(e){this.FILTERS.push(e)},DataSource.prototype.clearFilters=function(){this.FILTERS=[]},DataSource.prototype.getCurrentData=function(e){for(var t=this,r=this._convert,o=this.BASIC_MDX,n=new MDXParser,a=n.mdxType(o),i={state:0,data:{},pivotData:{}},l=0;l<this.FILTERS.length;l++)o=n.applyFilter(o,this.FILTERS[l]);"number"==typeof this.GLOBAL_CONFIG.rowCount&&(o=n.applyRowCount(o,this.GLOBAL_CONFIG.rowCount));var s=function(){var e=i.pivotData;t.GLOBAL_CONFIG.pivotProperties=i.pivotData,e.rowAxisOptions&&(e.rowAxisOptions.drilldownSpec&&(t.GLOBAL_CONFIG.DrillDownExpression=t.GLOBAL_CONFIG.DrillDownExpression||e.rowAxisOptions.drilldownSpec.split("^")),(e.rowAxisOptions.levelFormat||e.columnAxisOptions&&e.columnAxisOptions.levelFormat)&&(t.GLOBAL_CONFIG.formatNumbers=t.GLOBAL_CONFIG.formatNumbers||e.columnAxisOptions.levelFormat||e.rowAxisOptions.levelFormat))},c=function(){var n=i.data;if("drillthrough"===a)e(function(e){var t,o,n,i=e.children||[],l=[];if(!i.length)return{error:pivotLocale.get(4)};for(o in i[0])l.push({caption:o});t={Cols:[{tuples:l},{tuples:[]}],Data:[],Info:{colCount:8,cubeClass:"No cube class",cubeName:"No cube name",leftHeaderColumnsNumber:0,rowCount:i.length,topHeaderRowsNumber:l.length,mdxType:a}};for(o in i)for(n in i[o])t.Data.push(i[o][n]);return r(t)}(n));else if("mdx"===a){if(!(n&&n.Data&&n.Cols&&(n.Data.length||((n.Cols[0]||{}).tuples||[]).length||((n.Cols[1]||{}).tuples||[]).length)))return e({error:pivotLocale.get(4)});e(t._convert(n))}else e({error:"Unrecognised MDX type: "+o||!0})},u=function(){t.LPT.CONFIG.logs&&console.log("LPT MDX request:",o);var e=function(e){t.LPT.pivotView.removeMessage(),i.data=e,i.state++,c()};return 0===t.DRILL_LEVEL&&t.LPT.CONFIG.initialData?void e(t.LPT.CONFIG.initialData):void t._post(t.SOURCE_URL+"/"+("drillthrough"===a?"MDXDrillthrough":"MDX")+(t.NAMESPACE?"?Namespace="+t.NAMESPACE:""),{MDX:o},e)};t.LPT.pivotView.displayLoading(),this.DATA_SOURCE_PIVOT?this._post(this.SOURCE_URL+"/DataSource"+(t.NAMESPACE?"?Namespace="+t.NAMESPACE:""),{DataSource:this.DATA_SOURCE_PIVOT},function(e){i.pivotData=e,i.state++,s(),u()}):(t.GLOBAL_CONFIG.pivotProperties={},u())};var ExcelExport=function(){};ExcelExport.prototype.exportTableHTML=function(){var e="data:application/vnd.ms-excel;base64,",t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',r=function(e){return window.btoa(unescape(encodeURIComponent(e)))},o=function(e,t){return e.replace(/{(\w+)}/g,function(e,r){return t[r]})};return function(n,a){var i={worksheet:a||"Worksheet",table:n};console.log(e+r(o(t,i))),window.location.href=e+r(o(t,i))}}(),ExcelExport.prototype.exportXLS=function(){var e=document.getElementsByClassName("lpt")[0],t=e.getElementsByClassName("lpt-tableBlock")[0].getElementsByTagName("table")[0].innerHTML,r=e.getElementsByClassName("lpt-topHeader")[0].getElementsByTagName("table")[0].innerHTML.replace(/<tr>/,"<tr><th colspan='2'></th>"),o=e.getElementsByClassName("lpt-leftHeader")[0].getElementsByTagName("thead")[0].innerHTML,n=o.match("<tr>(.*)</tr>")[1].split("</tr><tr>"),a=0;t=t.replace(/<tr>/g,function(){return"<tr>"+n[a++]}),console.log(r+t),this.exportTableHTML(r+t,"test")};var LightPivotTable=function(e){var t=this;"object"!=typeof e&&(e={}),this.normalizeConfiguration(e),this._dataSourcesStack=[],this.DRILL_LEVEL=-1,this.CONFIG=e,this.VERSION="".concat("1.8.0")||"[NotBuilt]",this.CONTROLS={},this.mdxParser=new MDXParser,this.pivotView=new PivotView(this,e.container),this.dataSource=this.pushDataSource(e.dataSource),this.dataController=new DataController(this,function(){t.dataIsChanged.call(t)}),this.init()};LightPivotTable.prototype.refresh=function(){var e,t=this;if(!this.dataSource.BASIC_MDX)return void console.log("Unable to refresh: no basic MDX set.");if(this.clearFilters(),this.CONFIG.defaultFilterSpecs instanceof Array)for(e in this.CONFIG.defaultFilterSpecs)this.setFilter(this.CONFIG.defaultFilterSpecs[e]);this.dataSource.getCurrentData(function(e){t.dataController.isValidData(e)?t.dataController.setData(e):t.pivotView.displayMessage(e.error||pivotLocale.get(2))})},LightPivotTable.prototype.changeBasicMDX=function(e){for(var t=this._dataSourcesStack.length-1;t>0;t--)this.popDataSource(),this.pivotView.popTable(),this.dataController.popData();this.CONFIG.dataSource.basicMDX=e,this.dataSource.BASIC_MDX=e,this.refresh()},LightPivotTable.prototype.setRowCount=function(e){this.CONFIG.rowCount=e},LightPivotTable.prototype.getActualMDX=function(){var e=this.dataSource.BASIC_MDX,t=new MDXParser,r=this.dataSource.FILTERS;for(var o in r)e=t.applyFilter(e,r[o]);return"number"==typeof this.CONFIG.rowCount&&(e=t.applyRowCount(e,this.CONFIG.rowCount)),e},LightPivotTable.prototype.isListing=function(){return 0===(this.dataController.getData().info||{}).leftHeaderColumnsNumber},LightPivotTable.prototype.getSelectedRows=function(){var e,t=[],r=this.pivotView.selectedRows;for(e in r)r[e]&&t.push(+e);return t},LightPivotTable.prototype.getRowsValues=function(e){if("undefined"==typeof e)return[];if(e instanceof Array||(e=[e]),0===e.length)return[];for(var t=this.dataController.getData(),r=[],o=0;o<e.length;o++)r.push(t.rawData[e[o]-1+(t.info.topHeaderRowsNumber||1)]);return r},LightPivotTable.prototype.getModel=function(){return this.dataController.getData()},LightPivotTable.prototype.updateSizes=function(){this.pivotView.updateSizes()},LightPivotTable.prototype.setFilter=function(e){this.dataSource.setFilter(e)},LightPivotTable.prototype.clearFilters=function(){this.dataSource.clearFilters()},LightPivotTable.prototype.pushDataSource=function(e){var t;return this.DRILL_LEVEL++,this._dataSourcesStack.push(t=new DataSource(e||{},this.CONFIG,this,this.DRILL_LEVEL)),this.dataSource=t,t},LightPivotTable.prototype.popDataSource=function(e){this._dataSourcesStack.length<2||(this.DRILL_LEVEL--,this._dataSourcesStack.pop(),e||this.dataController.popData(),this.dataSource=this._dataSourcesStack[this._dataSourcesStack.length-1])},LightPivotTable.prototype.dataIsChanged=function(){this.pivotView.dataChanged(this.dataController.getData())},LightPivotTable.prototype.tryDrillDown=function(e){var t,r=this,o={};for(var n in r.CONFIG.dataSource)o[n]=r.CONFIG.dataSource[n];!this.CONFIG.DrillDownExpression||this.CONFIG.DrillDownExpression instanceof Array||(this.CONFIG.DrillDownExpression=[this.CONFIG.DrillDownExpression]),(this.CONFIG.DrillDownExpression||[])[this.DRILL_LEVEL]?o.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,e,this.CONFIG.DrillDownExpression[this.DRILL_LEVEL])||this.dataSource.BASIC_MDX:o.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,e)||this.dataSource.BASIC_MDX,t=this.dataSource,this.pushDataSource(o),this.dataSource.FILTERS=t.FILTERS,this.dataSource.getCurrentData(function(e){r.dataController.isValidData(e)&&e.dataArray.length>0&&e.dimensions[1]&&e.dimensions[1][0]&&(e.dimensions[1][0].caption||e.dimensions[1][0].dimension||e.dimensions[1][0].path)?(r.pivotView.pushTable(),r.dataController.pushData(),r.dataController.setData(e),"function"==typeof r.CONFIG.triggers.drillDown&&r.CONFIG.triggers.drillDown.call(r,{level:r.DRILL_LEVEL,mdx:o.basicMDX,path:e.dimensions[1][0].path||""})):r.popDataSource(!0)})},LightPivotTable.prototype.tryDrillThrough=function(e){var t,r=this,o={};for(var n in r.CONFIG.dataSource)o[n]=r.CONFIG.dataSource[n];o.basicMDX=this.mdxParser.drillThrough(this.dataSource.BASIC_MDX,e)||this.dataSource.basicMDX,t=this.dataSource,this.pushDataSource(o),this.dataSource.FILTERS=t.FILTERS,this.dataSource.getCurrentData(function(e){r.dataController.isValidData(e)&&e.dataArray.length>0?(r.pivotView.pushTable({disableConditionalFormatting:!0}),r.dataController.pushData(),r.dataController.setData(e),"function"==typeof r.CONFIG.triggers.drillThrough&&r.CONFIG.triggers.drillThrough.call(r,{level:r.DRILL_LEVEL,mdx:o.basicMDX})):r.popDataSource(!0)})},LightPivotTable.prototype.getPivotProperty=function(e){if(this.CONFIG.pivotProperties){e instanceof Array||(e=[]);var t=this.CONFIG.pivotProperties;for(e=e.reverse();e.length&&"undefined"!=typeof t;)t=t[e.pop()];return t}},LightPivotTable.prototype.attachTrigger=function(e,t){return"function"!=typeof t?void console.warn("LPT.addTrigger: pass the trigger as a second argument."):void(this.CONFIG.triggers[e]=t)},LightPivotTable.prototype.normalizeConfiguration=function(e){"undefined"==typeof e.columnResizing&&(e.columnResizing=!0),"undefined"==typeof e.pagination&&(e.pagination=200),"undefined"==typeof e.enableSearch&&(e.enableSearch=!0),"undefined"==typeof e.stretchColumns&&(e.stretchColumns=!0),"undefined"==typeof e.enableListingSelect&&(e.enableListingSelect=!0),"undefined"==typeof e.showListingRowsNumber&&(e.showListingRowsNumber=!0),e.triggers||(e.triggers={}),e.dataSource||(e.dataSource={})},LightPivotTable.prototype.init=function(){var e=this;this.CONTROLS.drillThrough=function(){e.pivotView._drillThroughClickHandler.call(e.pivotView)},this.CONTROLS.customDrillThrough=function(t){return t instanceof Array?void e.tryDrillThrough.call(e,t):void console.error('Parameter "filters" must be array of strings.')},this.CONTROLS.back=function(){e.pivotView._backClickHandler.call(e.pivotView)},this.CONFIG.locale&&pivotLocale.setLocale(this.CONFIG.locale),this.refresh()};var MDXParser=function(){};MDXParser.prototype._warnMDX=function(e,t){console.warn("MDX is not parsed:\n\n%s\n\n"+(t?"("+t+")":""),e)},MDXParser.prototype.makeSetExpressionFromFilter=function(e){return e.match(/^\([^\),]*,[^\)]*\)$/)?"NONEMPTYCROSSJOIN"+e.slice(0,e.length-1)+".children)":e+".children";
},MDXParser.prototype.prependNonEmpty=function(e){return e.match(/^\s*non\s+empty/i)?e:"NON EMPTY "+e},MDXParser.prototype.applyRowCount=function(e,t){return e.replace(/\s*on\s*0\s*,\s*(?:non\s*empty\s*)?(.*)\s*on\s*1/i,function(e,r){return"undefined"!=typeof t?" ON 0, NON EMPTY HEAD("+r+", "+t+") ON 1":e})},MDXParser.prototype.drillDown=function(e,t,r){if(!t)return/]\s+ON\s+1/i.test(e)?e=e.replace(/]\s+ON\s+1/i,"].children ON 1"):(this._warnMDX(e,"no filter specified"),"");var o=e.split(/(select\s*)(.*?)(\s*from)/gi);if(o.length<4)return this._warnMDX(e),"";var n=o[o.length-3],a=n.split(/(\s*ON\s*[01]\s*,?\s*)/);if(a.length<2)return this._warnMDX(e),"";var i=-1;if(a.map(function(e,t){return e.match(/\s*ON\s*[01]\s*,?\s*/)&&(i=t-1),e}),i===-1)return this._warnMDX(e,"DrillDown is impossible"),"";a[i]=this.prependNonEmpty(r||this.makeSetExpressionFromFilter(t));for(var l in a)1===a[l].length&&a[l](parseInt(l),1);return o[o.length-3]=a.join(""),this.applyFilter(o.join(""),t)},MDXParser.prototype.drillThrough=function(e,t){var r=e.split(/(FROM\s*\[[^\]]*].*)/i)[1],o="DRILLTHROUGH SELECT "+r;for(var n in t)o=this.applyFilter(o,t[n]);return o},MDXParser.prototype.mdxType=function(e){var t=e.toLowerCase(),r=t.indexOf("drillthrough"),o=t.indexOf("select");return r>-1?"drillthrough":o>-1?"mdx":"unknown"},MDXParser.prototype.applyFilter=function(e,t){return e+(t?" %FILTER "+t:"")};var numeral=function(){function e(e){this._value=e}function t(e,t,r,o){var n,a,i=Math.pow(10,t);return a=(r(e*i)/i).toFixed(t),o&&(n=new RegExp("0{1,"+o+"}$"),a=a.replace(n,"")),a}function r(e,t,r){var o;return o=t.indexOf("$")>-1?n(e,t,r):t.indexOf("%")>-1?a(e,t,r):t.indexOf(":")>-1?i(e,t):s(e._value,t,r)}function o(e,t){var r,o,n,a,i,s=t,c=["KB","MB","GB","TB","PB","EB","ZB","YB"],u=!1;if(t.indexOf(":")>-1)e._value=l(t);else if(t===g)e._value=0;else{for("."!==f[m].delimiters.decimal&&(t=t.replace(/\./g,"").replace(f[m].delimiters.decimal,".")),r=new RegExp("[^a-zA-Z]"+f[m].abbreviations.thousand+"(?:\\)|(\\"+f[m].currency.symbol+")?(?:\\))?)?$"),o=new RegExp("[^a-zA-Z]"+f[m].abbreviations.million+"(?:\\)|(\\"+f[m].currency.symbol+")?(?:\\))?)?$"),n=new RegExp("[^a-zA-Z]"+f[m].abbreviations.billion+"(?:\\)|(\\"+f[m].currency.symbol+")?(?:\\))?)?$"),a=new RegExp("[^a-zA-Z]"+f[m].abbreviations.trillion+"(?:\\)|(\\"+f[m].currency.symbol+")?(?:\\))?)?$"),i=0;i<=c.length&&!(u=t.indexOf(c[i])>-1&&Math.pow(1024,i+1));i++);e._value=(u?u:1)*(s.match(r)?Math.pow(10,3):1)*(s.match(o)?Math.pow(10,6):1)*(s.match(n)?Math.pow(10,9):1)*(s.match(a)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,"")),e._value=u?Math.ceil(e._value):e._value}return e._value}function n(e,t,r){var o,n,a=t.indexOf("$"),i=t.indexOf("("),l=t.indexOf("-"),c="";return t.indexOf(" $")>-1?(c=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(c=" ",t=t.replace("$ ","")):t=t.replace("$",""),n=s(e._value,t,r),a<=1?n.indexOf("(")>-1||n.indexOf("-")>-1?(n=n.split(""),o=1,(a<i||a<l)&&(o=0),n.splice(o,0,f[m].currency.symbol+c),n=n.join("")):n=f[m].currency.symbol+c+n:n.indexOf(")")>-1?(n=n.split(""),n.splice(-1,0,c+f[m].currency.symbol),n=n.join("")):n=n+c+f[m].currency.symbol,n}function a(e,t,r){var o,n="",a=100*e._value;return t.indexOf(" %")>-1?(n=" ",t=t.replace(" %","")):t=t.replace("%",""),o=s(a,t,r),o.indexOf(")")>-1?(o=o.split(""),o.splice(-1,0,n+"%"),o=o.join("")):o=o+n+"%",o}function i(e){var t=Math.floor(e._value/60/60),r=Math.floor((e._value-60*t*60)/60),o=Math.round(e._value-60*t*60-60*r);return t+":"+(r<10?"0"+r:r)+":"+(o<10?"0"+o:o)}function l(e){var t=e.split(":"),r=0;return 3===t.length?(r+=60*Number(t[0])*60,r+=60*Number(t[1]),r+=Number(t[2])):2===t.length&&(r+=60*Number(t[0]),r+=Number(t[1])),Number(r)}function s(e,r,o){var n,a,i,l,s,c,u=!1,h=!1,p=!1,d="",v=!1,C=!1,w=!1,b=!1,O=!1,E="",D="",T=Math.abs(e),L=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],_="",I=!1;if(0===e&&null!==g)return g;if(r.indexOf("(")>-1?(u=!0,r=r.slice(1,-1)):r.indexOf("+")>-1&&(h=!0,r=r.replace(/\+/g,"")),r.indexOf("a")>-1&&(v=r.indexOf("aK")>=0,C=r.indexOf("aM")>=0,w=r.indexOf("aB")>=0,b=r.indexOf("aT")>=0,O=v||C||w||b,r.indexOf(" a")>-1?(d=" ",r=r.replace(" a","")):r=r.replace("a",""),T>=Math.pow(10,12)&&!O||b?(d+=f[m].abbreviations.trillion,e/=Math.pow(10,12)):T<Math.pow(10,12)&&T>=Math.pow(10,9)&&!O||w?(d+=f[m].abbreviations.billion,e/=Math.pow(10,9)):T<Math.pow(10,9)&&T>=Math.pow(10,6)&&!O||C?(d+=f[m].abbreviations.million,e/=Math.pow(10,6)):(T<Math.pow(10,6)&&T>=Math.pow(10,3)&&!O||v)&&(d+=f[m].abbreviations.thousand,e/=Math.pow(10,3))),r.indexOf("b")>-1)for(r.indexOf(" b")>-1?(E=" ",r=r.replace(" b","")):r=r.replace("b",""),i=0;i<=L.length;i++)if(n=Math.pow(1024,i),a=Math.pow(1024,i+1),e>=n&&e<a){E+=L[i],n>0&&(e/=n);break}return r.indexOf("o")>-1&&(r.indexOf(" o")>-1?(D=" ",r=r.replace(" o","")):r=r.replace("o",""),D+=f[m].ordinal(e)),r.indexOf("[.]")>-1&&(p=!0,r=r.replace("[.]",".")),l=e.toString().split(".")[0],s=r.split(".")[1],c=r.indexOf(","),s?(s.indexOf("[")>-1?(s=s.replace("]",""),s=s.split("["),_=t(e,s[0].length+s[1].length,o,s[1].length)):_=t(e,s.length,o),l=_.split(".")[0],_=_.split(".")[1].length?(N||f[m].delimiters.decimal)+_.split(".")[1]:"",p&&0===Number(_.slice(1))&&(_="")):l=t(e,null,o),l.indexOf("-")>-1&&(l=l.slice(1),I=!0),c>-1&&(l=l.toString().replace(S,"$1"+(y||f[m].delimiters.thousands))),0===r.indexOf(".")&&(l=""),(u&&I?"(":"")+(!u&&I?"-":"")+(!I&&h?"+":"")+l+_+(D?D:"")+(d?d:"")+(E?E:"")+(u&&I?")":"")}function c(e,t){f[e]=t}function u(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function h(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var r=u(e),o=u(t);return r>o?r:o},-(1/0))}var p,d="1.5.3",f={},m="en",g=null,v="0,0",C=3,y=",",N=".",S=new RegExp("(\\d)(?=(\\d{"+C+"})+(?!\\d))","g");p=function(t){return p.isNumeral(t)?t=t.value():0===t||"undefined"==typeof t?t=0:Number(t)||(t=p.fn.unformat(t)),new e(Number(t))},p.version=d,p.isNumeral=function(t){return t instanceof e},p.language=function(e,t){if(!e)return m;if(e&&!t){if(!f[e])throw new Error("Unknown language : "+e);m=e}return!t&&f[e]||c(e,t),p},p.languageData=function(e){if(!e)return f[m];if(!f[e])throw new Error("Unknown language : "+e);return f[e]},p.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"$"}}),p.zeroFormat=function(e){g="string"==typeof e?e:null},p.defaultFormat=function(e){v="string"==typeof e?e:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var r,o,n=this.length>>>0,a=!1;for(1<arguments.length&&(o=t,a=!0),r=0;n>r;++r)this.hasOwnProperty(r)&&(a?o=e(o,this[r],r,this):(o=this[r],a=!0));if(!a)throw new TypeError("Reduce of empty array with no initial value");return o}),p.setup=function(e,t,r){e!==N&&(N=e),t!==y&&(y=t),r!==C&&(C=r,S=new RegExp("(\\d)(?=(\\d{"+C+"})+(?!\\d))","g"))},p.fn=e.prototype={clone:function(){return p(this)},format:function(e,t){return r(this,e?e:v,void 0!==t?t:Math.round)},unformat:function(e){return"[object Number]"===Object.prototype.toString.call(e)?e:o(this,e?e:v)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function t(e,t,o,n){return e+r*t}var r=h.call(null,this._value,e);return this._value=[this._value,e].reduce(t,0)/r,this},subtract:function(e){function t(e,t,o,n){return e-r*t}var r=h.call(null,this._value,e);return this._value=[e].reduce(t,this._value*r)/r,this},multiply:function(e){function t(e,t,r,o){var n=h(e,t);return e*n*(t*n)/(n*n)}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t,r,o){var n=h(e,t);return e*n/(t*n)}return this._value=[this._value,e].reduce(t),this},difference:function(e){return Math.abs(p(this._value).subtract(e).value())}},this.numeral=p},PivotLocale=function(e){this.LOCALE="",this.DEFAULT_LOCALE="en",this.setLocale(e||(navigator.language||"").substr(0,2)||(navigator.browserLanguage||this.DEFAULT_LOCALE).substring(0,2))};PivotLocale.prototype.LOCALES=[{ru:"\u0412\u0441\u0435\u0433\u043e",en:"Total",de:"Summe",cs:"Celkem"},{ru:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435",en:"Unable to render data",de:"Daten k\xf6nnen nicht rendern",cs:"Nebylo mo\u017en\xe9 zobrazit data"},{ru:"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f.",en:"Invalid data to display.",de:"Nicht korrekt Informationen angezeigt werden soll.",cs:"Nevhodn\xe1 data k zobrazen\xed"},{ru:"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.",en:"Error while trying to retrieve data from server.",de:"Beim Abrufen der Daten vom Server ist ein Fehler aufgetreten.",cs:"Chyba p\u0159i pokusu o z\xedsk\xe1n\xed dat ze serveru"},{ru:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f.",en:"No data to display.",de:"Keine Daten zum anzeigen.",cs:"\u017d\xe1dn\xe1 data k zobrazen\xed"}],PivotLocale.prototype.setLocale=function(e){var t,r=[];if(e=e.toLowerCase(),this.LOCALES[0].hasOwnProperty(e))this.LOCALE=e;else{for(t in this.LOCALES[0])r.push(t);console.warn("LightPivot: locale "+e+" is not supported. Currently localized: "+r.join(", ")+"."),this.LOCALE="en"}},PivotLocale.prototype.get=function(e){return(this.LOCALES[e]||{})[this.LOCALE]||"{not localized: "+e+"}"};var pivotLocale=new PivotLocale,PivotView=function(e,t){if(!(t instanceof HTMLElement))throw new Error('Please, provide HTMLElement instance "container" into pivot table configuration.');this.tablesStack=[],this.selectedRows={},numeral.call(this),this.elements={container:t,base:document.createElement("div"),tableContainer:void 0,messageElement:void 0,searchSelect:void 0,searchInput:void 0},this.pagination=null,this.savedScroll={x:0,y:0},this.FIXED_COLUMN_SIZES=[],this.PAGINATION_BLOCK_HEIGHT=20,this.ANIMATION_TIMEOUT=500,this.SEARCH_ENABLED=!1,this.SEARCHBOX_LEFT_MARGIN=191,this.savedSearch={restore:!1,value:"",columnIndex:0},this.controller=e,this.SCROLLBAR_WIDTH=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var r=document.createElement("div");r.style.width="100%",e.appendChild(r);var o=r.offsetWidth;return e.parentNode.removeChild(e),t-o}(),this.init()};return PivotView.prototype.init=function(){var e=this,t=this.elements;t.base.className="lpt",t.base.setAttribute("LPTVersion",this.controller.VERSION),t.container.appendChild(t.base),this.pushTable(),this.displayLoading(),window.addEventListener("resize",function(){e.updateSizes.call(e)}),this._=function(){e.displayMessage('<a href="https://github.com/ZitRos/LightPivotTable">LIGHT PIVOT TABLE v'+e.controller.VERSION+'</a><br/>by <a href="https://plus.google.com/+NikitaSavchenko">Nikita Savchenko</a><br/>for dear users of products of <a href="http://www.intersystems.com/">InterSystems Corporation</a><br/>Hope you enjoy it!',!0)}},PivotView.prototype.getCellElement=function(e,t,r){var o,n,a,i,l=this.tablesStack[this.tablesStack.length-1].element,s=function(e,t,r){var o,n,a,i,l,s,c,u=[];for(c=0;c<e.rows.length;c++)for(o=e.rows[c],s=0;s<o.cells.length;s++){for(n=o.cells[s],a=s;u[c]&&u[c][a];++a);for(i=a;i<a+n.colSpan;++i)for(l=c;l<c+n.rowSpan;++l)u[l]||(u[l]=[]),u[l][i]=!0;if(a<=t&&t<a+n.colSpan&&c<=r&&r<c+n.rowSpan)return n}return null};if(r){if(o=l.getElementsByClassName("lpt-topHeader")[0],!o)return null;if(o=o.getElementsByTagName("table")[0],!o)return null;if(n=0,[].slice.call(o.rows).forEach(function(e){n+=e.rowSpan||1}),i=l.getElementsByClassName("lpt-leftHeader")[0],!o)return null;if(i=i.getElementsByTagName("table")[0],!o)return null;if(a=0,(this.getCurrentTableData().element||{})._listing||[].slice.call((i.rows[0]||{cells:[]}).cells).forEach(function(e){a+=e.colSpan||1}),e<a&&t<n)return l.getElementsByClassName("lpt-headerValue")[0]||null;if(e>=a&&t<n)return(s(o,e-a,t)||{childNodes:[null]}).childNodes[0];if(e<a&&t>=n)return(s(i,e,t-n)||{childNodes:[null]}).childNodes[0];e-=a,t-=n}return(o=l.getElementsByClassName("lpt-tableBlock")[0])?(o=o.getElementsByTagName("table")[0],o?((o.rows[t]||{cells:[]}).cells[e]||{childNodes:[null]}).childNodes[0]:null):null},PivotView.prototype.getTableSize=function(e){var t,r=0,o=0,n=this.tablesStack[this.tablesStack.length-1].element;return(t=n.getElementsByClassName("lpt-tableBlock")[0])&&(t=t.getElementsByTagName("table")[0])?([].slice.call(t.rows).forEach(function(e){o+=e.rowSpan||1}),[].slice.call((t.rows[0]||{cells:[]}).cells).forEach(function(e){r+=e.colSpan||1}),e?(t=n.getElementsByClassName("lpt-topHeader")[0])&&(t=t.getElementsByTagName("table")[0])?([].slice.call(t.rows).forEach(function(e){o+=e.rowSpan||1}),(t=n.getElementsByClassName("lpt-leftHeader")[0])&&(t=t.getElementsByTagName("table")[0])?((this.getCurrentTableData().element||{})._listing||[].slice.call((t.rows[0]||{cells:[]}).cells).forEach(function(e){r+=e.colSpan||1}),{width:r,height:o}):0):0:{width:r,height:o}):0},PivotView.prototype.displayLoading=function(){this.displayMessage(this.controller.CONFIG.loadingMessageHTML||'<div class="lpt-spinner"><div></div><div></div><div></div><div></div><div></div></div>')},PivotView.prototype.updateSizes=function(){for(var e in this.tablesStack)this.recalculateSizes(this.tablesStack[e].element)},PivotView.prototype._updateTablesPosition=function(e){for(var t=0;t<this.tablesStack.length;t++)this.tablesStack[t].element.style.left=100*(1+(e||0)+t-this.tablesStack.length)+"%"},PivotView.prototype.getCurrentTableData=function(){return this.tablesStack[this.tablesStack.length-1]},PivotView.prototype.pushTable=function(e){var t,r=this,o=document.createElement("div");o.className="tableContainer",this.tablesStack.length&&(this.tablesStack[this.tablesStack.length-1].FIXED_COLUMN_SIZES=this.FIXED_COLUMN_SIZES,this.tablesStack[this.tablesStack.length-1].savedSearch=this.savedSearch,this.tablesStack[this.tablesStack.length-1].selectedRows=this.selectedRows,this.savedSearch={restore:!1,value:"",columnIndex:0},o.style.left="100%"),this.tablesStack.push({element:o,opts:e||{},pagination:t={on:!1,rows:1/0,page:0,pages:0}}),this.FIXED_COLUMN_SIZES=[],this.selectedRows={},this.elements.base.appendChild(o),this.elements.tableContainer=o,this.pagination=t,setTimeout(function(){r._updateTablesPosition()},30)},PivotView.prototype.popTable=function(){var e;if(!(this.tablesStack.length<2)){this.FIXED_COLUMN_SIZES=[],this._updateTablesPosition(1);var t=this.tablesStack.pop();this.pagination=(e=this.tablesStack[this.tablesStack.length-1]).pagination,e.FIXED_COLUMN_SIZES&&(this.FIXED_COLUMN_SIZES=e.FIXED_COLUMN_SIZES),e.savedSearch&&(this.savedSearch=e.savedSearch),e.selectedRows&&(this.selectedRows=e.selectedRows),setTimeout(function(){t.element.parentNode.removeChild(t.element)},this.ANIMATION_TIMEOUT),this.elements.tableContainer=this.tablesStack[this.tablesStack.length-1].element}},PivotView.prototype.saveScrollPosition=function(){var e;this.elements.tableContainer&&(e=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(this.savedScroll.x=e[0].scrollLeft,this.savedScroll.y=e[0].scrollTop)},PivotView.prototype.restoreScrollPosition=function(){var e;this.elements.tableContainer&&(e=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(e[0].scrollLeft=this.savedScroll.x,e[0].scrollTop=this.savedScroll.y)},PivotView.prototype.dataChanged=function(e){var t=e.rawData.length-e.info.topHeaderRowsNumber;this.controller.CONFIG.pagination&&(this.pagination.on=!0),this.pagination.rows=this.controller.CONFIG.pagination||1/0,this.selectedRows={},this.pagination.page=0,this.pagination.pages=Math.ceil(t/this.pagination.rows),this.pagination.pages<2&&(this.pagination.on=!1),this.renderRawData(e)},PivotView.prototype._columnClickHandler=function(e){this.saveScrollPosition(),this.controller.dataController.sortByColumn(e),this.restoreScrollPosition()},PivotView.prototype._rowClickHandler=function(e,t){var r=!0;if("function"==typeof this.controller.CONFIG.triggers.rowClick){var o=this.controller.getRowsValues([e])[0].slice(this.controller.dataController.getData().info.leftHeaderColumnsNumber);r=this.controller.CONFIG.triggers.rowClick(e,o)}r!==!1&&this.controller.tryDrillDown(t.source.path)},PivotView.prototype._pageSwitcherHandler=function(e){this.pagination.page=e,this.saveScrollPosition(),this.renderRawData(this.controller.dataController.getData()),this.restoreScrollPosition()},PivotView.prototype._backClickHandler=function(e){e&&(e.cancelBubble=!0,e.stopPropagation()),this.removeMessage(),this.popTable(),this.controller.popDataSource(),"function"==typeof this.controller.CONFIG.triggers.back&&this.controller.CONFIG.triggers.back.call(this.controller,{level:this.controller.DRILL_LEVEL})},PivotView.prototype._drillThroughClickHandler=function(e){this.controller.tryDrillThrough(),e&&(e.cancelBubble=!0,e.stopPropagation())},PivotView.prototype._getSelectedText=function(){var e="";return"undefined"!=typeof window.getSelection?e=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(e=document.selection.createRange().text),e},PivotView.prototype._cellClickHandler=function(e,t,r,o,n){var a,i,l,s=this.controller.dataController.getData(),c=[],u=!0,h=this.controller.CONFIG.showSummary&&this.controller.CONFIG.attachTotals?1:0;if(!this._getSelectedText()&&("function"!=typeof this.controller.CONFIG.triggers.cellSelected||(l=this.controller.CONFIG.triggers.cellSelected.call(this.controller,{x:t-s.info.leftHeaderColumnsNumber,y:r-s.info.topHeaderRowsNumber,leftHeaderColumnsNumber:s.info.leftHeaderColumnsNumber,topHeaderRowsNumber:s.info.topHeaderRowsNumber}),l!==!1))){try{a=s.rawData[r][s.info.leftHeaderColumnsNumber-1].source.path,i=s.rawData[s.info.topHeaderRowsNumber-1-h][t].source.path}catch(p){this.controller.CONFIG.logs&&console.warn("Unable to get filters for cell (%d, %d)",t,r)}a&&c.push(a),i&&c.push(i),this.controller.CONFIG.drillDownTarget?window.location=location.origin+location.pathname+"?DASHBOARD="+encodeURIComponent(this.controller.CONFIG.drillDownTarget)+"&SETTINGS=FILTER:"+encodeURIComponent(c.join("~"))+";":("function"==typeof this.controller.CONFIG.triggers.cellDrillThrough&&(u=this.controller.CONFIG.triggers.cellDrillThrough({event:o,filters:c,cellData:e,x:t,y:r},s)),"function"==typeof n&&(u=!(!1===n({event:o,filters:c,cellData:e,x:t,y:r},s)||u===!1)),u!==!1&&this.controller.tryDrillThrough(c))}},PivotView.prototype.copyToClipboard=function(e){var t=document.createElement("input");document.body.appendChild(t),t.setAttribute("value",e),document.body.appendChild(t),t.select();var r=!1;try{r=document.execCommand("copy")}catch(o){console.log("Copy error: "+o)}return document.body.removeChild(t),r},PivotView.prototype.listingClickHandler=function(e,t){if(0!==t.info.leftHeaderColumnsNumber)return void console.warn("Listing handler called not for a listing!");var r=this.controller.CONFIG.triggerEvent||"click",o=this,n=function(e){return document.createElement(e)},a=n("div"),i=t.rawData[0].map(function(e){return e.value+(e.source&&e.source.title?"("+e.source.title+")":"")}),l=t.rawData[e.y].map(function(e){return e.value});a.className="lpt-hoverMessage",a.style.fontSize="12pt",a.style.opacity=0;for(var s,c,u,h,p,d=0;d<i.length;d++)s=n("div"),p=n("span"),c=n("div"),u=n("hr"),h=n("div"),h.className="lpt-icon-copy",h.title="Copy",h.style.marginRight="6px",p.className="lpt-messageHead",p.textContent=i[d],c.className="lpt-messageBody",s.style.marginBottom=".3em",""!==l[d]?c.textContent=l[d]:c.innerHTML="&nbsp;",s.appendChild(h),s.appendChild(p),a.appendChild(s),a.appendChild(c),a.appendChild(u),h.addEventListener(r,function(e){return function(t){o.copyToClipboard(e)===!1&&alert("Your browser does not support dynamic content copying."),t.preventDefault(),t.cancelBubble=!0,t.preventBubble=!0}}(l[d]));return this.elements.base.appendChild(a),setTimeout(function(){a&&(a.style.opacity=1)},1),a.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){o._getSelectedText()||o.removeMessage()}),!1},PivotView.prototype.displayMessage=function(e,t){this.removeMessage();var r=this,o=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div");o.className="central lpt-hoverMessage",o.style.opacity=0,a.innerHTML=e,n.appendChild(a),o.appendChild(n),this.elements.base.appendChild(o),setTimeout(function(){o&&(o.style.opacity=1)},1),t&&o.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){r.removeMessage()})},PivotView.prototype.removeMessage=function(){var e,t;if((e=this.elements.base.getElementsByClassName("lpt-hoverMessage")).length)for(t in e)e[t].parentNode&&e[t].parentNode.removeChild(e[t])},PivotView.prototype._matchCondition=function(e,t,r){var o=parseFloat(e);switch(t){case"=":return o==r;case"<>":return o!=r;case">":return o>r;case">=":return o>=r;case"<":return o<r;case"<=":return o<=r;case"IN":return r.toString().indexOf(o)!==-1;case"BETWEEN":return o>=r.split(",")[0]&&o<=r.split(",")[1];case"IS NULL":return!o;default:return console.error('Formatting error: unknown format operator "'+t+'"'),!1}},PivotView.prototype.applyConditionalFormatting=function(e,t,r,o){var n,a,i,l,s,c,u=e[""]||[];u=u.concat(e[t]||[]),2===(s=t.split(",")).length&&(u=u.concat(e[s[0]]||[],e[s[0]+","]||[],e[","+s[1]]||[]));for(n in u)if(i=u[n],this._matchCondition(r,i.operator,i.value)){if(i.style&&o.setAttribute("style",(o.getAttribute("style")||"")+i.style),i.icon){for(o.textContent="",l='<div style="overflow: hidden; height: 16px;">',c=parseInt(i.iconCount)||1,a=0;a<c;a++)l+='<img alt="*" style="padding-right:2px; height: 100%;" src="'+i.icon+'"/>';o.innerHTML=l+"</div>"}i.text&&(o.textContent=i.text)}},PivotView.prototype.colorNameToRGB=function(e){var t=function(e,t,r){return{r:e,g:t,b:r}};switch(e){case"red":return t(255,0,0);case"green":return t(0,255,0);case"blue":return t(0,0,255);case"purple":return t(102,0,153);case"salmon":return t(255,140,105);case"white":return t(255,255,255);case"black":return t(0,0,0);case"gray":return t(128,128,128);default:return t(255,255,255)}},PivotView.prototype.selectRow=function(e,t){if(e?this.selectedRows[t]=1:delete this.selectedRows[t],"function"==typeof this.controller.CONFIG.triggers.rowSelect){var r=this.controller.getSelectedRows();this.controller.CONFIG.triggers.rowSelect(r,this.controller.getRowsValues(r))}},PivotView.prototype.recalculateSizes=function(e){var t=e.parentNode,r=22;try{var o=this,n=this.controller.CONFIG.triggerEvent||"click",a=e.getElementsByClassName("lpt-headerValue")[0];if(!a)return;var i=e.getElementsByClassName("lpt-header")[0],l=e.getElementsByClassName("lpt-topHeader")[0],s=e.getElementsByTagName("table")[0],c=s.offsetWidth,u=l.getElementsByTagName("thead")[0],h=e.getElementsByClassName("lpt-leftHeader")[0],p=h.getElementsByTagName("thead")[0],d=e.getElementsByClassName("lpt-tableBlock")[0],f=d.getElementsByTagName("table")[0],m=d.getElementsByTagName("tbody")[0],g=e.getElementsByClassName("lpt-searchInput")[0],v=g?e.offsetWidth-this.SEARCHBOX_LEFT_MARGIN:0,C=d.getElementsByTagName("tr")[0],y=e.getElementsByClassName("lpt-pageSwitcher")[0];u.childNodes[0]&&u.childNodes[0].lastChild._extraCell&&u.childNodes[0].removeChild(u.childNodes[0].lastChild),p.lastChild&&p.lastChild._extraTr&&p.removeChild(p.lastChild);var N=(y?this.PAGINATION_BLOCK_HEIGHT:0)+(this.SEARCH_ENABLED?this.PAGINATION_BLOCK_HEIGHT:0),S=Math.max(h.offsetWidth,i.offsetWidth),w=l.offsetHeight;l.style.marginLeft=S+"px";var b=e.offsetHeight,O=b-w-N,E=i.offsetWidth,D=0===p.offsetHeight,T=Math.max(p.offsetHeight,m.offsetHeight)>O&&this.SCROLLBAR_WIDTH>0,L=u.offsetWidth>l.offsetWidth-(T?this.SCROLLBAR_WIDTH:0);!T&&L&&(T=Math.max(p.offsetHeight,m.offsetHeight)>O-this.SCROLLBAR_WIDTH&&this.SCROLLBAR_WIDTH>0);var _,I,x,R=T&&!D,M=[],F=[],A=[],P=!1,H=function(){(o.controller.CONFIG.stretchColumns||!T||L)&&(P=!0,I=document.createElement("th"),I.className="lpt-extraCell",I.style.minWidth=o.SCROLLBAR_WIDTH+"px",I.style.width=o.SCROLLBAR_WIDTH+"px",
I.rowSpan=u.childNodes.length,I._extraCell=!0,u.childNodes[0].appendChild(I))};if(T&&u.childNodes[0]&&H(),e._primaryColumns)for(x in e._primaryColumns)M.push(e._primaryColumns[x].offsetWidth);else console.warn("No _primaryColumns property in container, cell sizes won't be fixed.");if(e._primaryRows&&e._primaryCells){for(x in e._primaryRows)F.push(e._primaryRows[x].offsetHeight);for(x in e._primaryCells)A.push(e._primaryCells[x].offsetHeight)}else console.warn("No _primaryRows property in container, cell sizes won't be fixed.");var k=[].slice.call(h.getElementsByTagName("th")).map(function(e){return{el:e.getElementsByTagName("div")[0],height:e.getElementsByTagName("div")[0].offsetHeight}});if(e.parentNode.removeChild(e),l.style.marginLeft=S+"px",d.style.marginLeft=S+"px",h.style.height=b-w-N+"px",h.style.width=S+"px",E>S&&(h.style.width=E+"px"),d.style.height=b-w-N+"px",i.style.height=w+"px",i.style.width=S+"px",this.controller.CONFIG.stretchColumns||(s.style.width="auto",f.style.width=L?"100%":c+"px"),R&&(I=document.createElement("tr"),I.appendChild(_=document.createElement("th")),p.appendChild(I),_.__i=0,_.addEventListener(n,function(){_.__i++,_.style.background="#"+Math.max(18-3*_.__i,0).toString(16)+"FF7D7",_.__i>5&&o._()}),I._extraTr=!0,_.colSpan=p.childNodes.length,_.style.height=(this.SCROLLBAR_WIDTH?this.SCROLLBAR_WIDTH+1:0)+"px"),g&&(g.style.width=v+"px"),C)for(x in C.childNodes)"TD"===C.childNodes[x].tagName&&(C.childNodes[x].style.width=M[x]+"px");e._primaryRows.forEach(function(t,o){e._primaryCells[o].style.height=e._primaryRows[o].style.height=Math.max(F[o]||F[o-1]||r,A[o]||A[o-1]||r)+"px"}),k.forEach(function(e){e.el.style.height=parseInt(e.height)+"px"}),t.appendChild(e),Math.max(p.offsetHeight,m.offsetHeight)>O&&this.SCROLLBAR_WIDTH>0&&!P&&H()}catch(G){console.error("Error when fixing sizes.","ERROR:",G)}},PivotView.prototype.getUnixDateFromCacheFormat=function(e){function t(e,t){var r=new Date(e);return r.setDate(e.getDate()+t),r}function r(e){var t=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],r=Date.parse(e);if(!isNaN(r))return r;if(2==e.split("-").length){var o=e.split("-"),n=t.indexOf(o[0].toLowerCase());if(n!=-1)return Date.parse((n+1).toString()+"/01/"+o[1])}else if(2==e.split(" ").length){var a=e.split(" ")[1].split(":").length;if(0===a&&(e+=":00"),r=Date.parse(e.replace(/-/g,"/")),!isNaN(r))return r}return 0}if(""===e&&void 0===e||null===e)return null;var o=e.toString();if(4==o.length)return r(e);if(o.indexOf("-")!=-1)return r(e);if(o.indexOf(" ")!=-1)return r(e);if(6==o.length){var n=o.substr(0,4),a=o.substr(4,2);return Date.parse(new Date(parseInt(n),parseInt(a)-1,1))}if(5!=o.length||isNaN(parseInt(o)))return r(e);var i=new Date(1840,11,31),l=o.toString().split(","),s=parseInt(l[0]),c=null;return l.length>1&&(c=parseInt(l[1])),i=t(i,parseInt(s)),c&&i.setSeconds(c),Date.parse(i)},PivotView.prototype.renderRawData=function(e){if(!e.rawData||!e.rawData[0]||!e.rawData[0][0])return void this.displayMessage("<h1>"+pivotLocale.get(1)+"</h1><p>"+JSON.stringify(e)+"</p>");var t,r,o,n,a,i,l,s,c,u=this,h=e.rawData,p=e.info,d=e.columnProps,f=e.rowProps,m=e.conditionalFormatting?e.conditionalFormatting.colorScale:void 0,g=this.controller.CONFIG.triggerEvent||"click",v=p.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,C=!!this.controller.CONFIG.columnResizing,y=0===p.leftHeaderColumnsNumber,N=y&&this.controller.CONFIG.enableSearch,S=this.controller.CONFIG.enableListingSelect,w=!!this.controller.CONFIG.columnResizeAnimation,b=this.elements.tableContainer,O=document.createElement("div"),E=document.createElement("div"),D=document.createElement("div"),T=document.createElement("div"),L=document.createElement("div"),_=document.createElement("div"),I=document.createElement("div"),x=document.createElement("table"),R=document.createElement("thead"),M=document.createElement("table"),F=document.createElement("thead"),A=document.createElement("table"),P=document.createElement("tbody"),H=this.pagination.on||y&&this.controller.CONFIG.showListingRowsNumber,k=H?document.createElement("div"):null,G=H?[]:null,B=k?document.createElement("div"):null,V=N?document.createElement("div"):null,U=N?document.createElement("span"):null,W=N?document.createElement("select"):null,X=N?document.createElement("span"):null,z=N?document.createElement("input"):null,Y=N?function(){for(var e=[],t=p.leftHeaderColumnsNumber,r=p.topHeaderRowsNumber-1-v,o=t;o<h[r].length;o++)e.push({value:h[r][o].value,source:h[r][o].source,columnIndex:o});return e}():null,$={},Z=null,j=[],K=[],J=[];this.SEARCH_ENABLED=N,this.numeral.setup(p.decimalSeparator||".",p.numericGroupSeparator||",",p.numericGroupSize||3);var q=function(e,t,r){if("string"==typeof e)t.parentNode.className+=" formatLeft",t.innerHTML=(e||"").replace(/(https?|ftp):\/\/[^\s]+/gi,function(e){return"<a href='"+e+"' target='"+(u.controller.CONFIG.linksTarget||"_blank")+"' onclick='var e=event||window.event;e.stopPropagation();e.cancelBubble=true;'>"+e+"</a>"});else if(y)t.textContent=e;else if("%date%"===r){var o=new Date(u.getUnixDateFromCacheFormat(e));if(isNaN(o.getTime()))return void(t.textContent=e);t.textContent=o.getHours()+o.getMinutes()+o.getSeconds()===0?o.toLocaleDateString():o.toLocaleString()}else r?t.textContent=e?u.numeral(e).format(r):e:e?t.textContent=u.numeral(e).format(e%1===0?"#,###":"#,###.##"):t.textContent=e},Q=function(e,t){var r;e.createTextRange?(r=e.createTextRange(),r.move("character",t),r.select()):e.setSelectionRange(t,t)},ee=function(e,t){var r=0,o=0,n=function(t){t.cancelBubble=!0,t.preventDefault(),e.style.width=e.style.minWidth=r-o+t.pageX+"px",w&&(u.saveScrollPosition(),u.recalculateSizes(b),u.restoreScrollPosition())},a=function(i){i.cancelBubble=!0,i.preventDefault(),e.style.width=e.style.minWidth=(u.FIXED_COLUMN_SIZES[t]=r-o+i.pageX)+"px",u.saveScrollPosition(),u.recalculateSizes(b),u.restoreScrollPosition(),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a)};e.addEventListener("mousedown",function(t){(t.target||t.srcElement)===e&&(t.cancelBubble=!0,t.preventDefault(),r=e.offsetWidth,o=t.pageX,document.addEventListener("mousemove",n),document.addEventListener("mouseup",a))})};for(this.removeMessage();b.firstChild;)b.removeChild(b.firstChild);var te=function(e,t,n,a,i){function l(e){for(var t=e.checked;e=e.parentNode;)if("TR"===e.tagName){e.classList[t?"add":"remove"]("lpt-selectedRow"),u.elements.tableContainer.querySelector(".lpt-tableBlock table").rows[e.rowIndex].classList[t?"add":"remove"]("lpt-selectedRow");break}}var s,c,m,y,N,w,b=i===F;if(e===t&&S)for(o=n;o<a;o++)m=document.createElement("tr"),y=document.createElement("td"),w=document.createElement("input"),w.setAttribute("type","checkbox"),w.checked=!!u.selectedRows[o],w.checked&&function(e){setTimeout(function(){l(e)},1)}(w),y.setAttribute("style","padding: 0 !important;"),w.addEventListener("click",function(e){return function(t){var r=t.srcElement||t.target;t.preventDefault(),t.cancelBubble=!0,setTimeout(function(){r.checked=!r.checked,u.selectRow.call(u,r.checked,e),l(r)},1)}}(o)),y.appendChild(w),m.appendChild(y),K.push(y),i.appendChild(m);else for(o=n;o<a;o++){for(r=e;r<t;r++)c=!0,(s=$.hasOwnProperty(h[o][r].group))&&(r>0&&h[o][r-1].group===h[o][r].group&&(c=!1,$[h[o][r].group].element.colSpan=r-$[h[o][r].group].x+1),o>0&&h[o-1][r].group===h[o][r].group&&(c=!1,$[h[o][r].group].element.rowSpan=o-$[h[o][r].group].y+1),y=$[h[o][r].group].element),s&&!c||(m||(m=document.createElement("tr")),m.appendChild(y=document.createElement(h[o][r].isCaption?"th":"td")),h[o][r].source&&h[o][r].source.title&&y.setAttribute("title",h[o][r].source.title),N=document.createElement("div"),h[o][r].value?N.textContent=h[o][r].value:N.innerHTML="&nbsp;",y.appendChild(N),h[o][r].style&&y.setAttribute("style",h[o][r].style),0===p.leftHeaderColumnsNumber&&u.controller.CONFIG.listingColumnMinWidth&&(y.style.minWidth=u.controller.CONFIG.listingColumnMinWidth+"px"),p.leftHeaderColumnsNumber>0&&u.controller.CONFIG.maxHeaderWidth&&(y.style.maxWidth=u.controller.CONFIG.maxHeaderWidth+"px",y.style.whiteSpace="normal",y.style.wordWrap="normal"),h[o][r].className&&(y.className=h[o][r].className),h[o][r].group&&($[h[o][r].group]={x:r,y:o,element:y}),h[o][r].isCaption||q(h[o][r].value,y,f[o].format||d[r].format)),b&&r===t-1&&(K.push(y),y.addEventListener(g,function(e,t){return function(){u._rowClickHandler.call(u,e,t)}}(o,h[o][r]))),b||o!==a-1-v||y._hasSortingListener||(y._hasSortingListener=!1,h[o][r].noClick||y.addEventListener(g,function(e){return function(){u._columnClickHandler.call(u,e)}}(r-p.leftHeaderColumnsNumber)),y.className=(y.className||"")+" lpt-clickable"),b||o!==a-1||(u.FIXED_COLUMN_SIZES[r]&&(y.style.minWidth=y.style.width=u.FIXED_COLUMN_SIZES[r]+"px"),C&&(ee(y,r),y.className+=" lpt-resizableColumn"),j.push(y));m&&i.appendChild(m),m=null}};for(L.textContent=p.leftHeaderColumnsNumber?h[0][0].value:"",h[0][0].style&&L.setAttribute("style",h[0][0].style),this.tablesStack.length>1&&!this.controller.CONFIG.hideButtons&&(L.className+="back ",L.addEventListener(g,function(e){u._backClickHandler.call(u,e)})),p.leftHeaderColumnsNumber>0&&u.controller.CONFIG.maxHeaderWidth&&(D.style.maxWidth=u.controller.CONFIG.maxHeaderWidth*p.leftHeaderColumnsNumber+"px",D.style.whiteSpace="normal",D.style.wordWrap="normal"),(this.controller.CONFIG.hideButtons||this.tablesStack.length<2)&&0===p.leftHeaderColumnsNumber&&(L.style.display="none"),te(p.leftHeaderColumnsNumber,h[0].length,0,p.topHeaderRowsNumber,R),te(0,p.leftHeaderColumnsNumber,l=p.topHeaderRowsNumber+(this.pagination.page*this.pagination.rows||0),s=this.pagination.on?Math.min(l+this.pagination.rows,h.length):h.length,F),o=l;o<s;o++){for(Z=document.createElement("tr"),r=p.leftHeaderColumnsNumber;r<h[0].length;r++)i=this.controller.getPivotProperty(["cellStyle"])||"",Z.appendChild(n=document.createElement("td")),n.appendChild(c=document.createElement("div")),r===p.leftHeaderColumnsNumber&&J.push(n),q(h[o][r].value,c,f[o]&&f[o].format||d[r].format),!m||p.SUMMARY_SHOWN&&h.length-1===o||(a=(parseFloat(h[o][r].value)-m.min)/m.diff,i+="background:rgb("+ +Math.round((m.to.r-m.from.r)*a+m.from.r)+","+Math.round((m.to.g-m.from.g)*a+m.from.g)+","+Math.round((m.to.b-m.from.b)*a+m.from.b)+");"+(m.invert?"color: white;":"")),(d[r].style||f[o]&&f[o].style)&&(i+=(f[o]&&f[o].style||"")+(f[o]&&f[o].style?" ":"")+(d[r].style||"")),h[o][r].style&&(i+=h[o][r].style),!this.controller.CONFIG.conditionalFormattingOn||p.SUMMARY_SHOWN&&h.length-1===o||this.getCurrentTableData().opts.disableConditionalFormatting||this.applyConditionalFormatting(e.conditionalFormatting,o-p.topHeaderRowsNumber+1+","+(r-p.leftHeaderColumnsNumber+1),h[o][r].value,n),i&&n.setAttribute("style",(n.getAttribute("style")||"")+i),n.addEventListener(g,function(e,t,r){return function(o){u._cellClickHandler.call(u,r,e,t,o,p.drillThroughHandler)}}(r,o,h[o][r]));P.appendChild(Z)}if(I.addEventListener("scroll",function(){return I._ISE?void(I._ISE=!1):(T.scrollLeft=I.scrollLeft,_.scrollTop=I.scrollTop,T._ISE=!0,void(_._ISE=!0))}),_.className="lpt-leftHeader",T.className="lpt-topHeader",this.controller.CONFIG.enableHeadersScrolling&&(_.className=_.className+" lpt-scrollable-y",T.className=T.className+" lpt-scrollable-x",_.addEventListener("scroll",function(){return _._ISE?void(_._ISE=!1):(I.scrollTop=_.scrollTop,void(I._ISE=!0))}),T.addEventListener("scroll",function(){return T._ISE?void(T._ISE=!1):(I.scrollLeft=T.scrollLeft,void(I._ISE=!0))})),I.className="lpt-tableBlock",D.className="lpt-header",O.className="lpt-topSection",E.className="lpt-bottomSection",L.className+="lpt-headerValue",A.appendChild(P),I.appendChild(A),M.appendChild(F),_.appendChild(M),x.appendChild(R),T.appendChild(x),D.appendChild(L),O.appendChild(D),O.appendChild(T),E.appendChild(_),E.appendChild(I),b.appendChild(O),b.appendChild(E),this.controller.CONFIG.stretchColumns||(x.style.width="auto"),k){k.className="lpt-pageSwitcher",G=function(e,t){for(var r=0,o=[e];e>1;)e=Math.max(1,e-(r||1)),o.unshift(e),r=r*r+1;for(r=0,e=o[o.length-1];e<t;)e=Math.min(t,e+(r||1)),o.push(e),r=r*r+1;return o}(this.pagination.page+1,this.pagination.pages),this.controller.CONFIG.showListingRowsNumber&&(n=document.createElement("div"),Z=document.createElement("span"),Z.className="lpt-icon-rows",n.className="lpt-bottomInfo",n.appendChild(Z),Z=document.createElement("span"),Z.textContent=e.rawData.length-(e.info.topHeaderRowsNumber||0)-(e.info.SUMMARY_SHOWN?1:0),n.appendChild(Z),B.appendChild(n));for(t in G)t=parseInt(t),n=document.createElement("span"),G[t]===this.pagination.page+1&&(n.className="lpt-active"),n.textContent=G[t],function(e){n.addEventListener(g,function(){u._pageSwitcherHandler.call(u,e-1)})}(G[t]),B.appendChild(n),G[t+1]&&G[t]+1!==G[t+1]&&(n=document.createElement("span"),n.className="lpt-pageSpacer",B.appendChild(n));k.appendChild(B),b.appendChild(k)}if(N){U.className="lpt-searchIcon",X.className="lpt-searchSelectOuter",V.className="lpt-searchBlock",z.className="lpt-searchInput",W.className="lpt-searchSelect";for(t in Y)n=document.createElement("option"),n.setAttribute("value",Y[t].columnIndex.toString()),n.textContent=Y[t].value,W.appendChild(n);z.addEventListener("input",function(){var e=parseInt(W.options[W.selectedIndex].value),t=z.value;u.saveScrollPosition(),u.savedSearch.value=t,u.savedSearch.columnIndex=e,u.savedSearch.restore=!0,u.controller.dataController.filterByValue(t,e),u.restoreScrollPosition()}),V.appendChild(U),X.appendChild(W),V.appendChild(X),V.appendChild(z),b.insertBefore(V,O),this.elements.searchInput=z,this.elements.searchSelect=W,this.savedSearch.restore&&(this.elements.searchInput.value=this.savedSearch.value,this.elements.searchSelect.value=this.savedSearch.columnIndex)}else this.elements.searchInput=void 0,this.elements.searchSelect=void 0;b._primaryColumns=j,b._primaryRows=K,b._primaryCells=J,b._listing=y,this.recalculateSizes(b),this.savedSearch.restore&&(this.elements.searchInput.focus(),Q(this.elements.searchInput,this.savedSearch.value.length)),"function"==typeof this.controller.CONFIG.triggers.contentRendered&&this.controller.CONFIG.triggers.contentRendered(this.controller)},LightPivotTable}();