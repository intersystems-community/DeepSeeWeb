/** LightPivotTable
 ** A lightweight pivot table for MDX2JSON source for InterSystems Cache
 ** @author ZitRo
 ** @version 1.8.14
 ** @license Apache 2.0
 ** @see https://github.com/ZitRos/LightPivotTable
 **/LightPivotTable=function(){var DataController=function(t,r){if(r&&typeof r!="function")throw new Error("dataChangeTrigger parameter must be a function");this._dataStack=[],this.controller=t,this.pushData(),this.dataChangeTrigger=r,this.SUMMARY_SHOWN=!1};DataController.prototype.isValidData=function(t){return t.dimensions instanceof Array&&t.dimensions[0]instanceof Array&&!t.dimensions[0].length&&(t.dimensions[0]=[{}]),t.dimensions instanceof Array&&t.dimensions[0]instanceof Array&&t.dataArray instanceof Array&&typeof t.info=="object"&&t.info.cubeName},DataController.prototype.pushData=function(){var t;this._dataStack.push(t={data:null,SUMMARY_SHOWN:this.SUMMARY_SHOWN,SORT_STATE:{column:null,order:-1}}),this.SORT_STATE=t.SORT_STATE},DataController.prototype.popData=function(){if(!(this._dataStack.length<2)){var t=this._dataStack[this._dataStack.length-2];this._dataStack.pop(),this.SUMMARY_SHOWN=t.SUMMARY_SHOWN,this.SORT_STATE=t.SORT_STATE}},DataController.prototype.getData=function(){return this._dataStack[this._dataStack.length-1].data||{}},DataController.prototype.setData=function(t){if(!this.isValidData(t)){console.error("Invalid data to set.",t);return}return this._dataStack[this._dataStack.length-1].data=t,this.setLeftHeaderColumnsNumber(t),this.pivotDataProcess(t),this.resetDimensionProps(),this.resetConditionalFormatting(),this.resetRawData(),this.modifyRawData(t),this.postDataProcessing(t),t.info.mdxType==="drillthrough"&&this.setDrillThroughHandler(this.controller.pivotView.listingClickHandler.bind(this.controller.pivotView)),this._trigger(),t},DataController.prototype.pivotDataProcess=function(t){var r=this.controller.getPivotProperty(["rowTotals"]);typeof r=="boolean"&&(this.controller.CONFIG.showSummary=r)},DataController.prototype.setDrillThroughHandler=function(t){this._dataStack[this._dataStack.length-1].data.info.drillThroughHandler=t},DataController.prototype.resetDimensionProps=function(){var t,r,i;if(!(t=this._dataStack[this._dataStack.length-1].data)){console.error("Unable to get dimension props for given data set.");return}r=[],i=[];var n=function(o){var a,u={};for(a in o)u[a]=o[a];return u},l=function(o,a,u){var h,p,d;if(a.children&&a.children.length>0)for(d in a.children)p=n(u),h=a.children[d],h.format&&(p.format=h.format),h.style&&(p.style=(p.style||"")+h.style),h.summary&&(p.summary=h.summary),h.total&&(p.summary=(h.total||"").toLowerCase().replace(/:.*/,"")),h.type&&(p.type=h.type),l(o,h,p);else o.push(n(u))};l(r,{children:t.dimensions[0]},{}),l(i,{children:t.dimensions[1]},{}),t.columnProps=r,t.rowProps=i},DataController.prototype.getTypeByValue=function(t){return isNaN(t)?(t+"").match(/[0-9]{2}\.[0-9]{2}\.[0-9]{2,4}/)?{type:"date",comparator:function(r){var i=r.split(".");return new Date(i[2],i[1],i[0])}}:Date.parse(t)?{type:"date",comparator:function(r){return new Date(r)}}:{type:"string"}:{type:"number"}},DataController.prototype.postDataProcessing=function(t){var r,i;if(!(!t||!t.rawData||!t.rawData[t.info.topHeaderRowsNumber]))for(t.columnProps||(t.columnProps=[]),i=t.info.leftHeaderColumnsNumber;r=t.rawData[t.info.topHeaderRowsNumber][i];i++)t.columnProps[i]||(t.columnProps[i]={}),t.columnProps[i].$FORMAT=this.getTypeByValue(r.value)},DataController.prototype.resetConditionalFormatting=function(){var t,r,i,n,l,o,a,u={},h;if(!(t=this._dataStack[this._dataStack.length-1].data)){console.error("Unable to get conditional formatting for given data set.");return}if(!this.controller.CONFIG.pivotProperties){t.conditionalFormatting=u;return}(r=this.controller.CONFIG.pivotProperties.colorScale)&&(r.indexOf("custom:")>-1?(l=r.split(":")[1].split(","),n={r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])},l=r.split(":")[2].split(","),i={r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])}):(l=r.split("-to-"),i=this.controller.pivotView.colorNameToRGB(l[0]),n=this.controller.pivotView.colorNameToRGB(l[1])),u.colorScale={from:n,to:i,min:o=Math.min.apply(Math,t.dataArray||[]),max:a=Math.max.apply(Math,t.dataArray||[]),diff:a-o,invert:(n.r+n.b+n.g)/3<128}),h=this.controller.CONFIG.pivotProperties.formatRules||[],h.length&&typeof this.controller.CONFIG.conditionalFormattingOn>"u"&&(this.controller.CONFIG.conditionalFormattingOn=!0);for(var p in h)u[h[p].range]||(u[h[p].range]=[]),u[h[p].range].push(h[p]);t.conditionalFormatting=u},DataController.prototype.TOTAL_FUNCTIONS={isNumber:function(t){return t==""?!1:isFinite(t)},totalSUM:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;t[h]&&t[h][p]&&this.isNumber(t[h][p].value)&&(a+=parseFloat(t[h][p].value)||0)}return a},totalAVG:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;if(!this.isNumber(t[h][p].value)){a=0;break}a+=parseFloat(t[h][p].value)||0}return a/(i-r)||""},totalCOUNT:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;t[h][p].value&&a++}return a},totalMIN:function(t,r,i,n,l,o){for(var a=1/0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;this.isNumber(t[h][p].value)&&t[h][p].value<a&&(a=t[h][p].value)}return a},totalMAX:function(t,r,i,n,l,o){for(var a=-1/0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;this.isNumber(t[h][p].value)&&t[h][p].value>a&&(a=t[h][p].value)}return a},totalPERCENTAGE:function(t,r,i,n,l,o,a){if(a&&o===t.length-1)return"100%";var u=[],h,p,d=a?1:0;for(h=l;h<(typeof n>"u"?t.length-d:t[0].length);h++)u.push(this.totalSUM(t,r,i,typeof n>"u"?n:h,l,typeof o>"u"?o:h));return p=u.reduce(function(v,L){return v+L}),(u[(typeof o>"u"?n:o)-l]/p*100||0).toFixed(2)+"%"},totalNONE:function(){return""}},DataController.prototype.setLeftHeaderColumnsNumber=function(t){function r(i,n){if(!(i.children instanceof Array))return n;for(var l=n+1,o=0;o<i.children.length;o++)n=Math.max(r(i.children[o],l),n);return n}t.info.leftHeaderColumnsNumber=r({children:t.dimensions[1]||[]},0)},DataController.prototype.resetRawData=function(){var t="font-weight: bold;text-align: right;",r,i,n,l,o,a=this;if(!(r=this._dataStack[this._dataStack.length-1].data))return console.error("Unable to create raw data for given data set."),null;var u=[],h=[],p=2,d=[],v=a.controller.CONFIG.pivotProperties&&a.controller.CONFIG.pivotProperties.hideMeasures===2,L=function(y){return Object.keys(y[0]).map(function(N){return y.map(function(D){return D[N]})})},A=function(y,N,D){V(u,N,D,!0);var b,I=0;for(b in u)u[b].length>I&&(I=u[b].length);for(b in u)for(var G=u[b].length;G<I;G++)u[b].push(u[b][u[b].length-1]);u=L(u)},E=function(y,N){a.controller.CONFIG.pivotProperties&&(a.controller.CONFIG.pivotProperties.columnHeaderStyle&&N?y.style=a.controller.CONFIG.pivotProperties.columnHeaderStyle:a.controller.CONFIG.pivotProperties.rowHeaderStyle&&!N&&(y.style=a.controller.CONFIG.pivotProperties.rowHeaderStyle))},F=function(y,N){typeof N>"u"&&(N=0);function D(b,I){if(b.children){var G=0;for(var K in b.children)G=Math.max(G,D(b.children[K],I+1));return G}else return b.type==="msr"&&v?I-1:I}return y.reduce(function(b,I){return Math.max(b,D(I,1))},N)},V=function(y,N,D,b,I,G){var K,X,P;D||(D=[]);for(var f in N)K=p,I<G&&!(N[f].children&&N[f].children.length)&&(N[f].children=[{}],P=!0),N[f].children&&N[f].children.length?(P?P=!1:p++,X={group:K,source:N[f],isCaption:!0,value:N[f].caption||""},E(X,b),V(y,N[f].children,D.concat(X),b,I&&I+1,G)):(X={group:p,source:N[f],isCaption:!0,value:N[f].caption||""},E(X,b),y.push(N[f].type==="msr"&&v?D:D.concat(X)),p++)},$=function(y){if(!a.controller.CONFIG.pivotProperties)return y;var N,D,b,I=y[0].length,G=a.controller.getPivotProperty(["columnLevels"]),K=a.controller.getPivotProperty(["rowLevels"]),X={},P={},f=function(z,Q){if(!(typeof Q>"u"))for(var T in Q.childLevels)Q.childLevels[T]&&Q.childLevels[T].spec&&(z[(Q.childLevels[T].spec||"").replace(/[^.]*$/,"")]={style:Q.childLevels[T].levelStyle||"",headStyle:Q.childLevels[T].levelHeaderStyle||""}),f(Q.childLevels[T])};for(b in G)f(X,{childLevels:[G[b]]}),f(P,{childLevels:[K[b]]});for(D=0;D<y.length;D++)for(N=0;N<I;N++){if(!y[D][N].isCaption){I=N;break}if(y[D][N].source&&y[D][N].source.path){var m=r.info.topHeaderRowsNumber>D?X:P;for(b in m)if(y[D][N].source.path.indexOf(b)>=0){y[D][N].isCaption?m[b].headStyle&&(y[D][N].style=(y[D][N].style||"")+m[b].headStyle||""):m[b].style&&(y[D][N].style=(y[D][N].style||"")+m[b].style||"");break}}}return y};r.dimensions[0].length&&A(u,r.dimensions[0]),r.dimensions[1].length&&V(h,r.dimensions[1],void 0,void 0,1,F(r.dimensions[1])),h[0]&&(o=(h[0][h[0].length-1]||{source:{}}).source.dimension);var k=(u[0]||[]).length,W=h.length||r.info.rowCount||0,U=u.length||r.info.colCount||0,H=(h[0]||[]).length,c=!!this.controller.CONFIG.attachTotals;for(n=0;n<U+W;n++)for(d[n]||(d[n]=[]),l=0;l<H+k;l++)l<H?n<U?(d[n][l]={group:1,isCaption:!0,value:this.controller.getPivotProperty(["showRowCaption"])===!1?"":this.controller.CONFIG.caption||o||(r.info||{}).cubeName||""},E(d[n][l],!1)):d[n][l]=h[n-U][l]:n<U?d[n][l]=u[n][l-H]:d[n][l]={value:r.dataArray[k*(n-U)+l-H]};for(r.info.topHeaderRowsNumber=U,r.info.SUMMARY_SHOWN=!1,r.info.leftHeaderColumnsNumber=H,this.SUMMARY_SHOWN=!1,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!1,g=0;g<r.info.leftHeaderColumnsNumber;g++)r.columnProps.unshift({});for(g=0;g<r.info.topHeaderRowsNumber;g++)r.rowProps.unshift({});var s=function(y,N){var D=a.controller.getPivotProperty(["rowTotalAgg"])||"sum",b=a.controller.getPivotProperty(["columnTotalAgg"])||"sum",I=N?"rowProps":"columnProps";if(!r[I][y]&&!(N?b:D))return a.TOTAL_FUNCTIONS.totalSUM;switch((r[I][y]||{}).summary||(N?b:D)){case"count":return a.TOTAL_FUNCTIONS.totalSUM;case"avg":return a.TOTAL_FUNCTIONS.totalAVG;case"min":return a.TOTAL_FUNCTIONS.totalMIN;case"max":return a.TOTAL_FUNCTIONS.totalMAX;case"pct":return a.TOTAL_FUNCTIONS.totalPERCENTAGE;case"none":return a.TOTAL_FUNCTIONS.totalNONE;default:return a.TOTAL_FUNCTIONS.totalSUM}};if(this.controller.CONFIG.showSummary&&d.length-r.info.topHeaderRowsNumber>1&&(d[d.length-1][0]||{}).isCaption){r.info.SUMMARY_SHOWN=!0,this.SUMMARY_SHOWN=!0,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!0,i=[],l=d.length-2;for(var g in d[l])d[l][g].isCaption?(i[g]={group:p,isCaption:!0,source:{},noDrillDown:!0,value:pivotLocale.get(0)},E(i[g],!1)):i[g]={value:s(parseInt(g)).call(this.TOTAL_FUNCTIONS,d,U,d.length,g,r.info.leftHeaderColumnsNumber),style:t};p++,c?(d.splice(r.info.topHeaderRowsNumber,0,i),r.info.topHeaderRowsNumber++):d.push(i)}if(this.controller.getPivotProperty(["columnTotals"])&&d.length-r.info.topHeaderRowsNumber>1&&r.info.leftHeaderColumnsNumber>0){var C=++p,S;for(S=0;S<r.info.topHeaderRowsNumber;S++){var x=s(S,!0),O=x===a.TOTAL_FUNCTIONS.totalPERCENTAGE?pivotLocale.get(5):pivotLocale.get(0);d[S].push({group:C,isCaption:!0,value:O})}for(S=r.info.topHeaderRowsNumber;S<d.length;S++){var Z=this.controller.getPivotProperty(["rowTotals"]),w=this.controller.getPivotProperty(["columnTotals"]);d[S].push({isCaption:!0,value:s(S,!0).call(this.TOTAL_FUNCTIONS,d,r.info.leftHeaderColumnsNumber,d[S].length,void 0,r.info.leftHeaderColumnsNumber,S,Z&&w),style:t})}}return d=$(d),r.rawData=r._rawDataOrigin=d,r.rawData},DataController.prototype._trigger=function(){this.dataChangeTrigger&&this.dataChangeTrigger()},DataController.prototype.sortByColumn=function(t){var r=this._dataStack[this._dataStack.length-1].data,i=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,n;this.SORT_STATE.column!==t&&(a=this.SORT_STATE.order=0);var l=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!i?1:0)),o=r.info.leftHeaderColumnsNumber+t,a=this.SORT_STATE.order===-1?1:this.SORT_STATE.order===1?0:-1;this.SORT_STATE.order=a,this.SORT_STATE.column=t;for(var u in r.rawData[r.info.topHeaderRowsNumber-i-1])r.rawData[r.info.topHeaderRowsNumber-i-1][u].className&&delete r.rawData[r.info.topHeaderRowsNumber-i-1][u].className;if(a===0){r.rawData=r._rawDataOrigin,this.modifyRawData(r),this._trigger();return}a=-a,typeof(n=((r.columnProps[t]||{}).$FORMAT||{}).comparator)=="function"?l.sort(function(h,p){return n(p[o].value)>n(h[o].value)?a:n(p[o].value)<n(h[o].value)?-a:0}):l.sort(function(h,p){return p[o].value>h[o].value?a:p[o].value<h[o].value?-a:0}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(l).concat(this.SUMMARY_SHOWN&&!i?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),r.rawData[r.info.topHeaderRowsNumber-i-1][r.info.leftHeaderColumnsNumber+t].className=a===0?"":a===1?"lpt-sortDesc":"lpt-sortAsc",this.modifyRawData(r),this._trigger()},DataController.prototype.filterByValue=function(t,r){var i=this._dataStack[this._dataStack.length-1].data,n=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,l=i._rawDataOrigin.slice(i.info.topHeaderRowsNumber,i._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!n?1:0)),o=null;try{o=new RegExp(t,"i")}catch{try{o=new RegExp(t.replace(/([()[{*+.$^\\|?])/g,"\\$1"),"i")}catch{return}}l=l.filter(function(a){return(a[r].value||"").toString().match(o)}),i.rawData=i._rawDataOrigin.slice(0,i.info.topHeaderRowsNumber).concat(l).concat(this.SUMMARY_SHOWN&&!n?[i._rawDataOrigin[i._rawDataOrigin.length-1]]:[]),this.modifyRawData(i),this._trigger()},DataController.prototype.modifyRawData=function(t){var r=-1;this.controller.CONFIG.showRowNumbers&&!t.info.leftHeaderColumnsNumber&&(t.rawData[0]&&t.rawData[0][0].special?t.rawData.forEach(function(n){n[0].value=++r===0?"#":r,n[0].isCaption=r===0}):(t.rawData.forEach(function(n){n.unshift({value:++r===0?"#":r,isCaption:r===0,special:!0,noClick:!0})}),t.columnProps instanceof Array&&t.columnProps.unshift({}),t.info.colCount++));var i=t.info.topHeaderRowsNumber-1;for(r=t.info.leftHeaderColumnsNumber;r<t.rawData[i].length;r++)t.rawData[i][r].style="min-width:"+(this.controller.getPivotProperty(["cellWidth"])||100)+"px;"+(t.rawData[i][r].style?t.rawData[i][r].style:"")};var DataSource=function(t,r,i,n){this.SOURCE_URL=t.MDX2JSONSource||location.host+":"+location.port+"/"+(location.pathname.split("/")||[])[1],this.NAMESPACE=t.namespace,this.USERNAME=t.username,this.PASSWORD=t.password,this.LPT=i,this.GLOBAL_CONFIG=r,this.SEND_COOKIES=t.sendCookies||!1,this.DRILL_LEVEL=typeof n!="number"?1:n,this.BASIC_MDX=t.basicMDX,this.DATA_SOURCE_PIVOT=t.pivot||"",this.FILTERS=[]};DataSource.prototype._post=function(url,data,callback){var xhr=new XMLHttpRequest,self=this;xhr.open("POST",url),this.SEND_COOKIES&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){var handler;xhr.readyState===4&&(handler=self.LPT.CONFIG.triggers.responseHandler,typeof handler=="function"&&handler.call(self.LPT,{url,status:xhr.status,xhr})),xhr.readyState===4&&xhr.status===200?callback(function(){try{return JSON.parse(xhr.responseText)||{}}catch(e){try{var temp=null;return eval("temp="+xhr.responseText),temp}catch(t){return{error:"<h1>Unable to parse server response</h1><p>"+xhr.responseText+"</p>"}}}}()):xhr.readyState===4&&xhr.status!==200&&callback({error:xhr.responseText||pivotLocale.get(3)+"<br/>"+xhr.status+": "+xhr.statusText})},this.USERNAME&&this.PASSWORD&&xhr.setRequestHeader("Authorization","Basic "+btoa(this.USERNAME+":"+this.PASSWORD)),xhr.send(JSON.stringify(data))},DataSource.prototype._convert=function(t){var r;if(typeof t!="object"||t.error)return{error:t.error||!0};try{return r={dimensions:[t.Cols[0].tuples,t.Cols[1]?t.Cols[1].tuples:[{caption:""}]],dataArray:t.Data,info:t.Info},r}catch(i){return console.error("Error while parsing data:",i),{error:t.error||!0}}},DataSource.prototype.setFilter=function(t){this.FILTERS.push(t)},DataSource.prototype.clearFilters=function(){this.FILTERS=[]},DataSource.prototype.getCurrentData=function(t){for(var r=this,i=this._convert,n=this.BASIC_MDX,l=new MDXParser,o=l.mdxType(n),a={state:0,data:{},pivotData:{}},u=0;u<this.FILTERS.length;u++)n=l.applyFilter(n,this.FILTERS[u]);typeof this.GLOBAL_CONFIG.rowCount=="number"&&(n=l.applyRowCount(n,this.GLOBAL_CONFIG.rowCount));var h=function(){var v=a.pivotData;r.GLOBAL_CONFIG.pivotProperties=a.pivotData,v.rowAxisOptions&&(v.rowAxisOptions.drilldownSpec&&(r.GLOBAL_CONFIG.DrillDownExpression=r.GLOBAL_CONFIG.DrillDownExpression||v.rowAxisOptions.drilldownSpec.split("^")),(v.rowAxisOptions.levelFormat||v.columnAxisOptions&&v.columnAxisOptions.levelFormat)&&(r.GLOBAL_CONFIG.formatNumbers=r.GLOBAL_CONFIG.formatNumbers||v.columnAxisOptions.levelFormat||v.rowAxisOptions.levelFormat))},p=function(){var v=a.data;if(o==="drillthrough")t(function(L){var A=L.children||[],E=[],F,V,$;if(!A.length)return{error:pivotLocale.get(4)};for(V in A[0])E.push({caption:V});F={Cols:[{tuples:E},{tuples:[]}],Data:[],Info:{colCount:8,cubeClass:"No cube class",cubeName:"No cube name",leftHeaderColumnsNumber:0,rowCount:A.length,topHeaderRowsNumber:E.length,mdxType:o}};for(V in A)for($ in A[V])F.Data.push(A[V][$]);return i(F)}(v));else if(o==="mdx"){if(!v||!v.Data||!v.Data.length||!v.Cols||!v.Data.length&&!((v.Cols[0]||{}).tuples||[]).length&&!((v.Cols[1]||{}).tuples||[]).length)return t({error:pivotLocale.get(4)});t(r._convert(v))}else t({error:"Unrecognised MDX type: "+n||!0})},d=function(){r.LPT.CONFIG.logs&&console.log("LPT MDX request:",n);var v=function(L){r.LPT.pivotView.removeMessage(),a.data=L,a.state++,p()};if(r.DRILL_LEVEL===0&&r.LPT.CONFIG.initialData){v(r.LPT.CONFIG.initialData);return}r._post(r.SOURCE_URL+"/"+(o==="drillthrough"?"MDXDrillthrough":"MDX")+(r.NAMESPACE?"?Namespace="+r.NAMESPACE:""),{MDX:n},v)};r.LPT.pivotView.displayLoading(),this.DATA_SOURCE_PIVOT?this._post(this.SOURCE_URL+"/DataSource"+(r.NAMESPACE?"?Namespace="+r.NAMESPACE:""),{DataSource:this.DATA_SOURCE_PIVOT},function(v){a.pivotData=v,a.state++,h(),d()}):(r.GLOBAL_CONFIG.pivotProperties={},d())};var ExcelExport=function(){};ExcelExport.prototype.exportTableHTML=function(){var t="data:application/vnd.ms-excel;base64,",r='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',i=function(l){return window.btoa(unescape(encodeURIComponent(l)))},n=function(l,o){return l.replace(/{(\w+)}/g,function(a,u){return o[u]})};return function(l,o){var a={worksheet:o||"Worksheet",table:l};console.log(t+i(n(r,a))),window.location.href=t+i(n(r,a))}}(),ExcelExport.prototype.exportXLS=function(){var t=document.getElementsByClassName("lpt")[0],r=t.getElementsByClassName("lpt-tableBlock")[0].getElementsByTagName("table")[0].innerHTML,i=t.getElementsByClassName("lpt-topHeader")[0].getElementsByTagName("table")[0].innerHTML.replace(/<tr>/,"<tr><th colspan='2'></th>"),n=t.getElementsByClassName("lpt-leftHeader")[0].getElementsByTagName("thead")[0].innerHTML,l=n.match("<tr>(.*)</tr>")[1].split("</tr><tr>"),o=0;r=r.replace(/<tr>/g,function(){return"<tr>"+l[o++]}),console.log(i+r),this.exportTableHTML(i+r,"test")};var LightPivotTable=function(t){var r=this;typeof t!="object"&&(t={}),this.normalizeConfiguration(t),this._dataSourcesStack=[],this.DRILL_LEVEL=-1,this.CONFIG=t,this.VERSION="".concat("1.8.14")||"[NotBuilt]",this.CONTROLS={},this.mdxParser=new MDXParser,this.pivotView=new PivotView(this,t.container),this.dataSource=this.pushDataSource(t.dataSource),this.dataController=new DataController(this,function(){r.dataIsChanged.call(r)}),this.init()};LightPivotTable.prototype.refresh=function(){var t=this,r;if(!this.dataSource.BASIC_MDX){console.log("Unable to refresh: no basic MDX set.");return}if(this.clearFilters(),this.CONFIG.defaultFilterSpecs instanceof Array)for(r in this.CONFIG.defaultFilterSpecs)this.setFilter(this.CONFIG.defaultFilterSpecs[r]);this.dataSource.getCurrentData(function(i){t.dataController.isValidData(i)?t.dataController.setData(i):t.pivotView.displayMessage(i.error||pivotLocale.get(2))})},LightPivotTable.prototype.changeBasicMDX=function(t){for(var r=this._dataSourcesStack.length-1;r>0;r--)this.popDataSource(),this.pivotView.popTable(),this.dataController.popData();this.CONFIG.dataSource.basicMDX=t,this.dataSource.BASIC_MDX=t,this.refresh()},LightPivotTable.prototype.setRowCount=function(t){this.CONFIG.rowCount=t},LightPivotTable.prototype.getActualMDX=function(){var t=this.dataSource.BASIC_MDX,r=new MDXParser,i=this.dataSource.FILTERS;for(var n in i)t=r.applyFilter(t,i[n]);return typeof this.CONFIG.rowCount=="number"&&(t=r.applyRowCount(t,this.CONFIG.rowCount)),t},LightPivotTable.prototype.isListing=function(){return(this.dataController.getData().info||{}).leftHeaderColumnsNumber===0},LightPivotTable.prototype.getSelectedRows=function(){var t=[],r=this.pivotView.selectedRows,i;for(i in r)r[i]&&t.push(+i);return t},LightPivotTable.prototype.getRowsValues=function(t){if(typeof t>"u")return[];if(t instanceof Array||(t=[t]),t.length===0)return[];for(var r=this.dataController.getData(),i=[],n=0;n<t.length;n++)i.push(r.rawData[t[n]-1+(r.info.topHeaderRowsNumber||1)]);return i},LightPivotTable.prototype.getModel=function(){return this.dataController.getData()},LightPivotTable.prototype.updateSizes=function(){this.pivotView.updateSizes()},LightPivotTable.prototype.setFilter=function(t){this.dataSource.setFilter(t)},LightPivotTable.prototype.clearFilters=function(){this.dataSource.clearFilters()},LightPivotTable.prototype.pushDataSource=function(t){var r;return this.DRILL_LEVEL++,this._dataSourcesStack.push(r=new DataSource(t||{},this.CONFIG,this,this.DRILL_LEVEL)),this.dataSource=r,r},LightPivotTable.prototype.popDataSource=function(t){this._dataSourcesStack.length<2||(this.DRILL_LEVEL--,this._dataSourcesStack.pop(),t||this.dataController.popData(),this.dataSource=this._dataSourcesStack[this._dataSourcesStack.length-1])},LightPivotTable.prototype.dataIsChanged=function(){this.pivotView.dataChanged(this.dataController.getData())},LightPivotTable.prototype.tryDrillDown=function(t){var r=this,i,n={};for(var l in r.CONFIG.dataSource)n[l]=r.CONFIG.dataSource[l];this.CONFIG.DrillDownExpression&&!(this.CONFIG.DrillDownExpression instanceof Array)&&(this.CONFIG.DrillDownExpression=[this.CONFIG.DrillDownExpression]),(this.CONFIG.DrillDownExpression||[])[this.DRILL_LEVEL]?n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,t,this.CONFIG.DrillDownExpression[this.DRILL_LEVEL])||this.dataSource.BASIC_MDX:n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,t)||this.dataSource.BASIC_MDX,i=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=i.FILTERS,this.dataSource.getCurrentData(function(o){r.dataController.isValidData(o)&&o.dataArray.length>0&&o.dimensions[1]&&o.dimensions[1][0]&&(o.dimensions[1][0].caption||o.dimensions[1][0].dimension||o.dimensions[1][0].path)?(r.pivotView.pushTable(),r.dataController.pushData(),r.dataController.setData(o),typeof r.CONFIG.triggers.drillDown=="function"&&r.CONFIG.triggers.drillDown.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX,path:o.dimensions[1][0].path||""})):r.popDataSource(!0)})},LightPivotTable.prototype.tryDrillThrough=function(t){var r=this,i,n={};for(var l in r.CONFIG.dataSource)n[l]=r.CONFIG.dataSource[l];const o=this.CONFIG.controls?.find(a=>a.action==="showListing")?.targetProperty;n.basicMDX=this.mdxParser.drillThrough(this.dataSource.BASIC_MDX,t,o)||this.dataSource.basicMDX,i=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=i.FILTERS,this.dataSource.getCurrentData(function(a){r.dataController.isValidData(a)&&a.dataArray.length>0?(r.pivotView.pushTable({disableConditionalFormatting:!0}),r.dataController.pushData(),r.dataController.setData(a),typeof r.CONFIG.triggers.drillThrough=="function"&&r.CONFIG.triggers.drillThrough.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX})):r.popDataSource(!0)})},LightPivotTable.prototype.getPivotProperty=function(t){if(this.CONFIG.pivotProperties){t instanceof Array||(t=[]);var r=this.CONFIG.pivotProperties;for(t=t.reverse();t.length&&typeof r<"u";)r=r[t.pop()];return r}},LightPivotTable.prototype.attachTrigger=function(t,r){if(typeof r!="function"){console.warn("LPT.addTrigger: pass the trigger as a second argument.");return}this.CONFIG.triggers[t]=r},LightPivotTable.prototype.normalizeConfiguration=function(t){typeof t.columnResizing>"u"&&(t.columnResizing=!0),typeof t.pagination>"u"&&(t.pagination=200),typeof t.enableSearch>"u"&&(t.enableSearch=!0),typeof t.stretchColumns>"u"&&(t.stretchColumns=!0),typeof t.enableListingSelect>"u"&&(t.enableListingSelect=!0),typeof t.showListingRowsNumber>"u"&&(t.showListingRowsNumber=!0),t.triggers||(t.triggers={}),t.dataSource||(t.dataSource={})},LightPivotTable.prototype.init=function(){var t=this;this.CONTROLS.drillThrough=function(){t.pivotView._drillThroughClickHandler.call(t.pivotView)},this.CONTROLS.customDrillThrough=function(r){if(!(r instanceof Array)){console.error('Parameter "filters" must be array of strings.');return}t.tryDrillThrough.call(t,r)},this.CONTROLS.back=function(){t.pivotView._backClickHandler.call(t.pivotView)},this.CONFIG.locale&&pivotLocale.setLocale(this.CONFIG.locale),this.refresh()};var MDXParser=function(){};MDXParser.prototype._warnMDX=function(t,r){console.warn(`MDX is not parsed:

%s

`+(r?"("+r+")":""),t)},MDXParser.prototype.makeSetExpressionFromFilter=function(t){return t.match(/^\([^\),]*,[^\)]*\)$/)?"NONEMPTYCROSSJOIN"+t.slice(0,t.length-1)+".children)":t+".children"},MDXParser.prototype.prependNonEmpty=function(t){return t.match(/^\s*non\s+empty/i)?t:"NON EMPTY "+t},MDXParser.prototype.applyRowCount=function(t,r){return t.replace(/\s*on\s*0\s*,\s*(?:non\s*empty\s*)?(.*)\s*on\s*1/i,function(i,n){return typeof r<"u"?" ON 0, NON EMPTY HEAD("+n+", "+r+") ON 1":i})},MDXParser.prototype.drillDown=function(t,r,i){if(!r)return/]\s+ON\s+1/i.test(t)?t=t.replace(/]\s+ON\s+1/i,"].children ON 1"):(this._warnMDX(t,"no filter specified"),"");var n=t.split(/(select\s*)(.*?)(\s*from)/ig);if(n.length<4)return this._warnMDX(t),"";var l=n[n.length-3],o=l.split(/(\s*ON\s*[01]\s*,?\s*)/i);if(o.length<2)return this._warnMDX(t,"DrillDown is impossible"),"";var a=-1;if(o.map(function(d,v){return d.match(/\s*ON\s*[01]\s*,?\s*/i)&&(a=v-1),d}),a===-1)return this._warnMDX(t,"DrillDown is impossible"),"";let u="";const h=o[a].match(/ORDER\((.*?)\,/);h&&h[0]&&(u=h[0]),u?o[a]=(i||o[a]).replace(u,"ORDER("+this.makeSetExpressionFromFilter(r)+","):o[a]=this.prependNonEmpty(i||this.makeSetExpressionFromFilter(r));for(var p in o)o[p].length===1&&o[p](parseInt(p),1);return n[n.length-3]=o.join(""),this.applyFilter(n.join(""),r)},MDXParser.prototype.drillThrough=function(t,r,i){var n=t.slice(t.lastIndexOf("FROM ")),l="DRILLTHROUGH SELECT "+n;for(var o in r)l=this.applyFilter(l,r[o]);return i&&(l+=` %LISTING [${i}]`),l},MDXParser.prototype.mdxType=function(t){var r=t.toLowerCase(),i=r.indexOf("drillthrough"),n=r.indexOf("select");return i>-1?"drillthrough":n>-1?"mdx":"unknown"},MDXParser.prototype.applyFilter=function(t,r){return t+(r?" %FILTER "+r:"")};/*!
 * numeral.js
 * version : 1.5.3
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */var numeral=function(){var t,r="1.5.3",i={},n="en",l=null,o="0,0",a=3,u=",",h=".",p=new RegExp("(\\d)(?=(\\d{"+a+"})+(?!\\d))","g");function d(c){this._value=c}function v(c,s,g,C){var S=Math.pow(10,s),x,O;return O=(g(c*S)/S).toFixed(s),C&&(x=new RegExp("0{1,"+C+"}$"),O=O.replace(x,"")),O}function L(c,s,g){var C;return s.indexOf("$")>-1?C=E(c,s,g):s.indexOf("%")>-1?C=F(c,s,g):s.indexOf(":")>-1?C=V(c,s):C=k(c._value,s,g),C}function A(c,s){var g=s,C,S,x,O,Z=["KB","MB","GB","TB","PB","EB","ZB","YB"],w=!1,y;if(s.indexOf(":")>-1)c._value=$(s);else if(s===l)c._value=0;else{for(i[n].delimiters.decimal!=="."&&(s=s.replace(/\./g,"").replace(i[n].delimiters.decimal,".")),C=new RegExp("[^a-zA-Z]"+i[n].abbreviations.thousand+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),S=new RegExp("[^a-zA-Z]"+i[n].abbreviations.million+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),x=new RegExp("[^a-zA-Z]"+i[n].abbreviations.billion+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),O=new RegExp("[^a-zA-Z]"+i[n].abbreviations.trillion+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),y=0;y<=Z.length&&(w=s.indexOf(Z[y])>-1?Math.pow(1024,y+1):!1,!w);y++);c._value=(w||1)*(g.match(C)?Math.pow(10,3):1)*(g.match(S)?Math.pow(10,6):1)*(g.match(x)?Math.pow(10,9):1)*(g.match(O)?Math.pow(10,12):1)*(s.indexOf("%")>-1?.01:1)*((s.split("-").length+Math.min(s.split("(").length-1,s.split(")").length-1))%2?1:-1)*Number(s.replace(/[^0-9\.]+/g,"")),c._value=w?Math.ceil(c._value):c._value}return c._value}function E(c,s,g){var C=s.indexOf("$"),S=s.indexOf("("),x=s.indexOf("-"),O="",Z,w;return s.indexOf(" $")>-1?(O=" ",s=s.replace(" $","")):s.indexOf("$ ")>-1?(O=" ",s=s.replace("$ ","")):s=s.replace("$",""),w=k(c._value,s,g),C<=1?w.indexOf("(")>-1||w.indexOf("-")>-1?(w=w.split(""),Z=1,(C<S||C<x)&&(Z=0),w.splice(Z,0,i[n].currency.symbol+O),w=w.join("")):w=i[n].currency.symbol+O+w:w.indexOf(")")>-1?(w=w.split(""),w.splice(-1,0,O+i[n].currency.symbol),w=w.join("")):w=w+O+i[n].currency.symbol,w}function F(c,s,g){var C="",S,x=c._value*100;return s.indexOf(" %")>-1?(C=" ",s=s.replace(" %","")):s=s.replace("%",""),S=k(x,s,g),S.indexOf(")")>-1?(S=S.split(""),S.splice(-1,0,C+"%"),S=S.join("")):S=S+C+"%",S}function V(c){var s=Math.floor(c._value/60/60),g=Math.floor((c._value-s*60*60)/60),C=Math.round(c._value-s*60*60-g*60);return s+":"+(g<10?"0"+g:g)+":"+(C<10?"0"+C:C)}function $(c){var s=c.split(":"),g=0;return s.length===3?(g=g+Number(s[0])*60*60,g=g+Number(s[1])*60,g=g+Number(s[2])):s.length===2&&(g=g+Number(s[0])*60,g=g+Number(s[1])),Number(g)}function k(c,s,g){var C=!1,S=!1,x=!1,O="",Z=!1,w=!1,y=!1,N=!1,D=!1,b="",I="",G=Math.abs(c),K=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],X,P,f,m,z,Q,T="",ie=!1;if(c===0&&l!==null)return l;if(s.indexOf("(")>-1?(C=!0,s=s.slice(1,-1)):s.indexOf("+")>-1&&(S=!0,s=s.replace(/\+/g,"")),s.indexOf("a")>-1&&(Z=s.indexOf("aK")>=0,w=s.indexOf("aM")>=0,y=s.indexOf("aB")>=0,N=s.indexOf("aT")>=0,D=Z||w||y||N,s.indexOf(" a")>-1?(O=" ",s=s.replace(" a","")):s=s.replace("a",""),G>=Math.pow(10,12)&&!D||N?(O=O+i[n].abbreviations.trillion,c=c/Math.pow(10,12)):G<Math.pow(10,12)&&G>=Math.pow(10,9)&&!D||y?(O=O+i[n].abbreviations.billion,c=c/Math.pow(10,9)):G<Math.pow(10,9)&&G>=Math.pow(10,6)&&!D||w?(O=O+i[n].abbreviations.million,c=c/Math.pow(10,6)):(G<Math.pow(10,6)&&G>=Math.pow(10,3)&&!D||Z)&&(O=O+i[n].abbreviations.thousand,c=c/Math.pow(10,3))),s.indexOf("b")>-1){for(s.indexOf(" b")>-1?(b=" ",s=s.replace(" b","")):s=s.replace("b",""),f=0;f<=K.length;f++)if(X=Math.pow(1024,f),P=Math.pow(1024,f+1),c>=X&&c<P){b=b+K[f],X>0&&(c=c/X);break}}return s.indexOf("o")>-1&&(s.indexOf(" o")>-1?(I=" ",s=s.replace(" o","")):s=s.replace("o",""),I=I+i[n].ordinal(c)),s.indexOf("[.]")>-1&&(x=!0,s=s.replace("[.]",".")),m=c.toString().split(".")[0],z=s.split(".")[1],Q=s.indexOf(","),z?(z.indexOf("[")>-1?(z=z.replace("]",""),z=z.split("["),T=v(c,z[0].length+z[1].length,g,z[1].length)):T=v(c,z.length,g),m=T.split(".")[0],T.split(".")[1].length?T=(h||i[n].delimiters.decimal)+T.split(".")[1]:T="",x&&Number(T.slice(1))===0&&(T="")):m=v(c,null,g),m.indexOf("-")>-1&&(m=m.slice(1),ie=!0),Q>-1&&(m=m.toString().replace(p,"$1"+(u||i[n].delimiters.thousands))),s.indexOf(".")===0&&(m=""),(C&&ie?"(":"")+(!C&&ie?"-":"")+(!ie&&S?"+":"")+m+T+(I||"")+(O||"")+(b||"")+(C&&ie?")":"")}t=function(c){return t.isNumeral(c)?c=c.value():c===0||typeof c>"u"?c=0:Number(c)||(c=t.fn.unformat(c)),new d(Number(c))},t.version=r,t.isNumeral=function(c){return c instanceof d},t.language=function(c,s){if(!c)return n;if(c&&!s){if(!i[c])throw new Error("Unknown language : "+c);n=c}return(s||!i[c])&&W(c,s),t},t.languageData=function(c){if(!c)return i[n];if(!i[c])throw new Error("Unknown language : "+c);return i[c]},t.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(c){var s=c%10;return~~(c%100/10)===1?"th":s===1?"st":s===2?"nd":s===3?"rd":"th"},currency:{symbol:"$"}}),t.zeroFormat=function(c){l=typeof c=="string"?c:null},t.defaultFormat=function(c){o=typeof c=="string"?c:"0.0"};function W(c,s){i[c]=s}typeof Array.prototype.reduce!="function"&&(Array.prototype.reduce=function(c,s){"use strict";if(this===null||typeof this>"u")throw new TypeError("Array.prototype.reduce called on null or undefined");if(typeof c!="function")throw new TypeError(c+" is not a function");var g,C,S=this.length>>>0,x=!1;for(1<arguments.length&&(C=s,x=!0),g=0;S>g;++g)this.hasOwnProperty(g)&&(x?C=c(C,this[g],g,this):(C=this[g],x=!0));if(!x)throw new TypeError("Reduce of empty array with no initial value");return C});function U(c){var s=c.toString().split(".");return s.length<2?1:Math.pow(10,s[1].length)}function H(){var c=Array.prototype.slice.call(arguments);return c.reduce(function(s,g){var C=U(s),S=U(g);return C>S?C:S},-1/0)}t.setup=function(c,s,g){c!==h&&(h=c),s!==u&&(u=s),g!==a&&(a=g,p=new RegExp("(\\d)(?=(\\d{"+a+"})+(?!\\d))","g"))},t.fn=d.prototype={clone:function(){return t(this)},format:function(c,s){return L(this,c||o,s!==void 0?s:Math.round)},unformat:function(c){return Object.prototype.toString.call(c)==="[object Number]"?c:A(this,c||o)},value:function(){return this._value},valueOf:function(){return this._value},set:function(c){return this._value=Number(c),this},add:function(c){var s=H.call(null,this._value,c);function g(C,S,x,O){return C+s*S}return this._value=[this._value,c].reduce(g,0)/s,this},subtract:function(c){var s=H.call(null,this._value,c);function g(C,S,x,O){return C-s*S}return this._value=[c].reduce(g,this._value*s)/s,this},multiply:function(c){function s(g,C,S,x){var O=H(g,C);return g*O*(C*O)/(O*O)}return this._value=[this._value,c].reduce(s,1),this},divide:function(c){function s(g,C,S,x){var O=H(g,C);return g*O/(C*O)}return this._value=[this._value,c].reduce(s),this},difference:function(c){return Math.abs(t(this._value).subtract(c).value())}},this.numeral=t},PivotLocale=function(t){this.LOCALE="",this.DEFAULT_LOCALE="en",this.setLocale(t||(navigator.language||"").substr(0,2)||(navigator.browserLanguage||this.DEFAULT_LOCALE).substring(0,2))};PivotLocale.prototype.LOCALES=[{ru:"\u0412\u0441\u0435\u0433\u043E",en:"Total",de:"Summe",cs:"Celkem"},{ru:"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043E\u0431\u0440\u0430\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435",en:"Unable to render data",de:"Daten k\xF6nnen nicht rendern",cs:"Nebylo mo\u017En\xE9 zobrazit data"},{ru:"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F.",en:"Invalid data to display.",de:"Nicht korrekt Informationen angezeigt werden soll.",cs:"Nevhodn\xE1 data k zobrazen\xED"},{ru:"\u0412\u043E\u0437\u043D\u0438\u043A\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.",en:"Error while trying to retrieve data from server.",de:"Beim Abrufen der Daten vom Server ist ein Fehler aufgetreten.",cs:"Chyba p\u0159i pokusu o z\xEDsk\xE1n\xED dat ze serveru"},{ru:"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F.",en:"No data to display.",de:"Keine Daten zum anzeigen.",cs:"\u017D\xE1dn\xE1 data k zobrazen\xED"},{ru:"% \u043E\u0442 \u0412\u0441\u0435\u0433\u043E",en:"% of Total",de:"% des Summe",cs:"% z Celkem"}],PivotLocale.prototype.setLocale=function(t){var r,i=[];if(t=t.toLowerCase(),this.LOCALES[0].hasOwnProperty(t))this.LOCALE=t;else{for(r in this.LOCALES[0])i.push(r);console.warn("LightPivot: locale "+t+" is not supported. Currently localized: "+i.join(", ")+"."),this.LOCALE="en"}},PivotLocale.prototype.get=function(t){return(this.LOCALES[t]||{})[this.LOCALE]||"{not localized: "+t+"}"};var pivotLocale=new PivotLocale,PivotView=function(t,r){if(!(r instanceof HTMLElement))throw new Error('Please, provide HTMLElement instance "container" into pivot table configuration.');this.tablesStack=[],this.selectedRows={},numeral.call(this),this.elements={container:r,base:document.createElement("div"),tableContainer:void 0,messageElement:void 0,searchSelect:void 0,searchInput:void 0},this.pagination=null,this.savedScroll={x:0,y:0},this.FIXED_COLUMN_SIZES=[],this.PAGINATION_BLOCK_HEIGHT=20,this.ANIMATION_TIMEOUT=500,this.SEARCH_ENABLED=!1,this.SEARCHBOX_LEFT_MARGIN=191,this.savedSearch={restore:!1,value:"",columnIndex:0},this.controller=t,this.SCROLLBAR_WIDTH=function(){var i=document.createElement("div");i.style.visibility="hidden",i.style.width="100px",i.style.msOverflowStyle="scrollbar",document.body.appendChild(i);var n=i.offsetWidth;i.style.overflow="scroll";var l=document.createElement("div");l.style.width="100%",i.appendChild(l);var o=l.offsetWidth;return i.parentNode.removeChild(i),n-o}(),this.init()};return PivotView.prototype.init=function(){var t=this,r=this.elements;r.base.className="lpt",r.base.setAttribute("LPTVersion",this.controller.VERSION),r.container.appendChild(r.base),this.pushTable(),this.displayLoading(),window.addEventListener("resize",function(){t.updateSizes.call(t)}),this._=function(){t.displayMessage('<a href="https://github.com/ZitRos/LightPivotTable">LIGHT PIVOT TABLE v'+t.controller.VERSION+'</a><br/>by <a href="https://plus.google.com/+NikitaSavchenko">Nikita Savchenko</a><br/>for dear users of products of <a href="http://www.intersystems.com/">InterSystems Corporation</a><br/>Hope you enjoy it!',!0)}},PivotView.prototype.getCellElement=function(t,r,i){var n=this.tablesStack[this.tablesStack.length-1].element,l,o,a,u,h=function(p,d,v){var L=[],A,E,F,V,$,k,W;for(W=0;W<p.rows.length;W++)for(A=p.rows[W],k=0;k<A.cells.length;k++){for(E=A.cells[k],F=k;L[W]&&L[W][F];++F);for(V=F;V<F+E.colSpan;++V)for($=W;$<W+E.rowSpan;++$)L[$]||(L[$]=[]),L[$][V]=!0;if(F<=d&&d<F+E.colSpan&&W<=v&&v<W+E.rowSpan)return E}return null};if(i){if(l=n.getElementsByClassName("lpt-topHeader")[0],!l||(l=l.getElementsByTagName("table")[0],!l)||(o=0,[].slice.call(l.rows).forEach(function(p){o+=p.rowSpan||1}),u=n.getElementsByClassName("lpt-leftHeader")[0],!l)||(u=u.getElementsByTagName("table")[0],!l))return null;if(a=0,(this.getCurrentTableData().element||{})._listing||[].slice.call((u.rows[0]||{cells:[]}).cells).forEach(function(p){a+=p.colSpan||1}),t<a&&r<o)return n.getElementsByClassName("lpt-headerValue")[0]||null;if(t>=a&&r<o)return(h(l,t-a,r)||{childNodes:[null]}).childNodes[0];if(t<a&&r>=o)return(h(u,t,r-o)||{childNodes:[null]}).childNodes[0];t-=a,r-=o}return l=n.getElementsByClassName("lpt-tableBlock")[0],!l||(l=l.getElementsByTagName("table")[0],!l)?null:((l.rows[r]||{cells:[]}).cells[t]||{childNodes:[null]}).childNodes[0]},PivotView.prototype.getTableSize=function(t){var r,i=0,n=0,l=this.tablesStack[this.tablesStack.length-1].element;return r=l.getElementsByClassName("lpt-tableBlock")[0],!r||(r=r.getElementsByTagName("table")[0],!r)?0:([].slice.call(r.rows).forEach(function(o){n+=o.rowSpan||1}),[].slice.call((r.rows[0]||{cells:[]}).cells).forEach(function(o){i+=o.colSpan||1}),t?(r=l.getElementsByClassName("lpt-topHeader")[0],!r||(r=r.getElementsByTagName("table")[0],!r)||([].slice.call(r.rows).forEach(function(o){n+=o.rowSpan||1}),r=l.getElementsByClassName("lpt-leftHeader")[0],!r)||(r=r.getElementsByTagName("table")[0],!r)?0:((this.getCurrentTableData().element||{})._listing||[].slice.call((r.rows[0]||{cells:[]}).cells).forEach(function(o){i+=o.colSpan||1}),{width:i,height:n})):{width:i,height:n})},PivotView.prototype.displayLoading=function(){this.displayMessage(this.controller.CONFIG.loadingMessageHTML||'<div class="lpt-spinner"><div></div><div></div><div></div><div></div><div></div></div>')},PivotView.prototype.updateSizes=function(){for(var t in this.tablesStack)this.recalculateSizes(this.tablesStack[t].element)},PivotView.prototype._updateTablesPosition=function(t){for(var r=0;r<this.tablesStack.length;r++)this.tablesStack[r].element.style.left=(1+(t||0)+r-this.tablesStack.length)*100+"%"},PivotView.prototype.getCurrentTableData=function(){return this.tablesStack[this.tablesStack.length-1]},PivotView.prototype.pushTable=function(t){var r=this,i,n=document.createElement("div");n.className="tableContainer",this.tablesStack.length&&(this.tablesStack[this.tablesStack.length-1].FIXED_COLUMN_SIZES=this.FIXED_COLUMN_SIZES,this.tablesStack[this.tablesStack.length-1].savedSearch=this.savedSearch,this.tablesStack[this.tablesStack.length-1].selectedRows=this.selectedRows,this.savedSearch={restore:!1,value:"",columnIndex:0},n.style.left="100%"),this.tablesStack.push({element:n,opts:t||{},pagination:i={on:!1,rows:1/0,page:0,pages:0}}),this.FIXED_COLUMN_SIZES=[],this.selectedRows={},this.elements.base.appendChild(n),this.elements.tableContainer=n,this.pagination=i,setTimeout(function(){r._updateTablesPosition()},30)},PivotView.prototype.popTable=function(){var t;if(!(this.tablesStack.length<2)){this.FIXED_COLUMN_SIZES=[],this._updateTablesPosition(1);var r=this.tablesStack.pop();this.pagination=(t=this.tablesStack[this.tablesStack.length-1]).pagination,t.FIXED_COLUMN_SIZES&&(this.FIXED_COLUMN_SIZES=t.FIXED_COLUMN_SIZES),t.savedSearch&&(this.savedSearch=t.savedSearch),t.selectedRows&&(this.selectedRows=t.selectedRows),setTimeout(function(){r.element.parentNode.removeChild(r.element)},this.ANIMATION_TIMEOUT),this.elements.tableContainer=this.tablesStack[this.tablesStack.length-1].element}},PivotView.prototype.saveScrollPosition=function(){var t;this.elements.tableContainer&&(t=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(this.savedScroll.x=t[0].scrollLeft,this.savedScroll.y=t[0].scrollTop)},PivotView.prototype.restoreScrollPosition=function(){var t;this.elements.tableContainer&&(t=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(t[0].scrollLeft=this.savedScroll.x,t[0].scrollTop=this.savedScroll.y)},PivotView.prototype.dataChanged=function(t){var r=t.rawData.length-t.info.topHeaderRowsNumber;this.controller.CONFIG.pagination&&(this.pagination.on=!0),this.pagination.rows=this.controller.CONFIG.pagination||1/0,this.selectedRows={},this.pagination.page=0,this.pagination.pages=Math.ceil(r/this.pagination.rows),this.pagination.pages<2&&(this.pagination.on=!1),this.renderRawData(t)},PivotView.prototype._columnClickHandler=function(t){this.saveScrollPosition(),this.controller.dataController.sortByColumn(t),this.restoreScrollPosition()},PivotView.prototype._rowClickHandler=function(t,r){var i=!0;if(typeof this.controller.CONFIG.triggers.rowClick=="function"){var n=this.controller.getRowsValues([t])[0].slice(this.controller.dataController.getData().info.leftHeaderColumnsNumber);i=this.controller.CONFIG.triggers.rowClick(t,n,r)}i!==!1&&this.controller.tryDrillDown(r.source.path)},PivotView.prototype._pageSwitcherHandler=function(t){this.pagination.page=t,this.saveScrollPosition(),this.renderRawData(this.controller.dataController.getData()),this.restoreScrollPosition()},PivotView.prototype._backClickHandler=function(t){t&&(t.cancelBubble=!0,t.stopPropagation()),this.removeMessage(),this.popTable(),this.controller.popDataSource(),typeof this.controller.CONFIG.triggers.back=="function"&&this.controller.CONFIG.triggers.back.call(this.controller,{level:this.controller.DRILL_LEVEL})},PivotView.prototype._drillThroughClickHandler=function(t){this.controller.tryDrillThrough(),t&&(t.cancelBubble=!0,t.stopPropagation())},PivotView.prototype._getSelectedText=function(){var t="";return typeof window.getSelection<"u"?t=window.getSelection().toString():typeof document.selection<"u"&&document.selection.type=="Text"&&(t=document.selection.createRange().text),t},PivotView.prototype._cellClickHandler=function(t,r,i,n,l){var o=this.controller.dataController.getData(),a=[],u,h,p=!0,d,v=this.controller.CONFIG.showSummary&&this.controller.CONFIG.attachTotals?1:0;if(!this._getSelectedText()&&!(typeof this.controller.CONFIG.triggers.cellSelected=="function"&&(d=this.controller.CONFIG.triggers.cellSelected.call(this.controller,{x:r-o.info.leftHeaderColumnsNumber,y:i-o.info.topHeaderRowsNumber,leftHeaderColumnsNumber:o.info.leftHeaderColumnsNumber,topHeaderRowsNumber:o.info.topHeaderRowsNumber}),d===!1))){try{u=o.rawData[i][o.info.leftHeaderColumnsNumber-1].source.path,h=o.rawData[o.info.topHeaderRowsNumber-1-v][r].source.path}catch{this.controller.CONFIG.logs&&console.warn("Unable to get filters for cell (%d, %d)",r,i)}u&&a.push(u),h&&a.push(h),this.controller.CONFIG.drillDownTarget?window.location=location.origin+location.pathname+"?DASHBOARD="+encodeURIComponent(this.controller.CONFIG.drillDownTarget)+"&SETTINGS=FILTER:"+encodeURIComponent(a.join("~"))+";":(typeof this.controller.CONFIG.triggers.cellDrillThrough=="function"&&(p=this.controller.CONFIG.triggers.cellDrillThrough({event:n,filters:a,cellData:t,x:r,y:i},o)),typeof l=="function"&&(p=!(l({event:n,filters:a,cellData:t,x:r,y:i},o)===!1||p===!1)),p!==!1&&this.controller.tryDrillThrough(a))}},PivotView.prototype.copyToClipboard=function(t){var r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",t),document.body.appendChild(r),r.select();var i=!1;try{i=document.execCommand("copy")}catch(n){console.log("Copy error: "+n)}return document.body.removeChild(r),i},PivotView.prototype.listingClickHandler=function(t,r){if(r.info.leftHeaderColumnsNumber!==0){console.warn("Listing handler called not for a listing!");return}var i=this.controller.CONFIG.triggerEvent||"click",n=this,l=function(E){return document.createElement(E)},o=l("div"),a=r.rawData[0].map(function(E){return E.value+(E.source&&E.source.title?"("+E.source.title+")":"")}),u=r.rawData[t.y].map(function(E){return E.value});o.className="lpt-hoverMessage",o.style.fontSize="12pt",o.style.opacity=0;for(var h,p,d,v,L,A=0;A<a.length;A++)h=l("div"),L=l("span"),p=l("div"),d=l("hr"),v=l("div"),v.className="lpt-icon-copy",v.title="Copy",v.style.marginRight="6px",L.className="lpt-messageHead",L.textContent=a[A],p.className="lpt-messageBody",h.style.marginBottom=".3em",u[A]!==""?p.textContent=u[A]:p.innerHTML="&nbsp;",h.appendChild(v),h.appendChild(L),o.appendChild(h),o.appendChild(p),o.appendChild(d),v.addEventListener(i,function(E){return function(F){n.copyToClipboard(E)===!1&&alert("Your browser does not support dynamic content copying."),F.preventDefault(),F.cancelBubble=!0,F.preventBubble=!0}}(u[A]));return this.elements.base.appendChild(o),setTimeout(function(){o&&(o.style.opacity=1)},1),o.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){n._getSelectedText()||n.removeMessage()}),!1},PivotView.prototype.displayMessage=function(t,r){this.removeMessage();var i=this,n=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div");n.className="central lpt-hoverMessage",n.style.opacity=0,o.innerHTML=t,l.appendChild(o),n.appendChild(l),this.elements.base.appendChild(n),setTimeout(function(){n&&(n.style.opacity=1)},1),r&&n.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){i.removeMessage()})},PivotView.prototype.removeMessage=function(){var t,r;if((t=this.elements.base.getElementsByClassName("lpt-hoverMessage")).length)for(r in t)t[r].parentNode&&t[r].parentNode.removeChild(t[r])},PivotView.prototype._matchCondition=function(t,r,i){var n=parseFloat(t);switch(r){case"=":return n==i;case"<>":return n!=i;case">":return n>i;case">=":return n>=i;case"<":return n<i;case"<=":return n<=i;case"IN":return i.toString().indexOf(n)!==-1;case"BETWEEN":return n>=i.split(",")[0]&&n<=i.split(",")[1];case"IS NULL":return!n;default:return console.error('Formatting error: unknown format operator "'+r+'"'),!1}},PivotView.prototype.applyConditionalFormatting=function(t,r,i,n){var l=t[""]||[],o,a,u,h,p,d;l=l.concat(t[r]||[]),(p=r.split(",")).length===2&&(l=l.concat(t[p[0]]||[],t[p[0]+","]||[],t[","+p[1]]||[]));for(o in l)if(u=l[o],!!this._matchCondition(i,u.operator,u.value)){if(u.style&&n.setAttribute("style",(n.getAttribute("style")||"")+u.style),u.icon){for(n.textContent="",h='<div style="overflow: hidden; height: 16px;">',d=parseInt(u.iconCount)||1,a=0;a<d;a++)h+='<img alt="*" style="padding-right:2px; height: 100%;" src="'+u.icon+'"/>';n.innerHTML=h+"</div>"}u.text&&(n.textContent=u.text)}},PivotView.prototype.colorNameToRGB=function(t){var r=function(i,n,l){return{r:i,g:n,b:l}};switch(t){case"red":return r(255,0,0);case"green":return r(0,255,0);case"blue":return r(0,0,255);case"purple":return r(102,0,153);case"salmon":return r(255,140,105);case"white":return r(255,255,255);case"black":return r(0,0,0);case"gray":return r(128,128,128);default:return r(255,255,255)}},PivotView.prototype.selectRow=function(t,r){if(t?this.selectedRows[r]=1:delete this.selectedRows[r],typeof this.controller.CONFIG.triggers.rowSelect=="function"){var i=this.controller.getSelectedRows();this.controller.CONFIG.triggers.rowSelect(i,this.controller.getRowsValues(i))}},PivotView.prototype.recalculateSizes=function(t){var r=t.parentNode,i=22;try{var n=this,l=this.controller.CONFIG.triggerEvent||"click",o=t.getElementsByClassName("lpt-headerValue")[0];if(!o)return;var a=t.getElementsByClassName("lpt-header")[0],u=t.getElementsByClassName("lpt-topHeader")[0],h=t.getElementsByTagName("table")[0],p=h.offsetWidth,d=u.getElementsByTagName("thead")[0],v=t.getElementsByClassName("lpt-leftHeader")[0],L=v.getElementsByTagName("thead")[0],A=t.getElementsByClassName("lpt-tableBlock")[0],E=A.getElementsByTagName("table")[0],F=A.getElementsByTagName("tbody")[0],V=t.getElementsByClassName("lpt-searchInput")[0],$=V?t.offsetWidth-this.SEARCHBOX_LEFT_MARGIN:0,k=A.getElementsByTagName("tr")[0],W=t.getElementsByClassName("lpt-pageSwitcher")[0];d.childNodes[0]&&d.childNodes[0].lastChild._extraCell&&d.childNodes[0].removeChild(d.childNodes[0].lastChild),L.lastChild&&L.lastChild._extraTr&&L.removeChild(L.lastChild);var U=(W?this.PAGINATION_BLOCK_HEIGHT:0)+(this.SEARCH_ENABLED?this.PAGINATION_BLOCK_HEIGHT:0),H=Math.max(v.offsetWidth,a.offsetWidth),c=u.offsetHeight;u.style.marginLeft=H+"px";var s=t.offsetHeight,g=s-c-U,C=a.offsetWidth,S=L.offsetHeight===0,x=Math.max(L.offsetHeight,F.offsetHeight)>g&&this.SCROLLBAR_WIDTH>0,O=d.offsetWidth>u.offsetWidth-(x?this.SCROLLBAR_WIDTH:0);!x&&O&&(x=Math.max(L.offsetHeight,F.offsetHeight)>g-this.SCROLLBAR_WIDTH&&this.SCROLLBAR_WIDTH>0);var Z=x&&!S,w,y,N=[],D=[],b=[],I,G=!1,K=function(){!n.controller.CONFIG.stretchColumns&&x&&!O||(G=!0,y=document.createElement("th"),y.className="lpt-extraCell",y.style.minWidth=n.SCROLLBAR_WIDTH+"px",y.style.width=n.SCROLLBAR_WIDTH+"px",y.rowSpan=d.childNodes.length,y._extraCell=!0,d.childNodes[0].appendChild(y))};if(x&&d.childNodes[0]&&K(),t._primaryColumns)for(I in t._primaryColumns)N.push(t._primaryColumns[I].offsetWidth);else console.warn("No _primaryColumns property in container, cell sizes won't be fixed.");if(t._primaryRows&&t._primaryCells){for(I in t._primaryRows)D.push(t._primaryRows[I].offsetHeight);for(I in t._primaryCells)b.push(t._primaryCells[I].offsetHeight)}else console.warn("No _primaryRows property in container, cell sizes won't be fixed.");var X=[].slice.call(v.getElementsByTagName("th")).map(function(P){return{el:P.getElementsByTagName("div")[0],height:P.getElementsByTagName("div")[0].offsetHeight}});if(t.parentNode.removeChild(t),u.style.marginLeft=H+"px",A.style.marginLeft=H+"px",v.style.height=s-c-U+"px",v.style.width=H+"px",C>H&&(v.style.width=C+"px"),A.style.height=s-c-U-1+"px",a.style.height=c+"px",a.style.width=H+"px",this.controller.CONFIG.stretchColumns||(h.style.width="auto",E.style.width=O?"100%":p+"px"),Z&&(y=document.createElement("tr"),y.appendChild(w=document.createElement("th")),L.appendChild(y),w.__i=0,w.addEventListener(l,function(){w.__i++,w.style.background="#"+Math.max(18-w.__i*3,0).toString(16)+"FF7D7",w.__i>5&&n._()}),y._extraTr=!0,w.colSpan=L.childNodes.length,w.style.height=(this.SCROLLBAR_WIDTH?this.SCROLLBAR_WIDTH+1:0)+"px"),V&&(V.style.width=$+"px"),k)for(I in k.childNodes)k.childNodes[I].tagName==="TD"&&(k.childNodes[I].style.width=N[I]+"px");t._primaryRows.forEach(function(P,f){t._primaryCells[f].style.height=t._primaryRows[f].style.height=Math.max(D[f]||D[f-1]||i,b[f]||b[f-1]||i)+"px"}),X.forEach(function(P){P.el.style.height=parseInt(P.height)+"px"}),r.appendChild(t),Math.max(L.offsetHeight,F.offsetHeight)>g&&this.SCROLLBAR_WIDTH>0&&!G&&K()}catch(P){console.error("Error when fixing sizes.","ERROR:",P)}},PivotView.prototype.getUnixDateFromCacheFormat=function(t){function r(d,v){var L=new Date(d);return L.setDate(d.getDate()+v),L}function i(d){var v=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],L=Date.parse(d);if(!isNaN(L))return L;if(d.split("-").length==2){var A=d.split("-"),E=v.indexOf(A[0].toLowerCase());if(E!=-1)return Date.parse((E+1).toString()+"/01/"+A[1])}else if(d.split(" ").length==2){var F=d.split(" ")[1].split(":").length;if(F===0&&(d+=":00"),L=Date.parse(d.replace(/-/g,"/")),!isNaN(L))return L}return 0}if(t===""&&t===void 0||t===null)return null;var n=t.toString();if(n.length==4||n.indexOf("-")!=-1||n.indexOf(" ")!=-1)return i(t);if(n.length==6){var l=n.substr(0,4),o=n.substr(4,2);return Date.parse(new Date(parseInt(l),parseInt(o)-1,1))}if(n.length==5&&!isNaN(parseInt(n))){var a=new Date(1840,11,31),u=n.toString().split(","),h=parseInt(u[0]),p=null;return u.length>1&&(p=parseInt(u[1])),a=r(a,parseInt(h)),p&&a.setSeconds(p),Date.parse(a)}else return i(t)},PivotView.prototype.renderRawData=function(t){if(!t.rawData||!t.rawData[0]||!t.rawData[0][0]){this.displayMessage("<h1>"+pivotLocale.get(1)+"</h1><p>"+JSON.stringify(t)+"</p>");return}var r=this,i=t.rawData,n=t.info,l=t.columnProps,o=t.rowProps,a=t.conditionalFormatting?t.conditionalFormatting.colorScale:void 0,u=this.controller.CONFIG.triggerEvent||"click",h=n.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,p=!!this.controller.CONFIG.columnResizing,d=n.leftHeaderColumnsNumber===0,v=d&&this.controller.CONFIG.enableSearch,L=this.controller.CONFIG.enableListingSelect,A=!!this.controller.CONFIG.columnResizeAnimation,E=this.elements.tableContainer,F=document.createElement("div"),V=document.createElement("div"),$=document.createElement("div"),k=document.createElement("div"),W=document.createElement("div"),U=document.createElement("div"),H=document.createElement("div"),c=document.createElement("table"),s=document.createElement("thead"),g=document.createElement("table"),C=document.createElement("thead"),S=document.createElement("table"),x=document.createElement("tbody"),O=this.pagination.on||d&&this.controller.CONFIG.showListingRowsNumber,Z=O?document.createElement("div"):null,w=O?[]:null,y=Z?document.createElement("div"):null,N=v?document.createElement("div"):null,D=v?document.createElement("span"):null,b=v?document.createElement("select"):null,I=v?document.createElement("span"):null,G=v?document.createElement("input"):null,K=v?function(){for(var _=[],R=n.leftHeaderColumnsNumber,Y=n.topHeaderRowsNumber-1-h,M=R;M<i[Y].length;M++)_.push({value:i[Y][M].value,source:i[Y][M].source,columnIndex:M});return _}():null,X={},P,f,m,z=null,Q,T,ie=[],ue=[],pe=[],ae,oe,he,fe,de;this.SEARCH_ENABLED=v,this.numeral.setup(n.decimalSeparator||".",n.numericGroupSeparator||",",n.numericGroupSize||3);var me=function(_,R,Y){if(typeof _=="string")_[_.length-1]==="%"&&!isNaN(parseFloat(_))||(R.parentNode.className+=" formatLeft"),R.innerHTML=(_||"").replace(/(https?|ftp):\/\/[^\s]+/ig,function(ee){return"<a href='"+ee+"' target='"+(r.controller.CONFIG.linksTarget||"_blank")+"' onclick='var e=event||window.event;e.stopPropagation();e.cancelBubble=true;'>"+ee+"</a>"});else if(d)R.textContent=_;else if(Y==="%date%"){var M=new Date(r.getUnixDateFromCacheFormat(_));if(isNaN(M.getTime())){R.textContent=_;return}R.textContent=M.getHours()+M.getMinutes()+M.getSeconds()===0?M.toLocaleDateString():M.toLocaleString()}else Y?R.textContent=_&&r.numeral(_).format(Y):_?R.textContent=r.numeral(_).format(_%1===0?"#,###":"#,###.##"):R.textContent=_},Ce=function(_,R){var Y;_.createTextRange?(Y=_.createTextRange(),Y.move("character",R),Y.select()):_.setSelectionRange(R,R)},ye=function(_,R){var Y=0,M=0,J=function(j){j.cancelBubble=!0,j.preventDefault(),_.style.width=_.style.minWidth=Y-M+j.pageX+"px",A&&(r.saveScrollPosition(),r.recalculateSizes(E),r.restoreScrollPosition())},ee=function(j){j.cancelBubble=!0,j.preventDefault(),_.style.width=_.style.minWidth=(r.FIXED_COLUMN_SIZES[R]=Y-M+j.pageX)+"px",r.saveScrollPosition(),r.recalculateSizes(E),r.restoreScrollPosition(),document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",ee)};_.addEventListener("mousedown",function(j){(j.target||j.srcElement)===_&&(j.cancelBubble=!0,j.preventDefault(),Y=_.offsetWidth,M=j.pageX,document.addEventListener("mousemove",J),document.addEventListener("mouseup",ee))})};for(this.removeMessage();E.firstChild;)E.removeChild(E.firstChild);var ge=function(_,R,Y,M,J){var ee=J===C,j,le,te,B,se,ne;function ve(q){for(var re=q.checked;q=q.parentNode;)if(q.tagName==="TR"){q.classList[re?"add":"remove"]("lpt-selectedRow"),r.elements.tableContainer.querySelector(".lpt-tableBlock table").rows[q.rowIndex].classList[re?"add":"remove"]("lpt-selectedRow");break}}if(_===R&&L){for(m=Y;m<M;m++)te=document.createElement("tr"),B=document.createElement("td"),ne=document.createElement("input"),ne.setAttribute("type","checkbox"),ne.checked=!!r.selectedRows[m],ne.checked&&function(q){setTimeout(function(){ve(q)},1)}(ne),B.setAttribute("style","padding: 0 !important;"),ne.addEventListener("click",function(q){return function(re){var ce=re.srcElement||re.target;re.preventDefault(),re.cancelBubble=!0,setTimeout(function(){ce.checked=!ce.checked,r.selectRow.call(r,ce.checked,q),ve(ce)},1)}}(m)),B.appendChild(ne),te.appendChild(B),ue.push(B),J.appendChild(te);return}for(m=Y;m<M;m++){for(f=_;f<R;f++)le=!0,(j=X.hasOwnProperty(i[m][f].group))&&(f>0&&i[m][f-1].group===i[m][f].group&&(le=!1,X[i[m][f].group].element.colSpan=f-X[i[m][f].group].x+1),m>0&&i[m-1][f].group===i[m][f].group&&(le=!1,X[i[m][f].group].element.rowSpan=m-X[i[m][f].group].y+1),B=X[i[m][f].group].element),(!j||le)&&(te||(te=document.createElement("tr")),te.appendChild(B=document.createElement(i[m][f].isCaption?"th":"td")),i[m][f].source&&i[m][f].source.title&&B.setAttribute("title",i[m][f].source.title),se=document.createElement("div"),i[m][f].value?se.textContent=i[m][f].value:se.innerHTML="&nbsp;",B.appendChild(se),i[m][f].style&&B.setAttribute("style",i[m][f].style),n.leftHeaderColumnsNumber===0&&r.controller.CONFIG.listingColumnMinWidth&&(B.style.minWidth=r.controller.CONFIG.listingColumnMinWidth+"px"),n.leftHeaderColumnsNumber>0&&r.controller.CONFIG.maxHeaderWidth&&(B.style.maxWidth=r.controller.CONFIG.maxHeaderWidth+"px",B.style.whiteSpace="normal",B.style.wordWrap="normal"),i[m][f].className&&(B.className=i[m][f].className),i[m][f].group&&(X[i[m][f].group]={x:f,y:m,element:B}),i[m][f].isCaption||me(i[m][f].value,B,o[m].format||l[f].format)),ee&&f===R-1&&(ue.push(B),B.addEventListener(u,function(q,re){return function(){r._rowClickHandler.call(r,q,re)}}(m,i[m][f]))),!ee&&m===M-1-h&&!B._hasSortingListener&&(B._hasSortingListener=!1,i[m][f].noClick||B.addEventListener(u,function(q){return function(){r._columnClickHandler.call(r,q)}}(f-n.leftHeaderColumnsNumber)),B.className=(B.className||"")+" lpt-clickable"),!ee&&m===M-1&&(r.FIXED_COLUMN_SIZES[f]&&(B.style.minWidth=B.style.width=r.FIXED_COLUMN_SIZES[f]+"px"),p&&(ye(B,f),B.className+=" lpt-resizableColumn"),ie.push(B));te&&J.appendChild(te),te=null}};for(W.textContent="",i[0][0].style&&!d&&W.setAttribute("style",i[0][0].style),this.tablesStack.length>1&&!this.controller.CONFIG.hideButtons&&(W.className+="back ",W.addEventListener(u,function(_){r._backClickHandler.call(r,_)})),n.leftHeaderColumnsNumber>0&&r.controller.CONFIG.maxHeaderWidth&&($.style.maxWidth=r.controller.CONFIG.maxHeaderWidth*n.leftHeaderColumnsNumber+"px",$.style.whiteSpace="normal",$.style.wordWrap="normal"),(this.controller.CONFIG.hideButtons||this.tablesStack.length<2)&&n.leftHeaderColumnsNumber===0&&(W.style.display="none"),ge(n.leftHeaderColumnsNumber,i[0].length,0,n.topHeaderRowsNumber,s),ge(0,n.leftHeaderColumnsNumber,he=n.topHeaderRowsNumber+(this.pagination.page*this.pagination.rows||0),fe=this.pagination.on?Math.min(he+this.pagination.rows,i.length):i.length,C),m=he;m<fe;m++){for(z=document.createElement("tr"),f=n.leftHeaderColumnsNumber;f<i[0].length;f++)oe=this.controller.getPivotProperty(["cellStyle"])||"",z.appendChild(T=document.createElement("td")),T.appendChild(de=document.createElement("div")),f===n.leftHeaderColumnsNumber&&pe.push(T),me(i[m][f].value,de,o[m]&&o[m].format||l[f].format),a&&!(n.SUMMARY_SHOWN&&i.length-1===m)&&(ae=(parseFloat(i[m][f].value)-a.min)/a.diff,oe+="background:rgb("+ +Math.round((a.to.r-a.from.r)*ae+a.from.r)+","+Math.round((a.to.g-a.from.g)*ae+a.from.g)+","+Math.round((a.to.b-a.from.b)*ae+a.from.b)+");"+(a.invert?"color: white;":"")),(l[f].style||o[m]&&o[m].style)&&(oe+=(o[m]&&o[m].style||"")+(o[m]&&o[m].style?" ":"")+(l[f].style||"")),i[m][f].style&&(oe+=i[m][f].style),this.controller.CONFIG.conditionalFormattingOn&&!(n.SUMMARY_SHOWN&&i.length-1===m)&&!this.getCurrentTableData().opts.disableConditionalFormatting&&this.applyConditionalFormatting(t.conditionalFormatting,m-n.topHeaderRowsNumber+1+","+(f-n.leftHeaderColumnsNumber+1),i[m][f].value,T),oe&&T.setAttribute("style",(T.getAttribute("style")||"")+oe),T.addEventListener(u,function(_,R,Y){return function(M){r._cellClickHandler.call(r,Y,_,R,M,n.drillThroughHandler)}}(f,m,i[m][f]));x.appendChild(z)}if(H.addEventListener("scroll",function(){if(H._ISE){H._ISE=!1;return}k.scrollLeft=H.scrollLeft,U.scrollTop=H.scrollTop,k._ISE=!0,U._ISE=!0}),U.className="lpt-leftHeader",k.className="lpt-topHeader",this.controller.CONFIG.enableHeadersScrolling&&(U.className=U.className+" lpt-scrollable-y",k.className=k.className+" lpt-scrollable-x",U.addEventListener("scroll",function(){if(U._ISE){U._ISE=!1;return}H.scrollTop=U.scrollTop,H._ISE=!0}),k.addEventListener("scroll",function(){if(k._ISE){k._ISE=!1;return}H.scrollLeft=k.scrollLeft,H._ISE=!0})),H.className="lpt-tableBlock",$.className="lpt-header",F.className="lpt-topSection",V.className="lpt-bottomSection",W.className+="lpt-headerValue",S.appendChild(x),H.appendChild(S),g.appendChild(C),U.appendChild(g),c.appendChild(s),k.appendChild(c),$.appendChild(W),F.appendChild($),F.appendChild(k),V.appendChild(U),V.appendChild(H),E.appendChild(F),E.appendChild(V),this.controller.CONFIG.stretchColumns||(c.style.width="auto"),Z){Z.className="lpt-pageSwitcher",w=function(R,Y){for(var M=0,J=[R];R>1;)R=Math.max(1,R-(M||1)),J.unshift(R),M=M*M+1;for(M=0,R=J[J.length-1];R<Y;)R=Math.min(Y,R+(M||1)),J.push(R),M=M*M+1;return J}(this.pagination.page+1,this.pagination.pages),this.controller.CONFIG.showListingRowsNumber&&(T=document.createElement("div"),z=document.createElement("span"),z.className="lpt-icon-rows",T.className="lpt-bottomInfo",T.appendChild(z),z=document.createElement("span"),z.textContent=t.rawData.length-(t.info.topHeaderRowsNumber||0)-(t.info.SUMMARY_SHOWN?1:0),T.appendChild(z),y.appendChild(T));for(P in w)P=parseInt(P),T=document.createElement("span"),w[P]===this.pagination.page+1&&(T.className="lpt-active"),T.textContent=w[P],function(_){T.addEventListener(u,function(){r._pageSwitcherHandler.call(r,_-1)})}(w[P]),y.appendChild(T),w[P+1]&&w[P]+1!==w[P+1]&&(T=document.createElement("span"),T.className="lpt-pageSpacer",y.appendChild(T));Z.appendChild(y),E.appendChild(Z)}if(v){D.className="lpt-searchIcon",I.className="lpt-searchSelectOuter",N.className="lpt-searchBlock",G.className="lpt-searchInput",b.className="lpt-searchSelect";for(P in K)T=document.createElement("option"),T.setAttribute("value",K[P].columnIndex.toString()),T.textContent=K[P].value,b.appendChild(T);G.addEventListener("input",function(){var _=parseInt(b.options[b.selectedIndex].value),R=G.value;r.saveScrollPosition(),r.savedSearch.value=R,r.savedSearch.columnIndex=_,r.savedSearch.restore=!0,r.controller.dataController.filterByValue(R,_),r.restoreScrollPosition()}),N.appendChild(D),I.appendChild(b),N.appendChild(I),N.appendChild(G),E.insertBefore(N,F),this.elements.searchInput=G,this.elements.searchSelect=b,this.savedSearch.restore&&(this.elements.searchInput.value=this.savedSearch.value,this.elements.searchSelect.value=this.savedSearch.columnIndex)}else this.elements.searchInput=void 0,this.elements.searchSelect=void 0;E._primaryColumns=ie,E._primaryRows=ue,E._primaryCells=pe,E._listing=d,this.recalculateSizes(E),this.savedSearch.restore&&(this.elements.searchInput.focus(),Ce(this.elements.searchInput,this.savedSearch.value.length)),typeof this.controller.CONFIG.triggers.contentRendered=="function"&&this.controller.CONFIG.triggers.contentRendered(this.controller)},LightPivotTable}();
