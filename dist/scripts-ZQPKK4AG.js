/** LightPivotTable
 ** A lightweight pivot table for MDX2JSON source for InterSystems Cache
 ** @author ZitRo
 ** @version 1.8.14
 ** @license Apache 2.0
 ** @see https://github.com/ZitRos/LightPivotTable
 **/LightPivotTable=function(){var DataController=function(t,r){if(r&&typeof r!="function")throw new Error("dataChangeTrigger parameter must be a function");this._dataStack=[],this.controller=t,this.pushData(),this.dataChangeTrigger=r,this.SUMMARY_SHOWN=!1};DataController.prototype.isValidData=function(t){return t.dimensions instanceof Array&&t.dimensions[0]instanceof Array&&!t.dimensions[0].length&&(t.dimensions[0]=[{}]),t.dimensions instanceof Array&&t.dimensions[0]instanceof Array&&t.dataArray instanceof Array&&typeof t.info=="object"&&t.info.cubeName},DataController.prototype.pushData=function(){var t;this._dataStack.push(t={data:null,SUMMARY_SHOWN:this.SUMMARY_SHOWN,SORT_STATE:{column:null,order:-1}}),this.SORT_STATE=t.SORT_STATE},DataController.prototype.popData=function(){if(!(this._dataStack.length<2)){var t=this._dataStack[this._dataStack.length-2];this._dataStack.pop(),this.SUMMARY_SHOWN=t.SUMMARY_SHOWN,this.SORT_STATE=t.SORT_STATE}},DataController.prototype.getData=function(){return this._dataStack[this._dataStack.length-1].data||{}},DataController.prototype.setData=function(t){if(!this.isValidData(t)){console.error("Invalid data to set.",t);return}return this._dataStack[this._dataStack.length-1].data=t,this.setLeftHeaderColumnsNumber(t),this.pivotDataProcess(t),this.resetDimensionProps(),this.resetConditionalFormatting(),this.resetRawData(),this.modifyRawData(t),this.postDataProcessing(t),t.info.mdxType==="drillthrough"&&this.setDrillThroughHandler(this.controller.pivotView.listingClickHandler.bind(this.controller.pivotView)),this._trigger(),t},DataController.prototype.pivotDataProcess=function(t){var r=this.controller.getPivotProperty(["rowTotals"]);typeof r=="boolean"&&(this.controller.CONFIG.showSummary=r)},DataController.prototype.setDrillThroughHandler=function(t){this._dataStack[this._dataStack.length-1].data.info.drillThroughHandler=t},DataController.prototype.resetDimensionProps=function(){var t,r,i;if(!(t=this._dataStack[this._dataStack.length-1].data)){console.error("Unable to get dimension props for given data set.");return}r=[],i=[];var n=function(o){var a,u={};for(a in o)u[a]=o[a];return u},l=function(o,a,u){var p,f,m;if(a.children&&a.children.length>0)for(m in a.children)f=n(u),p=a.children[m],p.format&&(f.format=p.format),p.style&&(f.style=(f.style||"")+p.style),p.summary&&(f.summary=p.summary),p.total&&(f.summary=(p.total||"").toLowerCase().replace(/:.*/,"")),p.type&&(f.type=p.type),l(o,p,f);else o.push(n(u))};l(r,{children:t.dimensions[0]},{}),l(i,{children:t.dimensions[1]},{}),t.columnProps=r,t.rowProps=i},DataController.prototype.getTypeByValue=function(t){return isNaN(t)?(t+"").match(/[0-9]{2}\.[0-9]{2}\.[0-9]{2,4}/)?{type:"date",comparator:function(r){var i=r.split(".");return new Date(i[2],i[1],i[0])}}:Date.parse(t)?{type:"date",comparator:function(r){return new Date(r)}}:{type:"string"}:{type:"number"}},DataController.prototype.postDataProcessing=function(t){var r,i;if(!(!t||!t.rawData||!t.rawData[t.info.topHeaderRowsNumber]))for(t.columnProps||(t.columnProps=[]),i=t.info.leftHeaderColumnsNumber;r=t.rawData[t.info.topHeaderRowsNumber][i];i++)t.columnProps[i]||(t.columnProps[i]={}),t.columnProps[i].$FORMAT=this.getTypeByValue(r.value)},DataController.prototype.resetConditionalFormatting=function(){var t,r,i,n,l,o,a,u={},p;if(!(t=this._dataStack[this._dataStack.length-1].data)){console.error("Unable to get conditional formatting for given data set.");return}if(!this.controller.CONFIG.pivotProperties){t.conditionalFormatting=u;return}(r=this.controller.CONFIG.pivotProperties.colorScale)&&(r.indexOf("custom:")>-1?(l=r.split(":")[1].split(","),n={r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])},l=r.split(":")[2].split(","),i={r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])}):(l=r.split("-to-"),i=this.controller.pivotView.colorNameToRGB(l[0]),n=this.controller.pivotView.colorNameToRGB(l[1])),u.colorScale={from:n,to:i,min:o=Math.min.apply(Math,t.dataArray||[]),max:a=Math.max.apply(Math,t.dataArray||[]),diff:a-o,invert:(n.r+n.b+n.g)/3<128}),p=this.controller.CONFIG.pivotProperties.formatRules||[],p.length&&typeof this.controller.CONFIG.conditionalFormattingOn>"u"&&(this.controller.CONFIG.conditionalFormattingOn=!0);for(var f in p)u[p[f].range]||(u[p[f].range]=[]),u[p[f].range].push(p[f]);t.conditionalFormatting=u},DataController.prototype.TOTAL_FUNCTIONS={isNumber:function(t){return t==""?!1:isFinite(t)},totalSUM:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var p=typeof o>"u"?u:o,f=typeof n>"u"?u:n;t[p]&&t[p][f]&&this.isNumber(t[p][f].value)&&(a+=parseFloat(t[p][f].value)||0)}return a},totalAVG:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var p=typeof o>"u"?u:o,f=typeof n>"u"?u:n;if(!this.isNumber(t[p][f].value)){a=0;break}a+=parseFloat(t[p][f].value)||0}return a/(i-r)||""},totalCOUNT:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var p=typeof o>"u"?u:o,f=typeof n>"u"?u:n;t[p][f].value&&a++}return a},totalMIN:function(t,r,i,n,l,o){for(var a=1/0,u=r;u<i;u++){var p=typeof o>"u"?u:o,f=typeof n>"u"?u:n;this.isNumber(t[p][f].value)&&t[p][f].value<a&&(a=t[p][f].value)}return a},totalMAX:function(t,r,i,n,l,o){for(var a=-1/0,u=r;u<i;u++){var p=typeof o>"u"?u:o,f=typeof n>"u"?u:n;this.isNumber(t[p][f].value)&&t[p][f].value>a&&(a=t[p][f].value)}return a},totalPERCENTAGE:function(t,r,i,n,l,o,a){if(a&&o===t.length-1)return"100%";var u=[],p,f,m=a?1:0;for(p=l;p<(typeof n>"u"?t.length-m:t[0].length);p++)u.push(this.totalSUM(t,r,i,typeof n>"u"?n:p,l,typeof o>"u"?o:p));return f=u.reduce(function(v,D){return v+D}),(u[(typeof o>"u"?n:o)-l]/f*100||0).toFixed(2)+"%"},totalNONE:function(){return""}},DataController.prototype.setLeftHeaderColumnsNumber=function(t){function r(i,n){if(!(i.children instanceof Array))return n;for(var l=n+1,o=0;o<i.children.length;o++)n=Math.max(r(i.children[o],l),n);return n}t.info.leftHeaderColumnsNumber=r({children:t.dimensions[1]||[]},0)},DataController.prototype.resetRawData=function(){var t="font-weight: bold;text-align: right;",r,i,n,l,o,a=this;if(!(r=this._dataStack[this._dataStack.length-1].data))return console.error("Unable to create raw data for given data set."),null;var u=[],p=[],f=2,m=[],v=a.controller.CONFIG.pivotProperties&&a.controller.CONFIG.pivotProperties.hideMeasures===2,D=function(R){return Object.keys(R[0]).map(function(y){return R.map(function(_){return _[y]})})},A=function(R,y,_){Z(u,y,_,!0);var L,G=0;for(L in u)u[L].length>G&&(G=u[L].length);for(L in u)for(var F=u[L].length;F<G;F++)u[L].push(u[L][u[L].length-1]);u=D(u)},E=function(R,y){a.controller.CONFIG.pivotProperties&&(a.controller.CONFIG.pivotProperties.columnHeaderStyle&&y?R.style=a.controller.CONFIG.pivotProperties.columnHeaderStyle:a.controller.CONFIG.pivotProperties.rowHeaderStyle&&!y&&(R.style=a.controller.CONFIG.pivotProperties.rowHeaderStyle))},H=function(R,y){typeof y>"u"&&(y=0);function _(L,G){if(L.children){var F=0;for(var k in L.children)F=Math.max(F,_(L.children[k],G+1));return F}else return L.type==="msr"&&v?G-1:G}return R.reduce(function(L,G){return Math.max(L,_(G,1))},y)},Z=function(R,y,_,L,G,F){var k,d,h;_||(_=[]);for(var I in y)k=f,G<F&&!(y[I].children&&y[I].children.length)&&(y[I].children=[{}],h=!0),y[I].children&&y[I].children.length?(h?h=!1:f++,d={group:k,source:y[I],isCaption:!0,value:y[I].caption||""},E(d,L),Z(R,y[I].children,_.concat(d),L,G&&G+1,F)):(d={group:f,source:y[I],isCaption:!0,value:y[I].caption||""},E(d,L),R.push(y[I].type==="msr"&&v?_:_.concat(d)),f++)},K=function(R){if(!a.controller.CONFIG.pivotProperties)return R;var y,_,L,G=R[0].length,F=a.controller.getPivotProperty(["columnLevels"]),k=a.controller.getPivotProperty(["rowLevels"]),d={},h={},I=function(T,q){if(!(typeof q>"u"))for(var Y in q.childLevels)q.childLevels[Y]&&q.childLevels[Y].spec&&(T[(q.childLevels[Y].spec||"").replace(/[^.]*$/,"")]={style:q.childLevels[Y].levelStyle||"",headStyle:q.childLevels[Y].levelHeaderStyle||""}),I(q.childLevels[Y])};for(L in F)I(d,{childLevels:[F[L]]}),I(h,{childLevels:[k[L]]});for(_=0;_<R.length;_++)for(y=0;y<G;y++){if(!R[_][y].isCaption){G=y;break}if(R[_][y].source&&R[_][y].source.path){var le=r.info.topHeaderRowsNumber>_?d:h;for(L in le)if(R[_][y].source.path.indexOf(L)>=0){R[_][y].isCaption?le[L].headStyle&&(R[_][y].style=(R[_][y].style||"")+le[L].headStyle||""):le[L].style&&(R[_][y].style=(R[_][y].style||"")+le[L].style||"");break}}}return R};if(r.dimensions[0].length&&A(u,r.dimensions[0]),r.dimensions[1].length&&Z(p,r.dimensions[1],void 0,void 0,1,H(r.dimensions[1])),p[0]){var V=p[0][p[0].length-1]||{source:{}},X=V.source||{};o=X.dimension||X.property||X.title||""}var J=(u[0]||[]).length,z=p.length||r.info.rowCount||0,c=u.length||r.info.colCount||0,s=(p[0]||[]).length,g=!!this.controller.CONFIG.attachTotals;for(n=0;n<c+z;n++)for(m[n]||(m[n]=[]),l=0;l<s+J;l++)l<s?n<c?(m[n][l]={group:1,isCaption:!0,value:this.controller.getPivotProperty(["showRowCaption"])===!1?"":this.controller.CONFIG.caption||o||(r.info||{}).cubeName||""},E(m[n][l],!1)):m[n][l]=p[n-c][l]:n<c?m[n][l]=u[n][l-s]:m[n][l]={value:r.dataArray[J*(n-c)+l-s]};for(r.info.topHeaderRowsNumber=c,r.info.SUMMARY_SHOWN=!1,r.info.leftHeaderColumnsNumber=s,this.SUMMARY_SHOWN=!1,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!1,w=0;w<r.info.leftHeaderColumnsNumber;w++)r.columnProps.unshift({});for(w=0;w<r.info.topHeaderRowsNumber;w++)r.rowProps.unshift({});var C=function(R,y){var _=a.controller.getPivotProperty(["rowTotalAgg"])||"sum",L=a.controller.getPivotProperty(["columnTotalAgg"])||"sum",G=y?"rowProps":"columnProps";if(!r[G][R]&&!(y?L:_))return a.TOTAL_FUNCTIONS.totalSUM;switch((r[G][R]||{}).summary||(y?L:_)){case"count":return a.TOTAL_FUNCTIONS.totalSUM;case"avg":return a.TOTAL_FUNCTIONS.totalAVG;case"min":return a.TOTAL_FUNCTIONS.totalMIN;case"max":return a.TOTAL_FUNCTIONS.totalMAX;case"pct":return a.TOTAL_FUNCTIONS.totalPERCENTAGE;case"none":return a.TOTAL_FUNCTIONS.totalNONE;default:return a.TOTAL_FUNCTIONS.totalSUM}};if(this.controller.CONFIG.showSummary&&m.length-r.info.topHeaderRowsNumber>1&&(m[m.length-1][0]||{}).isCaption){r.info.SUMMARY_SHOWN=!0,this.SUMMARY_SHOWN=!0,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!0,i=[],l=m.length-2;for(var w in m[l])m[l][w].isCaption?(i[w]={group:f,isCaption:!0,source:{},noDrillDown:!0,value:pivotLocale.get(0)},E(i[w],!1)):i[w]={value:C(parseInt(w)).call(this.TOTAL_FUNCTIONS,m,c,m.length,w,r.info.leftHeaderColumnsNumber),style:t};f++,g?(m.splice(r.info.topHeaderRowsNumber,0,i),r.info.topHeaderRowsNumber++):m.push(i)}if(this.controller.getPivotProperty(["columnTotals"])&&m.length-r.info.topHeaderRowsNumber>1&&r.info.leftHeaderColumnsNumber>0){var P=++f,S;for(S=0;S<r.info.topHeaderRowsNumber;S++){var Q=C(S,!0),O=Q===a.TOTAL_FUNCTIONS.totalPERCENTAGE?pivotLocale.get(5):pivotLocale.get(0);m[S].push({group:P,isCaption:!0,value:O})}for(S=r.info.topHeaderRowsNumber;S<m.length;S++){var U=this.controller.getPivotProperty(["rowTotals"]),ne=this.controller.getPivotProperty(["columnTotals"]);m[S].push({isCaption:!0,value:C(S,!0).call(this.TOTAL_FUNCTIONS,m,r.info.leftHeaderColumnsNumber,m[S].length,void 0,r.info.leftHeaderColumnsNumber,S,U&&ne),style:t})}}return m=K(m),r.rawData=r._rawDataOrigin=m,r.rawData},DataController.prototype._trigger=function(){this.dataChangeTrigger&&this.dataChangeTrigger()},DataController.prototype.sortByColumn=function(t){var r=this._dataStack[this._dataStack.length-1].data,i=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,n;this.SORT_STATE.column!==t&&(a=this.SORT_STATE.order=0);var l=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!i?1:0)),o=r.info.leftHeaderColumnsNumber+t,a=this.SORT_STATE.order===-1?1:this.SORT_STATE.order===1?0:-1;this.SORT_STATE.order=a,this.SORT_STATE.column=t;for(var u in r.rawData[r.info.topHeaderRowsNumber-i-1])r.rawData[r.info.topHeaderRowsNumber-i-1][u].className&&delete r.rawData[r.info.topHeaderRowsNumber-i-1][u].className;if(a===0){r.rawData=r._rawDataOrigin,this.modifyRawData(r),this._trigger();return}a=-a,typeof(n=((r.columnProps[t]||{}).$FORMAT||{}).comparator)=="function"?l.sort(function(p,f){return n(f[o].value)>n(p[o].value)?a:n(f[o].value)<n(p[o].value)?-a:0}):l.sort(function(p,f){return f[o].value>p[o].value?a:f[o].value<p[o].value?-a:0}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(l).concat(this.SUMMARY_SHOWN&&!i?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),r.rawData[r.info.topHeaderRowsNumber-i-1][r.info.leftHeaderColumnsNumber+t].className=a===0?"":a===1?"lpt-sortDesc":"lpt-sortAsc",this.modifyRawData(r),this._trigger()},DataController.prototype.filterByValue=function(t,r){var i=this._dataStack[this._dataStack.length-1].data,n=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,l=i._rawDataOrigin.slice(i.info.topHeaderRowsNumber,i._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!n?1:0)),o=null;try{o=new RegExp(t,"i")}catch{try{o=new RegExp(t.replace(/([()[{*+.$^\\|?])/g,"\\$1"),"i")}catch{return}}l=l.filter(function(a){return(a[r].value||"").toString().match(o)}),i.rawData=i._rawDataOrigin.slice(0,i.info.topHeaderRowsNumber).concat(l).concat(this.SUMMARY_SHOWN&&!n?[i._rawDataOrigin[i._rawDataOrigin.length-1]]:[]),this.modifyRawData(i),this._trigger()},DataController.prototype.modifyRawData=function(t){var r=-1;this.controller.CONFIG.showRowNumbers&&!t.info.leftHeaderColumnsNumber&&(t.rawData[0]&&t.rawData[0][0].special?t.rawData.forEach(function(n){n[0].value=++r===0?"#":r,n[0].isCaption=r===0}):(t.rawData.forEach(function(n){n.unshift({value:++r===0?"#":r,isCaption:r===0,special:!0,noClick:!0})}),t.columnProps instanceof Array&&t.columnProps.unshift({}),t.info.colCount++));var i=t.info.topHeaderRowsNumber-1;for(r=t.info.leftHeaderColumnsNumber;r<t.rawData[i].length;r++)t.rawData[i][r].style="min-width:"+(this.controller.getPivotProperty(["cellWidth"])||100)+"px;"+(t.rawData[i][r].style?t.rawData[i][r].style:"")};var DataSource=function(t,r,i,n){this.SOURCE_URL=t.MDX2JSONSource||location.host+":"+location.port+"/"+(location.pathname.split("/")||[])[1],this.NAMESPACE=t.namespace,this.USERNAME=t.username,this.PASSWORD=t.password,this.LPT=i,this.GLOBAL_CONFIG=r,this.SEND_COOKIES=t.sendCookies||!1,this.DRILL_LEVEL=typeof n!="number"?1:n,this.BASIC_MDX=t.basicMDX,this.DATA_SOURCE_PIVOT=t.pivot||"",this.FILTERS=[]};DataSource.prototype._post=function(url,data,callback){var xhr=new XMLHttpRequest,self=this;xhr.open("POST",url),this.SEND_COOKIES&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){var handler;xhr.readyState===4&&(handler=self.LPT.CONFIG.triggers.responseHandler,typeof handler=="function"&&handler.call(self.LPT,{url,status:xhr.status,xhr})),xhr.readyState===4&&xhr.status===200?callback(function(){try{return JSON.parse(xhr.responseText)||{}}catch(e){try{var temp=null;return eval("temp="+xhr.responseText),temp}catch(t){return{error:"<h1>Unable to parse server response</h1><p>"+xhr.responseText+"</p>"}}}}()):xhr.readyState===4&&xhr.status!==200&&callback({error:xhr.responseText||pivotLocale.get(3)+"<br/>"+xhr.status+": "+xhr.statusText})},this.USERNAME&&this.PASSWORD&&xhr.setRequestHeader("Authorization","Basic "+btoa(this.USERNAME+":"+this.PASSWORD)),xhr.send(JSON.stringify(data))},DataSource.prototype._convert=function(t){var r;if(typeof t!="object"||t.error)return{error:t.error||!0};try{return r={dimensions:[t.Cols[0].tuples,t.Cols[1]?t.Cols[1].tuples:[{caption:""}]],dataArray:t.Data,info:t.Info},r}catch(i){return console.error("Error while parsing data:",i),{error:t.error||!0}}},DataSource.prototype.setFilter=function(t){this.FILTERS.push(t)},DataSource.prototype.clearFilters=function(){this.FILTERS=[]},DataSource.prototype.getCurrentData=function(t){for(var r=this,i=this._convert,n=this.BASIC_MDX,l=new MDXParser,o=l.mdxType(n),a={state:0,data:{},pivotData:{}},u=0;u<this.FILTERS.length;u++)n=l.applyFilter(n,this.FILTERS[u]);typeof this.GLOBAL_CONFIG.rowCount=="number"&&(n=l.applyRowCount(n,this.GLOBAL_CONFIG.rowCount));var p=function(){var v=a.pivotData;r.GLOBAL_CONFIG.pivotProperties=a.pivotData,v.rowAxisOptions&&(v.rowAxisOptions.drilldownSpec&&(r.GLOBAL_CONFIG.DrillDownExpression=r.GLOBAL_CONFIG.DrillDownExpression||v.rowAxisOptions.drilldownSpec.split("^")),(v.rowAxisOptions.levelFormat||v.columnAxisOptions&&v.columnAxisOptions.levelFormat)&&(r.GLOBAL_CONFIG.formatNumbers=r.GLOBAL_CONFIG.formatNumbers||v.columnAxisOptions.levelFormat||v.rowAxisOptions.levelFormat))},f=function(){var v=a.data;if(o==="drillthrough")t(function(D){var A=D.children||[],E=[],H,Z,K;if(!A.length)return{error:pivotLocale.get(4)};for(Z in A[0])E.push({caption:Z});H={Cols:[{tuples:E},{tuples:[]}],Data:[],Info:{colCount:8,cubeClass:"No cube class",cubeName:"No cube name",leftHeaderColumnsNumber:0,rowCount:A.length,topHeaderRowsNumber:E.length,mdxType:o}};for(Z in A)for(K in A[Z])H.Data.push(A[Z][K]);return i(H)}(v));else if(o==="mdx"){if(!v||!v.Data||!v.Data.length||!v.Cols||!v.Data.length&&!((v.Cols[0]||{}).tuples||[]).length&&!((v.Cols[1]||{}).tuples||[]).length)return t({error:pivotLocale.get(4)});t(r._convert(v))}else t({error:"Unrecognised MDX type: "+n||!0})},m=function(){r.LPT.CONFIG.logs&&console.log("LPT MDX request:",n);var v=function(D){r.LPT.pivotView.removeMessage(),a.data=D,a.state++,f()};if(r.DRILL_LEVEL===0&&r.LPT.CONFIG.initialData){v(r.LPT.CONFIG.initialData);return}r._post(r.SOURCE_URL+"/"+(o==="drillthrough"?"MDXDrillthrough":"MDX")+(r.NAMESPACE?"?Namespace="+r.NAMESPACE:""),{MDX:n},v)};r.LPT.pivotView.displayLoading(),this.DATA_SOURCE_PIVOT?this._post(this.SOURCE_URL+"/DataSource"+(r.NAMESPACE?"?Namespace="+r.NAMESPACE:""),{DataSource:this.DATA_SOURCE_PIVOT},function(v){a.pivotData=v,a.state++,p(),m()}):(r.GLOBAL_CONFIG.pivotProperties={},m())};var ExcelExport=function(){};ExcelExport.prototype.exportTableHTML=function(){var t="data:application/vnd.ms-excel;base64,",r='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',i=function(l){return window.btoa(unescape(encodeURIComponent(l)))},n=function(l,o){return l.replace(/{(\w+)}/g,function(a,u){return o[u]})};return function(l,o){var a={worksheet:o||"Worksheet",table:l};console.log(t+i(n(r,a))),window.location.href=t+i(n(r,a))}}(),ExcelExport.prototype.exportXLS=function(){var t=document.getElementsByClassName("lpt")[0],r=t.getElementsByClassName("lpt-tableBlock")[0].getElementsByTagName("table")[0].innerHTML,i=t.getElementsByClassName("lpt-topHeader")[0].getElementsByTagName("table")[0].innerHTML.replace(/<tr>/,"<tr><th colspan='2'></th>"),n=t.getElementsByClassName("lpt-leftHeader")[0].getElementsByTagName("thead")[0].innerHTML,l=n.match("<tr>(.*)</tr>")[1].split("</tr><tr>"),o=0;r=r.replace(/<tr>/g,function(){return"<tr>"+l[o++]}),console.log(i+r),this.exportTableHTML(i+r,"test")};var LightPivotTable=function(t){var r=this;typeof t!="object"&&(t={}),this.normalizeConfiguration(t),this._dataSourcesStack=[],this.DRILL_LEVEL=-1,this.CONFIG=t,this.VERSION="".concat("1.8.14")||"[NotBuilt]",this.CONTROLS={},this.mdxParser=new MDXParser,this.pivotView=new PivotView(this,t.container),this.dataSource=this.pushDataSource(t.dataSource),this.dataController=new DataController(this,function(){r.dataIsChanged.call(r)}),this.init()};LightPivotTable.prototype.refresh=function(){var t=this,r;if(!this.dataSource.BASIC_MDX){console.log("Unable to refresh: no basic MDX set.");return}if(this.clearFilters(),this.CONFIG.defaultFilterSpecs instanceof Array)for(r in this.CONFIG.defaultFilterSpecs)this.setFilter(this.CONFIG.defaultFilterSpecs[r]);this.dataSource.getCurrentData(function(i){t.dataController.isValidData(i)?t.dataController.setData(i):t.pivotView.displayMessage(i.error||pivotLocale.get(2))})},LightPivotTable.prototype.changeBasicMDX=function(t){for(var r=this._dataSourcesStack.length-1;r>0;r--)this.popDataSource(),this.pivotView.popTable(),this.dataController.popData();this.CONFIG.dataSource.basicMDX=t,this.dataSource.BASIC_MDX=t,this.refresh()},LightPivotTable.prototype.setRowCount=function(t){this.CONFIG.rowCount=t},LightPivotTable.prototype.getActualMDX=function(){var t=this.dataSource.BASIC_MDX,r=new MDXParser,i=this.dataSource.FILTERS;for(var n in i)t=r.applyFilter(t,i[n]);return typeof this.CONFIG.rowCount=="number"&&(t=r.applyRowCount(t,this.CONFIG.rowCount)),t},LightPivotTable.prototype.isListing=function(){return(this.dataController.getData().info||{}).leftHeaderColumnsNumber===0},LightPivotTable.prototype.getSelectedRows=function(){var t=[],r=this.pivotView.selectedRows,i;for(i in r)r[i]&&t.push(+i);return t},LightPivotTable.prototype.getRowsValues=function(t){if(typeof t>"u")return[];if(t instanceof Array||(t=[t]),t.length===0)return[];for(var r=this.dataController.getData(),i=[],n=0;n<t.length;n++)i.push(r.rawData[t[n]-1+(r.info.topHeaderRowsNumber||1)]);return i},LightPivotTable.prototype.getModel=function(){return this.dataController.getData()},LightPivotTable.prototype.updateSizes=function(){this.pivotView.updateSizes()},LightPivotTable.prototype.setFilter=function(t){this.dataSource.setFilter(t)},LightPivotTable.prototype.clearFilters=function(){this.dataSource.clearFilters()},LightPivotTable.prototype.pushDataSource=function(t){var r;return this.DRILL_LEVEL++,this._dataSourcesStack.push(r=new DataSource(t||{},this.CONFIG,this,this.DRILL_LEVEL)),this.dataSource=r,r},LightPivotTable.prototype.popDataSource=function(t){this._dataSourcesStack.length<2||(this.DRILL_LEVEL--,this._dataSourcesStack.pop(),t||this.dataController.popData(),this.dataSource=this._dataSourcesStack[this._dataSourcesStack.length-1])},LightPivotTable.prototype.dataIsChanged=function(){this.pivotView.dataChanged(this.dataController.getData())},LightPivotTable.prototype.tryDrillDown=function(t){var r=this,i,n={};for(var l in r.CONFIG.dataSource)n[l]=r.CONFIG.dataSource[l];this.CONFIG.DrillDownExpression&&!(this.CONFIG.DrillDownExpression instanceof Array)&&(this.CONFIG.DrillDownExpression=[this.CONFIG.DrillDownExpression]),(this.CONFIG.DrillDownExpression||[])[this.DRILL_LEVEL]?n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,t,this.CONFIG.DrillDownExpression[this.DRILL_LEVEL])||this.dataSource.BASIC_MDX:n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,t)||this.dataSource.BASIC_MDX,i=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=i.FILTERS,this.dataSource.getCurrentData(function(o){r.dataController.isValidData(o)&&o.dataArray.length>0&&o.dimensions[1]&&o.dimensions[1][0]&&(o.dimensions[1][0].caption||o.dimensions[1][0].dimension||o.dimensions[1][0].path)?(r.pivotView.pushTable(),r.dataController.pushData(),r.dataController.setData(o),typeof r.CONFIG.triggers.drillDown=="function"&&r.CONFIG.triggers.drillDown.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX,path:o.dimensions[1][0].path||""})):r.popDataSource(!0)})},LightPivotTable.prototype.tryDrillThrough=function(t){var r=this,i,n={};for(var l in r.CONFIG.dataSource)n[l]=r.CONFIG.dataSource[l];const o=this.CONFIG.controls?.find(a=>a.action==="showListing")?.targetProperty;n.basicMDX=this.mdxParser.drillThrough(this.dataSource.BASIC_MDX,t,o)||this.dataSource.basicMDX,i=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=i.FILTERS,this.dataSource.getCurrentData(function(a){r.dataController.isValidData(a)&&a.dataArray.length>0?(r.pivotView.pushTable({disableConditionalFormatting:!0}),r.dataController.pushData(),r.dataController.setData(a),typeof r.CONFIG.triggers.drillThrough=="function"&&r.CONFIG.triggers.drillThrough.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX})):r.popDataSource(!0)})},LightPivotTable.prototype.getPivotProperty=function(t){if(this.CONFIG.pivotProperties){t instanceof Array||(t=[]);var r=this.CONFIG.pivotProperties;for(t=t.reverse();t.length&&typeof r<"u";)r=r[t.pop()];return r}},LightPivotTable.prototype.attachTrigger=function(t,r){if(typeof r!="function"){console.warn("LPT.addTrigger: pass the trigger as a second argument.");return}this.CONFIG.triggers[t]=r},LightPivotTable.prototype.normalizeConfiguration=function(t){typeof t.columnResizing>"u"&&(t.columnResizing=!0),typeof t.pagination>"u"&&(t.pagination=200),typeof t.enableSearch>"u"&&(t.enableSearch=!0),typeof t.stretchColumns>"u"&&(t.stretchColumns=!0),typeof t.enableListingSelect>"u"&&(t.enableListingSelect=!0),typeof t.showListingRowsNumber>"u"&&(t.showListingRowsNumber=!0),t.triggers||(t.triggers={}),t.dataSource||(t.dataSource={})},LightPivotTable.prototype.init=function(){var t=this;this.CONTROLS.drillThrough=function(){t.pivotView._drillThroughClickHandler.call(t.pivotView)},this.CONTROLS.customDrillThrough=function(r){if(!(r instanceof Array)){console.error('Parameter "filters" must be array of strings.');return}t.tryDrillThrough.call(t,r)},this.CONTROLS.back=function(){t.pivotView._backClickHandler.call(t.pivotView)},this.CONFIG.locale&&pivotLocale.setLocale(this.CONFIG.locale),this.refresh()};var MDXParser=function(){};MDXParser.prototype._warnMDX=function(t,r){console.warn(`MDX is not parsed:

%s

`+(r?"("+r+")":""),t)},MDXParser.prototype.makeSetExpressionFromFilter=function(t){return t.match(/^\([^\),]*,[^\)]*\)$/)?"NONEMPTYCROSSJOIN"+t.slice(0,t.length-1)+".children)":t+".children"},MDXParser.prototype.prependNonEmpty=function(t){return t.match(/^\s*non\s+empty/i)?t:"NON EMPTY "+t},MDXParser.prototype.applyRowCount=function(t,r){return t.replace(/\s*on\s*0\s*,\s*(?:non\s*empty\s*)?(.*)\s*on\s*1/i,function(i,n){return typeof r<"u"?" ON 0, NON EMPTY HEAD("+n+", "+r+") ON 1":i})},MDXParser.prototype.drillDown=function(t,r,i){if(!r)return/]\s+ON\s+1/i.test(t)?t=t.replace(/]\s+ON\s+1/i,"].children ON 1"):(this._warnMDX(t,"no filter specified"),"");var n=t.split(/(select\s*)(.*?)(\s*from)/ig);if(n.length<4)return this._warnMDX(t),"";var l=n[n.length-3],o=l.split(/(\s*ON\s*[01]\s*,?\s*)/i);if(o.length<2)return this._warnMDX(t,"DrillDown is impossible"),"";var a=-1;if(o.map(function(m,v){return m.match(/\s*ON\s*[01]\s*,?\s*/i)&&(a=v-1),m}),a===-1)return this._warnMDX(t,"DrillDown is impossible"),"";let u="";const p=o[a].match(/ORDER\((.*?)\,/);p&&p[0]&&(u=p[0]),u?o[a]=(i||o[a]).replace(u,"ORDER("+this.makeSetExpressionFromFilter(r)+","):o[a]=this.prependNonEmpty(i||this.makeSetExpressionFromFilter(r));for(var f in o)o[f].length===1&&o[f](parseInt(f),1);return n[n.length-3]=o.join(""),this.applyFilter(n.join(""),r)},MDXParser.prototype.drillThrough=function(t,r,i){var n=t.slice(t.lastIndexOf("FROM ")),l="DRILLTHROUGH SELECT "+n;for(var o in r)l=this.applyFilter(l,r[o]);return i&&(l+=` %LISTING [${i}]`),l},MDXParser.prototype.mdxType=function(t){var r=t.toLowerCase(),i=r.indexOf("drillthrough"),n=r.indexOf("select");return i>-1?"drillthrough":n>-1?"mdx":"unknown"},MDXParser.prototype.applyFilter=function(t,r){return t+(r?" %FILTER "+r:"")};/*!
 * numeral.js
 * version : 1.5.3
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */var numeral=function(){var t,r="1.5.3",i={},n="en",l=null,o="0,0",a=3,u=",",p=".",f=new RegExp("(\\d)(?=(\\d{"+a+"})+(?!\\d))","g");function m(c){this._value=c}function v(c,s,g,C){var w=Math.pow(10,s),P,S;return S=(g(c*w)/w).toFixed(s),C&&(P=new RegExp("0{1,"+C+"}$"),S=S.replace(P,"")),S}function D(c,s,g){var C;return s.indexOf("$")>-1?C=E(c,s,g):s.indexOf("%")>-1?C=H(c,s,g):s.indexOf(":")>-1?C=Z(c,s):C=V(c._value,s,g),C}function A(c,s){var g=s,C,w,P,S,Q=["KB","MB","GB","TB","PB","EB","ZB","YB"],O=!1,U;if(s.indexOf(":")>-1)c._value=K(s);else if(s===l)c._value=0;else{for(i[n].delimiters.decimal!=="."&&(s=s.replace(/\./g,"").replace(i[n].delimiters.decimal,".")),C=new RegExp("[^a-zA-Z]"+i[n].abbreviations.thousand+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),w=new RegExp("[^a-zA-Z]"+i[n].abbreviations.million+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),P=new RegExp("[^a-zA-Z]"+i[n].abbreviations.billion+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),S=new RegExp("[^a-zA-Z]"+i[n].abbreviations.trillion+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),U=0;U<=Q.length&&(O=s.indexOf(Q[U])>-1?Math.pow(1024,U+1):!1,!O);U++);c._value=(O||1)*(g.match(C)?Math.pow(10,3):1)*(g.match(w)?Math.pow(10,6):1)*(g.match(P)?Math.pow(10,9):1)*(g.match(S)?Math.pow(10,12):1)*(s.indexOf("%")>-1?.01:1)*((s.split("-").length+Math.min(s.split("(").length-1,s.split(")").length-1))%2?1:-1)*Number(s.replace(/[^0-9\.]+/g,"")),c._value=O?Math.ceil(c._value):c._value}return c._value}function E(c,s,g){var C=s.indexOf("$"),w=s.indexOf("("),P=s.indexOf("-"),S="",Q,O;return s.indexOf(" $")>-1?(S=" ",s=s.replace(" $","")):s.indexOf("$ ")>-1?(S=" ",s=s.replace("$ ","")):s=s.replace("$",""),O=V(c._value,s,g),C<=1?O.indexOf("(")>-1||O.indexOf("-")>-1?(O=O.split(""),Q=1,(C<w||C<P)&&(Q=0),O.splice(Q,0,i[n].currency.symbol+S),O=O.join("")):O=i[n].currency.symbol+S+O:O.indexOf(")")>-1?(O=O.split(""),O.splice(-1,0,S+i[n].currency.symbol),O=O.join("")):O=O+S+i[n].currency.symbol,O}function H(c,s,g){var C="",w,P=c._value*100;return s.indexOf(" %")>-1?(C=" ",s=s.replace(" %","")):s=s.replace("%",""),w=V(P,s,g),w.indexOf(")")>-1?(w=w.split(""),w.splice(-1,0,C+"%"),w=w.join("")):w=w+C+"%",w}function Z(c){var s=Math.floor(c._value/60/60),g=Math.floor((c._value-s*60*60)/60),C=Math.round(c._value-s*60*60-g*60);return s+":"+(g<10?"0"+g:g)+":"+(C<10?"0"+C:C)}function K(c){var s=c.split(":"),g=0;return s.length===3?(g=g+Number(s[0])*60*60,g=g+Number(s[1])*60,g=g+Number(s[2])):s.length===2&&(g=g+Number(s[0])*60,g=g+Number(s[1])),Number(g)}function V(c,s,g){var C=!1,w=!1,P=!1,S="",Q=!1,O=!1,U=!1,ne=!1,R=!1,y="",_="",L=Math.abs(c),G=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],F,k,d,h,I,le,T="",q=!1;if(c===0&&l!==null)return l;if(s.indexOf("(")>-1?(C=!0,s=s.slice(1,-1)):s.indexOf("+")>-1&&(w=!0,s=s.replace(/\+/g,"")),s.indexOf("a")>-1&&(Q=s.indexOf("aK")>=0,O=s.indexOf("aM")>=0,U=s.indexOf("aB")>=0,ne=s.indexOf("aT")>=0,R=Q||O||U||ne,s.indexOf(" a")>-1?(S=" ",s=s.replace(" a","")):s=s.replace("a",""),L>=Math.pow(10,12)&&!R||ne?(S=S+i[n].abbreviations.trillion,c=c/Math.pow(10,12)):L<Math.pow(10,12)&&L>=Math.pow(10,9)&&!R||U?(S=S+i[n].abbreviations.billion,c=c/Math.pow(10,9)):L<Math.pow(10,9)&&L>=Math.pow(10,6)&&!R||O?(S=S+i[n].abbreviations.million,c=c/Math.pow(10,6)):(L<Math.pow(10,6)&&L>=Math.pow(10,3)&&!R||Q)&&(S=S+i[n].abbreviations.thousand,c=c/Math.pow(10,3))),s.indexOf("b")>-1){for(s.indexOf(" b")>-1?(y=" ",s=s.replace(" b","")):s=s.replace("b",""),d=0;d<=G.length;d++)if(F=Math.pow(1024,d),k=Math.pow(1024,d+1),c>=F&&c<k){y=y+G[d],F>0&&(c=c/F);break}}return s.indexOf("o")>-1&&(s.indexOf(" o")>-1?(_=" ",s=s.replace(" o","")):s=s.replace("o",""),_=_+i[n].ordinal(c)),s.indexOf("[.]")>-1&&(P=!0,s=s.replace("[.]",".")),h=c.toString().split(".")[0],I=s.split(".")[1],le=s.indexOf(","),I?(I.indexOf("[")>-1?(I=I.replace("]",""),I=I.split("["),T=v(c,I[0].length+I[1].length,g,I[1].length)):T=v(c,I.length,g),h=T.split(".")[0],T.split(".")[1].length?T=(p||i[n].delimiters.decimal)+T.split(".")[1]:T="",P&&Number(T.slice(1))===0&&(T="")):h=v(c,null,g),h.indexOf("-")>-1&&(h=h.slice(1),q=!0),le>-1&&(h=h.toString().replace(f,"$1"+(u||i[n].delimiters.thousands))),s.indexOf(".")===0&&(h=""),(C&&q?"(":"")+(!C&&q?"-":"")+(!q&&w?"+":"")+h+T+(_||"")+(S||"")+(y||"")+(C&&q?")":"")}t=function(c){return t.isNumeral(c)?c=c.value():c===0||typeof c>"u"?c=0:Number(c)||(c=t.fn.unformat(c)),new m(Number(c))},t.version=r,t.isNumeral=function(c){return c instanceof m},t.language=function(c,s){if(!c)return n;if(c&&!s){if(!i[c])throw new Error("Unknown language : "+c);n=c}return(s||!i[c])&&X(c,s),t},t.languageData=function(c){if(!c)return i[n];if(!i[c])throw new Error("Unknown language : "+c);return i[c]},t.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(c){var s=c%10;return~~(c%100/10)===1?"th":s===1?"st":s===2?"nd":s===3?"rd":"th"},currency:{symbol:"$"}}),t.zeroFormat=function(c){l=typeof c=="string"?c:null},t.defaultFormat=function(c){o=typeof c=="string"?c:"0.0"};function X(c,s){i[c]=s}typeof Array.prototype.reduce!="function"&&(Array.prototype.reduce=function(c,s){"use strict";if(this===null||typeof this>"u")throw new TypeError("Array.prototype.reduce called on null or undefined");if(typeof c!="function")throw new TypeError(c+" is not a function");var g,C,w=this.length>>>0,P=!1;for(1<arguments.length&&(C=s,P=!0),g=0;w>g;++g)this.hasOwnProperty(g)&&(P?C=c(C,this[g],g,this):(C=this[g],P=!0));if(!P)throw new TypeError("Reduce of empty array with no initial value");return C});function J(c){var s=c.toString().split(".");return s.length<2?1:Math.pow(10,s[1].length)}function z(){var c=Array.prototype.slice.call(arguments);return c.reduce(function(s,g){var C=J(s),w=J(g);return C>w?C:w},-1/0)}t.setup=function(c,s,g){c!==p&&(p=c),s!==u&&(u=s),g!==a&&(a=g,f=new RegExp("(\\d)(?=(\\d{"+a+"})+(?!\\d))","g"))},t.fn=m.prototype={clone:function(){return t(this)},format:function(c,s){return D(this,c||o,s!==void 0?s:Math.round)},unformat:function(c){return Object.prototype.toString.call(c)==="[object Number]"?c:A(this,c||o)},value:function(){return this._value},valueOf:function(){return this._value},set:function(c){return this._value=Number(c),this},add:function(c){var s=z.call(null,this._value,c);function g(C,w,P,S){return C+s*w}return this._value=[this._value,c].reduce(g,0)/s,this},subtract:function(c){var s=z.call(null,this._value,c);function g(C,w,P,S){return C-s*w}return this._value=[c].reduce(g,this._value*s)/s,this},multiply:function(c){function s(g,C,w,P){var S=z(g,C);return g*S*(C*S)/(S*S)}return this._value=[this._value,c].reduce(s,1),this},divide:function(c){function s(g,C,w,P){var S=z(g,C);return g*S/(C*S)}return this._value=[this._value,c].reduce(s),this},difference:function(c){return Math.abs(t(this._value).subtract(c).value())}},this.numeral=t},PivotLocale=function(t){this.LOCALE="",this.DEFAULT_LOCALE="en",this.setLocale(t||(navigator.language||"").substr(0,2)||(navigator.browserLanguage||this.DEFAULT_LOCALE).substring(0,2))};PivotLocale.prototype.LOCALES=[{ru:"\u0412\u0441\u0435\u0433\u043E",en:"Total",de:"Summe",cs:"Celkem"},{ru:"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043E\u0431\u0440\u0430\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435",en:"Unable to render data",de:"Daten k\xF6nnen nicht rendern",cs:"Nebylo mo\u017En\xE9 zobrazit data"},{ru:"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F.",en:"Invalid data to display.",de:"Nicht korrekt Informationen angezeigt werden soll.",cs:"Nevhodn\xE1 data k zobrazen\xED"},{ru:"\u0412\u043E\u0437\u043D\u0438\u043A\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.",en:"Error while trying to retrieve data from server.",de:"Beim Abrufen der Daten vom Server ist ein Fehler aufgetreten.",cs:"Chyba p\u0159i pokusu o z\xEDsk\xE1n\xED dat ze serveru"},{ru:"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F.",en:"No data to display.",de:"Keine Daten zum anzeigen.",cs:"\u017D\xE1dn\xE1 data k zobrazen\xED"},{ru:"% \u043E\u0442 \u0412\u0441\u0435\u0433\u043E",en:"% of Total",de:"% des Summe",cs:"% z Celkem"},{ru:"\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C",en:"Copy",de:"Kopieren",cs:"Kop\xEDrovat"},{ru:"\u041C\u0435\u043D\u044E",en:"Menu",de:"Men\xFC",cs:"Nab\xEDdka"}],PivotLocale.prototype.setLocale=function(t){var r,i=[];if(t=t.toLowerCase(),this.LOCALES[0].hasOwnProperty(t))this.LOCALE=t;else{for(r in this.LOCALES[0])i.push(r);console.warn("LightPivot: locale "+t+" is not supported. Currently localized: "+i.join(", ")+"."),this.LOCALE="en"}},PivotLocale.prototype.get=function(t){return(this.LOCALES[t]||{})[this.LOCALE]||"{not localized: "+t+"}"};var pivotLocale=new PivotLocale,PivotView=function(t,r){if(!(r instanceof HTMLElement))throw new Error('Please, provide HTMLElement instance "container" into pivot table configuration.');this.tablesStack=[],this.selectedRows={},numeral.call(this),this.elements={container:r,base:document.createElement("div"),tableContainer:void 0,messageElement:void 0,searchSelect:void 0,searchInput:void 0},this.pagination=null,this.savedScroll={x:0,y:0},this.FIXED_COLUMN_SIZES=[],this.FIXED_LEFT_HEADER_SIZES={},this.PAGINATION_BLOCK_HEIGHT=20,this.ANIMATION_TIMEOUT=500,this.SEARCH_ENABLED=!1,this.SEARCHBOX_LEFT_MARGIN=191,this.savedSearch={restore:!1,value:"",columnIndex:0},this.controller=t,this.SCROLLBAR_WIDTH=function(){var i=document.createElement("div");i.style.visibility="hidden",i.style.width="100px",i.style.msOverflowStyle="scrollbar",document.body.appendChild(i);var n=i.offsetWidth;i.style.overflow="scroll";var l=document.createElement("div");l.style.width="100%",i.appendChild(l);var o=l.offsetWidth;return i.parentNode.removeChild(i),n-o}(),this.init()};return PivotView.prototype.init=function(){var t=this,r=this.elements;r.base.className="lpt",r.base.setAttribute("LPTVersion",this.controller.VERSION),r.container.appendChild(r.base),this.pushTable(),this.displayLoading(),window.addEventListener("resize",function(){t.updateSizes.call(t)}),this._=function(){t.displayMessage('<a href="https://github.com/ZitRos/LightPivotTable">LIGHT PIVOT TABLE v'+t.controller.VERSION+'</a><br/>by <a href="https://plus.google.com/+NikitaSavchenko">Nikita Savchenko</a><br/>for dear users of products of <a href="http://www.intersystems.com/">InterSystems Corporation</a><br/>Hope you enjoy it!',!0)}},PivotView.prototype.getCellElement=function(t,r,i){var n=this.tablesStack[this.tablesStack.length-1].element,l,o,a,u,p=function(f,m,v){var D=[],A,E,H,Z,K,V,X;for(X=0;X<f.rows.length;X++)for(A=f.rows[X],V=0;V<A.cells.length;V++){for(E=A.cells[V],H=V;D[X]&&D[X][H];++H);for(Z=H;Z<H+E.colSpan;++Z)for(K=X;K<X+E.rowSpan;++K)D[K]||(D[K]=[]),D[K][Z]=!0;if(H<=m&&m<H+E.colSpan&&X<=v&&v<X+E.rowSpan)return E}return null};if(i){if(l=n.getElementsByClassName("lpt-topHeader")[0],!l||(l=l.getElementsByTagName("table")[0],!l)||(o=0,[].slice.call(l.rows).forEach(function(f){o+=f.rowSpan||1}),u=n.getElementsByClassName("lpt-leftHeader")[0],!l)||(u=u.getElementsByTagName("table")[0],!l))return null;if(a=0,(this.getCurrentTableData().element||{})._listing||[].slice.call((u.rows[0]||{cells:[]}).cells).forEach(function(f){a+=f.colSpan||1}),t<a&&r<o)return n.getElementsByClassName("lpt-headerValue")[0]||null;if(t>=a&&r<o)return(p(l,t-a,r)||{childNodes:[null]}).childNodes[0];if(t<a&&r>=o)return(p(u,t,r-o)||{childNodes:[null]}).childNodes[0];t-=a,r-=o}return l=n.getElementsByClassName("lpt-tableBlock")[0],!l||(l=l.getElementsByTagName("table")[0],!l)?null:((l.rows[r]||{cells:[]}).cells[t]||{childNodes:[null]}).childNodes[0]},PivotView.prototype.getTableSize=function(t){var r,i=0,n=0,l=this.tablesStack[this.tablesStack.length-1].element;return r=l.getElementsByClassName("lpt-tableBlock")[0],!r||(r=r.getElementsByTagName("table")[0],!r)?0:([].slice.call(r.rows).forEach(function(o){n+=o.rowSpan||1}),[].slice.call((r.rows[0]||{cells:[]}).cells).forEach(function(o){i+=o.colSpan||1}),t?(r=l.getElementsByClassName("lpt-topHeader")[0],!r||(r=r.getElementsByTagName("table")[0],!r)||([].slice.call(r.rows).forEach(function(o){n+=o.rowSpan||1}),r=l.getElementsByClassName("lpt-leftHeader")[0],!r)||(r=r.getElementsByTagName("table")[0],!r)?0:((this.getCurrentTableData().element||{})._listing||[].slice.call((r.rows[0]||{cells:[]}).cells).forEach(function(o){i+=o.colSpan||1}),{width:i,height:n})):{width:i,height:n})},PivotView.prototype.displayLoading=function(){this.displayMessage(this.controller.CONFIG.loadingMessageHTML||'<div class="lpt-spinner"><div></div><div></div><div></div><div></div><div></div></div>')},PivotView.prototype.updateSizes=function(){for(var t in this.tablesStack)this.recalculateSizes(this.tablesStack[t].element)},PivotView.prototype._updateTablesPosition=function(t){for(var r=0;r<this.tablesStack.length;r++)this.tablesStack[r].element.style.left=(1+(t||0)+r-this.tablesStack.length)*100+"%"},PivotView.prototype.getCurrentTableData=function(){return this.tablesStack[this.tablesStack.length-1]},PivotView.prototype.pushTable=function(t){var r=this,i,n=document.createElement("div");n.className="tableContainer"+(this.controller.CONFIG.wrapCellContent?" lpt-cellWrap":""),this.tablesStack.length&&(this.tablesStack[this.tablesStack.length-1].FIXED_COLUMN_SIZES=this.FIXED_COLUMN_SIZES,this.tablesStack[this.tablesStack.length-1].FIXED_LEFT_HEADER_SIZES=this.FIXED_LEFT_HEADER_SIZES,this.tablesStack[this.tablesStack.length-1].savedSearch=this.savedSearch,this.tablesStack[this.tablesStack.length-1].selectedRows=this.selectedRows,this.savedSearch={restore:!1,value:"",columnIndex:0},n.style.left="100%"),this.tablesStack.push({element:n,opts:t||{},FIXED_LEFT_HEADER_SIZES:this.FIXED_LEFT_HEADER_SIZES||{},pagination:i={on:!1,rows:1/0,page:0,pages:0}}),this.FIXED_COLUMN_SIZES=[];var l=this.tablesStack[this.tablesStack.length-1];this.FIXED_LEFT_HEADER_SIZES=l&&l.FIXED_LEFT_HEADER_SIZES?l.FIXED_LEFT_HEADER_SIZES:{},this.selectedRows={},this.elements.base.appendChild(n),this.elements.tableContainer=n,this.pagination=i,setTimeout(function(){r._updateTablesPosition()},30)},PivotView.prototype.popTable=function(){var t;if(!(this.tablesStack.length<2)){this.FIXED_COLUMN_SIZES=[],this._updateTablesPosition(1);var r=this.tablesStack.pop();this.pagination=(t=this.tablesStack[this.tablesStack.length-1]).pagination,t.FIXED_COLUMN_SIZES&&(this.FIXED_COLUMN_SIZES=t.FIXED_COLUMN_SIZES),t.FIXED_LEFT_HEADER_SIZES&&(this.FIXED_LEFT_HEADER_SIZES=t.FIXED_LEFT_HEADER_SIZES),t.savedSearch&&(this.savedSearch=t.savedSearch),t.selectedRows&&(this.selectedRows=t.selectedRows),setTimeout(function(){r.element.parentNode.removeChild(r.element)},this.ANIMATION_TIMEOUT),this.elements.tableContainer=this.tablesStack[this.tablesStack.length-1].element}},PivotView.prototype.saveScrollPosition=function(){var t;this.elements.tableContainer&&(t=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(this.savedScroll.x=t[0].scrollLeft,this.savedScroll.y=t[0].scrollTop)},PivotView.prototype.restoreScrollPosition=function(){var t;this.elements.tableContainer&&(t=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(t[0].scrollLeft=this.savedScroll.x,t[0].scrollTop=this.savedScroll.y)},PivotView.prototype.dataChanged=function(t){var r=t.rawData.length-t.info.topHeaderRowsNumber;this.controller.CONFIG.pagination&&(this.pagination.on=!0),this.pagination.rows=this.controller.CONFIG.pagination||1/0,this.selectedRows={},this.pagination.page=0,this.pagination.pages=Math.ceil(r/this.pagination.rows),this.pagination.pages<2&&(this.pagination.on=!1),this.renderRawData(t)},PivotView.prototype._columnClickHandler=function(t){this.saveScrollPosition(),this.controller.dataController.sortByColumn(t),this.restoreScrollPosition()},PivotView.prototype._rowClickHandler=function(t,r){var i=!0;if(typeof this.controller.CONFIG.triggers.rowClick=="function"){var n=this.controller.getRowsValues([t])[0].slice(this.controller.dataController.getData().info.leftHeaderColumnsNumber);i=this.controller.CONFIG.triggers.rowClick(t,n,r)}i!==!1&&this.controller.tryDrillDown(r.source.path)},PivotView.prototype._pageSwitcherHandler=function(t){this.pagination.page=t,this.saveScrollPosition(),this.renderRawData(this.controller.dataController.getData()),this.restoreScrollPosition()},PivotView.prototype._backClickHandler=function(t){t&&(t.cancelBubble=!0,t.stopPropagation()),this.removeMessage(),this.popTable(),this.controller.popDataSource(),typeof this.controller.CONFIG.triggers.back=="function"&&this.controller.CONFIG.triggers.back.call(this.controller,{level:this.controller.DRILL_LEVEL})},PivotView.prototype._drillThroughClickHandler=function(t){this.controller.tryDrillThrough(),t&&(t.cancelBubble=!0,t.stopPropagation())},PivotView.prototype._getSelectedText=function(){var t="";return typeof window.getSelection<"u"?t=window.getSelection().toString():typeof document.selection<"u"&&document.selection.type=="Text"&&(t=document.selection.createRange().text),t},PivotView.prototype._cellClickHandler=function(t,r,i,n,l){var o=this.controller.dataController.getData(),a=[],u,p,f=!0,m,v=this.controller.CONFIG.showSummary&&this.controller.CONFIG.attachTotals?1:0;if(!this._getSelectedText()&&!(typeof this.controller.CONFIG.triggers.cellSelected=="function"&&(m=this.controller.CONFIG.triggers.cellSelected.call(this.controller,{x:r-o.info.leftHeaderColumnsNumber,y:i-o.info.topHeaderRowsNumber,leftHeaderColumnsNumber:o.info.leftHeaderColumnsNumber,topHeaderRowsNumber:o.info.topHeaderRowsNumber}),m===!1))){try{u=o.rawData[i][o.info.leftHeaderColumnsNumber-1].source.path,p=o.rawData[o.info.topHeaderRowsNumber-1-v][r].source.path}catch{this.controller.CONFIG.logs&&console.warn("Unable to get filters for cell (%d, %d)",r,i)}u&&a.push(u),p&&a.push(p),this.controller.CONFIG.drillDownTarget?window.location=location.origin+location.pathname+"?DASHBOARD="+encodeURIComponent(this.controller.CONFIG.drillDownTarget)+"&SETTINGS=FILTER:"+encodeURIComponent(a.join("~"))+";":(typeof this.controller.CONFIG.triggers.cellDrillThrough=="function"&&(f=this.controller.CONFIG.triggers.cellDrillThrough({event:n,filters:a,cellData:t,x:r,y:i},o)),typeof l=="function"&&(f=!(l({event:n,filters:a,cellData:t,x:r,y:i},o)===!1||f===!1)),f!==!1&&this.controller.tryDrillThrough(a))}},PivotView.prototype.copyToClipboard=function(t){var r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",t),document.body.appendChild(r),r.select();var i=!1;try{i=document.execCommand("copy")}catch(n){console.log("Copy error: "+n)}return document.body.removeChild(r),i},PivotView.prototype._showCellContextMenu=function(t,r){var i=this,n=document.createElement("div"),l=document.createElement("div"),o;this._removeCellContextMenu(),n.className="lpt-cellContextMenu",n.style.position="fixed",n.style.left=r.clientX+"px",n.style.top=r.clientY+"px",n.style.zIndex="9999",n.style.background="#fff",n.style.border="1px solid #d0d0d0",n.style.borderRadius="4px",n.style.boxShadow="0 0 5px 0px rgba(0,0,0,0.12)",n.style.minWidth="100px",l.textContent=pivotLocale.get(6),l.style.cursor="pointer",l.style.padding="10px 20px",l.style.width="100%",l.style.boxSizing="border-box",l.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation();var u=t!=null&&t!==""?String(t):"";i.copyToClipboard(u),i._removeCellContextMenu(),document.removeEventListener("mousedown",o)}),n.appendChild(l),document.body.appendChild(n),o=function(a){a.target&&!n.contains(a.target)&&(n.parentNode&&n.parentNode.removeChild(n),document.removeEventListener("mousedown",o))},document.addEventListener("mousedown",o)},PivotView.prototype._removeCellContextMenu=function(){for(var t=document.getElementsByClassName("lpt-cellContextMenu");t.length;)t[0].parentNode.removeChild(t[0])},PivotView.prototype.listingClickHandler=function(t,r){if(r.info.leftHeaderColumnsNumber!==0){console.warn("Listing handler called not for a listing!");return}var i=this.controller.CONFIG.triggerEvent||"click",n=this,l=function(E){return document.createElement(E)},o=l("div"),a=r.rawData[0].map(function(E){return E.value+(E.source&&E.source.title?"("+E.source.title+")":"")}),u=r.rawData[t.y].map(function(E){return E.value});o.className="lpt-hoverMessage",o.style.fontSize="12pt",o.style.opacity=0;for(var p,f,m,v,D,A=0;A<a.length;A++)p=l("div"),D=l("span"),f=l("div"),m=l("hr"),v=l("div"),v.className="lpt-icon-copy",v.title="Copy",v.style.marginRight="6px",D.className="lpt-messageHead",D.textContent=a[A],f.className="lpt-messageBody",p.style.marginBottom=".3em",u[A]!==""?f.textContent=u[A]:f.innerHTML="&nbsp;",p.appendChild(v),p.appendChild(D),o.appendChild(p),o.appendChild(f),o.appendChild(m),v.addEventListener(i,function(E){return function(H){n.copyToClipboard(E)===!1&&alert("Your browser does not support dynamic content copying."),H.preventDefault(),H.cancelBubble=!0,H.preventBubble=!0}}(u[A]));return this.elements.base.appendChild(o),setTimeout(function(){o&&(o.style.opacity=1)},1),o.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){n._getSelectedText()||n.removeMessage()}),!1},PivotView.prototype.displayMessage=function(t,r){this.removeMessage();var i=this,n=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div");n.className="central lpt-hoverMessage",n.style.opacity=0,o.innerHTML=t,l.appendChild(o),n.appendChild(l),this.elements.base.appendChild(n),setTimeout(function(){n&&(n.style.opacity=1)},1),r&&n.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){i.removeMessage()})},PivotView.prototype.removeMessage=function(){var t,r;if((t=this.elements.base.getElementsByClassName("lpt-hoverMessage")).length)for(r in t)t[r].parentNode&&t[r].parentNode.removeChild(t[r])},PivotView.prototype._matchCondition=function(t,r,i){var n=parseFloat(t);switch(r){case"=":return n==i;case"<>":return n!=i;case">":return n>i;case">=":return n>=i;case"<":return n<i;case"<=":return n<=i;case"IN":return i.toString().indexOf(n)!==-1;case"BETWEEN":return n>=i.split(",")[0]&&n<=i.split(",")[1];case"IS NULL":return!n;default:return console.error('Formatting error: unknown format operator "'+r+'"'),!1}},PivotView.prototype.applyConditionalFormatting=function(t,r,i,n){var l=t[""]||[],o,a,u,p,f,m;l=l.concat(t[r]||[]),(f=r.split(",")).length===2&&(l=l.concat(t[f[0]]||[],t[f[0]+","]||[],t[","+f[1]]||[]));for(o in l)if(u=l[o],!!this._matchCondition(i,u.operator,u.value)){if(u.style&&n.setAttribute("style",(n.getAttribute("style")||"")+u.style),u.icon){for(n.textContent="",p='<div style="overflow: hidden; height: 16px;">',m=parseInt(u.iconCount)||1,a=0;a<m;a++)p+='<img alt="*" style="padding-right:2px; height: 100%;" src="'+u.icon+'"/>';n.innerHTML=p+"</div>"}u.text&&(n.textContent=u.text)}},PivotView.prototype.colorNameToRGB=function(t){var r=function(i,n,l){return{r:i,g:n,b:l}};switch(t){case"red":return r(255,0,0);case"green":return r(0,255,0);case"blue":return r(0,0,255);case"purple":return r(102,0,153);case"salmon":return r(255,140,105);case"white":return r(255,255,255);case"black":return r(0,0,0);case"gray":return r(128,128,128);default:return r(255,255,255)}},PivotView.prototype.selectRow=function(t,r){if(t?this.selectedRows[r]=1:delete this.selectedRows[r],typeof this.controller.CONFIG.triggers.rowSelect=="function"){var i=this.controller.getSelectedRows();this.controller.CONFIG.triggers.rowSelect(i,this.controller.getRowsValues(i))}},PivotView.prototype.recalculateSizes=function(t){var r=t.parentNode,i=22;try{var n=this,l=this.controller.CONFIG.triggerEvent||"click",o=t.getElementsByClassName("lpt-headerValue")[0];if(!o)return;var a=t.getElementsByClassName("lpt-header")[0],u=t.getElementsByClassName("lpt-topHeader")[0],p=t.getElementsByTagName("table")[0],f=p.offsetWidth,m=u.getElementsByTagName("thead")[0],v=t.getElementsByClassName("lpt-leftHeader")[0],D=v.getElementsByTagName("thead")[0],A=t.getElementsByClassName("lpt-tableBlock")[0],E=A.getElementsByTagName("table")[0],H=A.getElementsByTagName("tbody")[0],Z=t.getElementsByClassName("lpt-searchInput")[0],K=Z?t.offsetWidth-this.SEARCHBOX_LEFT_MARGIN:0,V=A.getElementsByTagName("tr")[0],X=t.getElementsByClassName("lpt-pageSwitcher")[0];m.childNodes[0]&&m.childNodes[0].lastChild._extraCell&&m.childNodes[0].removeChild(m.childNodes[0].lastChild),D.lastChild&&D.lastChild._extraTr&&D.removeChild(D.lastChild);var J=(X?this.PAGINATION_BLOCK_HEIGHT:0)+(this.SEARCH_ENABLED?this.PAGINATION_BLOCK_HEIGHT:0),z=Math.max(v.offsetWidth,a.offsetWidth),c=u.offsetHeight;u.style.marginLeft=z+"px";var s=t.offsetHeight,g=s-c-J,C=a.offsetWidth,w=D.offsetHeight===0,P=Math.max(D.offsetHeight,H.offsetHeight)>g&&this.SCROLLBAR_WIDTH>0,S=m.offsetWidth>u.offsetWidth-(P?this.SCROLLBAR_WIDTH:0);!P&&S&&(P=Math.max(D.offsetHeight,H.offsetHeight)>g-this.SCROLLBAR_WIDTH&&this.SCROLLBAR_WIDTH>0);var Q=P&&!w,O,U,ne=[],R=[],y=[],_,L=!1,G=function(){!n.controller.CONFIG.stretchColumns&&P&&!S||(L=!0,U=document.createElement("th"),U.className="lpt-extraCell",U.style.minWidth=n.SCROLLBAR_WIDTH+"px",U.style.width=n.SCROLLBAR_WIDTH+"px",U.rowSpan=m.childNodes.length,U._extraCell=!0,m.childNodes[0].appendChild(U))};if(P&&m.childNodes[0]&&G(),t._primaryColumns)for(_ in t._primaryColumns)ne.push(t._primaryColumns[_].offsetWidth);else console.warn("No _primaryColumns property in container, cell sizes won't be fixed.");if(t._primaryLeftColumns&&t._primaryLeftColumns.length>0&&n.controller.CONFIG.autoFitLeftHeader){var F=t._primaryLeftColumns,k=F[0]._leftHeaderColIndex;if(k!==void 0&&n.FIXED_LEFT_HEADER_SIZES[k]===void 0){for(var d=0,h=0;h<F.length;h++){var I=F[h].scrollWidth||F[h].offsetWidth;I>d&&(d=I)}n.FIXED_LEFT_HEADER_SIZES[k]=Math.max(d+12,80)}}if(t._primaryRows&&t._primaryCells){for(_ in t._primaryRows)R.push(t._primaryRows[_].offsetHeight);for(_ in t._primaryCells)y.push(t._primaryCells[_].offsetHeight)}else console.warn("No _primaryRows property in container, cell sizes won't be fixed.");var le=[].slice.call(v.getElementsByTagName("th")).map(function(se){return{el:se.getElementsByTagName("div")[0],height:se.getElementsByTagName("div")[0].offsetHeight}});if(t.parentNode.removeChild(t),u.style.marginLeft=z+"px",A.style.marginLeft=z+"px",v.style.height=s-c-J+"px",v.style.width=z+"px",C>z&&(v.style.width=C+"px"),A.style.height=s-c-J-1+"px",a.style.height=c+"px",a.style.width=z+"px",this.controller.CONFIG.stretchColumns||(p.style.width="auto",E.style.width=S?"100%":f+"px"),Q&&(U=document.createElement("tr"),U.appendChild(O=document.createElement("th")),D.appendChild(U),O.__i=0,O.addEventListener(l,function(){O.__i++,O.style.background="#"+Math.max(18-O.__i*3,0).toString(16)+"FF7D7",O.__i>5&&n._()}),U._extraTr=!0,O.colSpan=D.childNodes.length,O.style.height=(this.SCROLLBAR_WIDTH?this.SCROLLBAR_WIDTH+1:0)+"px"),Z&&(Z.style.width=K+"px"),V)for(_ in V.childNodes)V.childNodes[_].tagName==="TD"&&(V.childNodes[_].style.width=ne[_]+"px");if(t._primaryRows.forEach(function(se,re){t._primaryCells[re].style.height=t._primaryRows[re].style.height=Math.max(R[re]||R[re-1]||i,y[re]||y[re-1]||i)+"px"}),le.forEach(function(se){se.el.style.height=parseInt(se.height)+"px"}),t._primaryLeftColumns&&t._primaryLeftColumns.length>0){var F=t._primaryLeftColumns,k=F[0]._leftHeaderColIndex;if(k!==void 0){var T=n.FIXED_LEFT_HEADER_SIZES[k];if(T!==void 0)for(var q=T+"px",Y=0;Y<F.length;Y++)F[Y].style.width=F[Y].style.minWidth=q;else if(n.controller.CONFIG.autoFitLeftHeader){var d=0;for(Y=0;Y<F.length;Y++){var I=F[Y].scrollWidth||F[Y].offsetWidth;I>d&&(d=I)}for(d=Math.max(d+12,80),n.FIXED_LEFT_HEADER_SIZES[k]=d,q=d+"px",Y=0;Y<F.length;Y++)F[Y].style.width=F[Y].style.minWidth=q}}}r.appendChild(t),Math.max(D.offsetHeight,H.offsetHeight)>g&&this.SCROLLBAR_WIDTH>0&&!L&&G()}catch(se){console.error("Error when fixing sizes.","ERROR:",se)}},PivotView.prototype.getUnixDateFromCacheFormat=function(t){function r(m,v){var D=new Date(m);return D.setDate(m.getDate()+v),D}function i(m){var v=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],D=Date.parse(m);if(!isNaN(D))return D;if(m.split("-").length==2){var A=m.split("-"),E=v.indexOf(A[0].toLowerCase());if(E!=-1)return Date.parse((E+1).toString()+"/01/"+A[1])}else if(m.split(" ").length==2){var H=m.split(" ")[1].split(":").length;if(H===0&&(m+=":00"),D=Date.parse(m.replace(/-/g,"/")),!isNaN(D))return D}return 0}if(t===""&&t===void 0||t===null)return null;var n=t.toString();if(n.length==4||n.indexOf("-")!=-1||n.indexOf(" ")!=-1)return i(t);if(n.length==6){var l=n.substr(0,4),o=n.substr(4,2);return Date.parse(new Date(parseInt(l),parseInt(o)-1,1))}if(n.length==5&&!isNaN(parseInt(n))){var a=new Date(1840,11,31),u=n.toString().split(","),p=parseInt(u[0]),f=null;return u.length>1&&(f=parseInt(u[1])),a=r(a,parseInt(p)),f&&a.setSeconds(f),Date.parse(a)}else return i(t)},PivotView.prototype.renderRawData=function(t){if(!t.rawData||!t.rawData[0]||!t.rawData[0][0]){this.displayMessage("<h1>"+pivotLocale.get(1)+"</h1><p>"+JSON.stringify(t)+"</p>");return}var r=this,i=t.rawData,n=t.info,l=t.columnProps,o=t.rowProps,a=t.conditionalFormatting?t.conditionalFormatting.colorScale:void 0,u=this.controller.CONFIG.triggerEvent||"click",p=n.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,f=!!this.controller.CONFIG.columnResizing,m=n.leftHeaderColumnsNumber===0,v=m&&this.controller.CONFIG.enableSearch,D=this.controller.CONFIG.enableListingSelect,A=!!this.controller.CONFIG.columnResizeAnimation,E=this.elements.tableContainer,H=document.createElement("div"),Z=document.createElement("div"),K=document.createElement("div"),V=document.createElement("div"),X=document.createElement("div"),J=document.createElement("div"),z=document.createElement("div"),c=document.createElement("table"),s=document.createElement("thead"),g=document.createElement("table"),C=document.createElement("thead"),w=document.createElement("table"),P=document.createElement("tbody"),S=this.pagination.on||m&&this.controller.CONFIG.showListingRowsNumber,Q=S?document.createElement("div"):null,O=S?[]:null,U=Q?document.createElement("div"):null,ne=v?document.createElement("div"):null,R=v?document.createElement("span"):null,y=v?document.createElement("select"):null,_=v?document.createElement("span"):null,L=v?document.createElement("input"):null,G=v?function(){for(var b=[],x=n.leftHeaderColumnsNumber,B=n.topHeaderRowsNumber-1-p,M=x;M<i[B].length;M++)b.push({value:i[B][M].value,source:i[B][M].source,columnIndex:M});return b}():null,F={},k,d,h,I=null,le,T,q=[],Y=[],se=[],re=[],me,ue,Ce,Ne,Ee;this.SEARCH_ENABLED=v,this.numeral.setup(n.decimalSeparator||".",n.numericGroupSeparator||",",n.numericGroupSize||3);var be=function(b,x,B){if(typeof b=="string")b[b.length-1]==="%"&&!isNaN(parseFloat(b))||(x.parentNode.className+=" formatLeft"),x.innerHTML=(b||"").replace(/(https?|ftp):\/\/[^\s]+/ig,function(ee){return"<a href='"+ee+"' target='"+(r.controller.CONFIG.linksTarget||"_blank")+"' onclick='var e=event||window.event;e.stopPropagation();e.cancelBubble=true;'>"+ee+"</a>"});else if(m)x.textContent=b;else if(B==="%date%"){var M=new Date(r.getUnixDateFromCacheFormat(b));if(isNaN(M.getTime())){x.textContent=b;return}x.textContent=M.getHours()+M.getMinutes()+M.getSeconds()===0?M.toLocaleDateString():M.toLocaleString()}else B?x.textContent=b&&r.numeral(b).format(B):b?x.textContent=r.numeral(b).format(b%1===0?"#,###":"#,###.##"):x.textContent=b},_e=function(b,x){var B;b.createTextRange?(B=b.createTextRange(),B.move("character",x),B.select()):b.setSelectionRange(x,x)},Le=function(b,x){var B=0,M=0,j=function($){$.cancelBubble=!0,$.preventDefault(),b.style.width=b.style.minWidth=B-M+$.pageX+"px",A&&(r.saveScrollPosition(),r.recalculateSizes(E),r.restoreScrollPosition())},ee=function($){$.cancelBubble=!0,$.preventDefault(),b.style.width=b.style.minWidth=(r.FIXED_COLUMN_SIZES[x]=B-M+$.pageX)+"px",r.saveScrollPosition(),r.recalculateSizes(E),r.restoreScrollPosition(),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",ee)};b.addEventListener("mousedown",function($){($.target||$.srcElement)===b&&($.cancelBubble=!0,$.preventDefault(),B=b.offsetWidth,M=$.pageX,document.addEventListener("mousemove",j),document.addEventListener("mouseup",ee))})},De=function(b,x,B,M){var j=0,ee=0,$=function(N){for(var he=Math.max(30,N)+"px",ae=0;ae<M.length;ae++)M[ae].style.width=M[ae].style.minWidth=he;r.FIXED_LEFT_HEADER_SIZES[B]=Math.max(30,N)},ce=function(N){N.cancelBubble=!0,N.preventDefault(),$(j-ee+N.pageX),A&&(r.saveScrollPosition(),r.recalculateSizes(E),r.restoreScrollPosition())},ie=function(N){N.cancelBubble=!0,N.preventDefault(),$(j-ee+N.pageX),r.saveScrollPosition(),r.recalculateSizes(E),r.restoreScrollPosition(),document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",ie)};b.addEventListener("mousedown",function(N){N.cancelBubble=!0,N.preventDefault(),j=x.offsetWidth,ee=N.pageX,document.addEventListener("mousemove",ce),document.addEventListener("mouseup",ie)})};for(this.removeMessage();E.firstChild;)E.removeChild(E.firstChild);var we=function(b,x,B,M,j){var ee=j===C,$,ce,ie,N,he,ae;function Oe(W){for(var te=W.checked;W=W.parentNode;)if(W.tagName==="TR"){W.classList[te?"add":"remove"]("lpt-selectedRow"),r.elements.tableContainer.querySelector(".lpt-tableBlock table").rows[W.rowIndex].classList[te?"add":"remove"]("lpt-selectedRow");break}}if(b===x&&D){for(h=B;h<M;h++)ie=document.createElement("tr"),N=document.createElement("td"),ae=document.createElement("input"),ae.setAttribute("type","checkbox"),ae.checked=!!r.selectedRows[h],ae.checked&&function(W){setTimeout(function(){Oe(W)},1)}(ae),N.setAttribute("style","padding: 0 !important;"),ae.addEventListener("click",function(W){return function(te){var oe=te.srcElement||te.target;te.preventDefault(),te.cancelBubble=!0,setTimeout(function(){oe.checked=!oe.checked,r.selectRow.call(r,oe.checked,W),Oe(oe)},1)}}(h)),N.appendChild(ae),ie.appendChild(N),Y.push(N),j.appendChild(ie);return}for(h=B;h<M;h++){for(d=b;d<x;d++)ce=!0,($=F.hasOwnProperty(i[h][d].group))&&(d>0&&i[h][d-1].group===i[h][d].group&&(ce=!1,F[i[h][d].group].element.colSpan=d-F[i[h][d].group].x+1),h>0&&i[h-1][d].group===i[h][d].group&&(ce=!1,F[i[h][d].group].element.rowSpan=h-F[i[h][d].group].y+1),N=F[i[h][d].group].element),(!$||ce)&&(ie||(ie=document.createElement("tr")),ie.appendChild(N=document.createElement(i[h][d].isCaption?"th":"td")),i[h][d].source&&i[h][d].source.title&&N.setAttribute("title",i[h][d].source.title),he=document.createElement("div"),i[h][d].value?he.textContent=i[h][d].value:he.innerHTML="&nbsp;",N.appendChild(he),i[h][d].style&&N.setAttribute("style",i[h][d].style),n.leftHeaderColumnsNumber===0&&r.controller.CONFIG.listingColumnMinWidth&&(N.style.minWidth=r.controller.CONFIG.listingColumnMinWidth+"px"),n.leftHeaderColumnsNumber>0&&r.controller.CONFIG.maxHeaderWidth&&(N.style.maxWidth=r.controller.CONFIG.maxHeaderWidth+"px",N.style.whiteSpace="normal",N.style.wordWrap="normal"),i[h][d].className&&(N.className=i[h][d].className),i[h][d].group&&(F[i[h][d].group]={x:d,y:h,element:N}),i[h][d].isCaption||be(i[h][d].value,N,o[h].format||l[d].format)),ee&&d===x-1&&(Y.push(N),N._leftHeaderColIndex=d,re.push(N),N.addEventListener(u,function(W,te){return function(){r._rowClickHandler.call(r,W,te)}}(h,i[h][d])),r.controller.CONFIG.drillDownTooltip&&N.setAttribute("title",r.controller.CONFIG.drillDownTooltip)),ee&&N.addEventListener("contextmenu",function(W,te){return function(oe){oe.preventDefault(),oe.stopPropagation();var fe=te&&te.textContent?te.textContent.trim():W.value!==void 0&&W.value!==null?String(W.value):"",de={canDrill:!!(W.source&&W.source.path),canDrillthrough:!1,copyValue:fe};W.source&&W.source.path&&(de.drillPath=W.source.path,de.drillTitle=fe||""),typeof r.controller.CONFIG.triggers.contextMenu=="function"?r.controller.CONFIG.triggers.contextMenu(de,oe):r._showCellContextMenu.call(r,fe,oe)}}(i[h][d],N)),!ee&&h===M-1-p&&!N._hasSortingListener&&(N._hasSortingListener=!1,i[h][d].noClick||N.addEventListener(u,function(W){return function(){r._columnClickHandler.call(r,W)}}(d-n.leftHeaderColumnsNumber)),N.className=(N.className||"")+" lpt-clickable"),!ee&&h===M-1&&(r.FIXED_COLUMN_SIZES[d]&&(N.style.minWidth=N.style.width=r.FIXED_COLUMN_SIZES[d]+"px"),f&&(n.leftHeaderColumnsNumber===0||d!==n.leftHeaderColumnsNumber)&&(Le(N,d),N.className+=" lpt-resizableColumn"),q.push(N)),ee||N.addEventListener("contextmenu",function(W,te){return function(oe){oe.preventDefault(),oe.stopPropagation();var fe=te&&te.textContent?te.textContent.trim():W.value!==void 0&&W.value!==null?String(W.value):"",de={canDrill:!1,canDrillthrough:!1,copyValue:fe};typeof r.controller.CONFIG.triggers.contextMenu=="function"?r.controller.CONFIG.triggers.contextMenu(de,oe):r._showCellContextMenu.call(r,fe,oe)}}(i[h][d],N));ie&&j.appendChild(ie),ie=null}};if(X.textContent="",i[0][0].style&&!m&&X.setAttribute("style",i[0][0].style),this.tablesStack.length>1&&!this.controller.CONFIG.hideButtons&&(X.className+="back ",X.addEventListener(u,function(b){r._backClickHandler.call(r,b)})),this.controller.CONFIG.showContextMenuButton&&typeof this.controller.CONFIG.triggers.contextMenu=="function"&&!(n.leftHeaderColumnsNumber===0&&(this.controller.CONFIG.hideButtons||this.tablesStack.length<2))){var pe=document.createElement("span");pe.className="lpt-ctxMenuBtn",pe.innerHTML="&#8942;",pe.title=pivotLocale.get(7),pe.style.cssText="cursor:pointer;margin-left:4px;opacity:0.6;font-size:14px;line-height:1;vertical-align:middle;",pe.addEventListener(u,function(b){b.preventDefault(),b.stopPropagation();var x={canDrill:!1,canDrillthrough:!1,copyValue:void 0};r.controller.CONFIG.triggers.contextMenu(x,b)}),X.appendChild(pe)}if(n.leftHeaderColumnsNumber>0&&r.controller.CONFIG.maxHeaderWidth&&(K.style.maxWidth=r.controller.CONFIG.maxHeaderWidth*n.leftHeaderColumnsNumber+"px",K.style.whiteSpace="normal",K.style.wordWrap="normal"),(this.controller.CONFIG.hideButtons||this.tablesStack.length<2)&&n.leftHeaderColumnsNumber===0&&(X.style.display="none"),we(n.leftHeaderColumnsNumber,i[0].length,0,n.topHeaderRowsNumber,s),we(0,n.leftHeaderColumnsNumber,Ce=n.topHeaderRowsNumber+(this.pagination.page*this.pagination.rows||0),Ne=this.pagination.on?Math.min(Ce+this.pagination.rows,i.length):i.length,C),f&&n.leftHeaderColumnsNumber>0&&re.length>0){var ye=n.leftHeaderColumnsNumber-1;if(r.FIXED_LEFT_HEADER_SIZES[ye]!==void 0)for(var Ie=r.FIXED_LEFT_HEADER_SIZES[ye]+"px",ge=0;ge<re.length;ge++)re[ge].style.minWidth=re[ge].style.width=Ie;var Se=re[0],ve=document.createElement("div");ve.className="lpt-resizeHandle lpt-resizableColumn",ve.style.cssText="position:absolute;right:0;top:0;bottom:0;width:6px;cursor:col-resize;z-index:1;",Se.style.position="relative",Se.appendChild(ve),De(ve,Se,ye,re)}for(h=Ce;h<Ne;h++){for(I=document.createElement("tr"),d=n.leftHeaderColumnsNumber;d<i[0].length;d++)ue=this.controller.getPivotProperty(["cellStyle"])||"",I.appendChild(T=document.createElement("td")),T.appendChild(Ee=document.createElement("div")),d===n.leftHeaderColumnsNumber&&se.push(T),be(i[h][d].value,Ee,o[h]&&o[h].format||l[d].format),a&&!(n.SUMMARY_SHOWN&&i.length-1===h)&&(me=(parseFloat(i[h][d].value)-a.min)/a.diff,ue+="background:rgb("+ +Math.round((a.to.r-a.from.r)*me+a.from.r)+","+Math.round((a.to.g-a.from.g)*me+a.from.g)+","+Math.round((a.to.b-a.from.b)*me+a.from.b)+");"+(a.invert?"color: white;":"")),(l[d].style||o[h]&&o[h].style)&&(ue+=(o[h]&&o[h].style||"")+(o[h]&&o[h].style?" ":"")+(l[d].style||"")),i[h][d].style&&(ue+=i[h][d].style),this.controller.CONFIG.conditionalFormattingOn&&!(n.SUMMARY_SHOWN&&i.length-1===h)&&!this.getCurrentTableData().opts.disableConditionalFormatting&&this.applyConditionalFormatting(t.conditionalFormatting,h-n.topHeaderRowsNumber+1+","+(d-n.leftHeaderColumnsNumber+1),i[h][d].value,T),ue&&T.setAttribute("style",(T.getAttribute("style")||"")+ue),!m&&r.controller.CONFIG.drillThroughTooltip&&T.setAttribute("title",r.controller.CONFIG.drillThroughTooltip),T.addEventListener(u,function(b,x,B){return function(M){r._cellClickHandler.call(r,B,b,x,M,n.drillThroughHandler)}}(d,h,i[h][d])),T.addEventListener("contextmenu",function(b,x,B,M){return function(j){j.preventDefault(),j.stopPropagation();var ee=M&&M.textContent?M.textContent.trim():B.value!==void 0&&B.value!==null?String(B.value):"",$={canDrill:!1,canDrillthrough:!!r.controller.CONFIG.drillThroughAvailable,copyValue:ee};try{var ce=t.rawData[x][n.leftHeaderColumnsNumber-1].source.path,ie=t.rawData[n.topHeaderRowsNumber-1-(n.SUMMARY_SHOWN&&r.controller.CONFIG.attachTotals?1:0)][b].source.path;$.drillPath=[ce,ie].filter(Boolean).join("~"),$.drillTitle=ee||""}catch{}typeof r.controller.CONFIG.triggers.contextMenu=="function"?r.controller.CONFIG.triggers.contextMenu($,j):r._showCellContextMenu.call(r,ee,j)}}(d,h,i[h][d],T));P.appendChild(I)}if(z.addEventListener("scroll",function(){if(z._ISE){z._ISE=!1;return}V.scrollLeft=z.scrollLeft,J.scrollTop=z.scrollTop,V._ISE=!0,J._ISE=!0}),J.className="lpt-leftHeader",V.className="lpt-topHeader",this.controller.CONFIG.enableHeadersScrolling&&(J.className=J.className+" lpt-scrollable-y",V.className=V.className+" lpt-scrollable-x",J.addEventListener("scroll",function(){if(J._ISE){J._ISE=!1;return}z.scrollTop=J.scrollTop,z._ISE=!0}),V.addEventListener("scroll",function(){if(V._ISE){V._ISE=!1;return}z.scrollLeft=V.scrollLeft,z._ISE=!0})),z.className="lpt-tableBlock",K.className="lpt-header",H.className="lpt-topSection",Z.className="lpt-bottomSection",X.className+="lpt-headerValue",w.appendChild(P),z.appendChild(w),g.appendChild(C),J.appendChild(g),c.appendChild(s),V.appendChild(c),K.appendChild(X),H.appendChild(K),H.appendChild(V),Z.appendChild(J),Z.appendChild(z),E.appendChild(H),E.appendChild(Z),this.controller.CONFIG.stretchColumns||(c.style.width="auto"),Q){Q.className="lpt-pageSwitcher",O=function(x,B){for(var M=0,j=[x];x>1;)x=Math.max(1,x-(M||1)),j.unshift(x),M=M*M+1;for(M=0,x=j[j.length-1];x<B;)x=Math.min(B,x+(M||1)),j.push(x),M=M*M+1;return j}(this.pagination.page+1,this.pagination.pages),this.controller.CONFIG.showListingRowsNumber&&(T=document.createElement("div"),I=document.createElement("span"),I.className="lpt-icon-rows",T.className="lpt-bottomInfo",T.appendChild(I),I=document.createElement("span"),I.textContent=t.rawData.length-(t.info.topHeaderRowsNumber||0)-(t.info.SUMMARY_SHOWN?1:0),T.appendChild(I),U.appendChild(T));for(k in O)k=parseInt(k),T=document.createElement("span"),O[k]===this.pagination.page+1&&(T.className="lpt-active"),T.textContent=O[k],function(b){T.addEventListener(u,function(){r._pageSwitcherHandler.call(r,b-1)})}(O[k]),U.appendChild(T),O[k+1]&&O[k]+1!==O[k+1]&&(T=document.createElement("span"),T.className="lpt-pageSpacer",U.appendChild(T));Q.appendChild(U),E.appendChild(Q)}if(v){R.className="lpt-searchIcon",_.className="lpt-searchSelectOuter",ne.className="lpt-searchBlock",L.className="lpt-searchInput",y.className="lpt-searchSelect";for(k in G)T=document.createElement("option"),T.setAttribute("value",G[k].columnIndex.toString()),T.textContent=G[k].value,y.appendChild(T);L.addEventListener("input",function(){var b=parseInt(y.options[y.selectedIndex].value),x=L.value;r.saveScrollPosition(),r.savedSearch.value=x,r.savedSearch.columnIndex=b,r.savedSearch.restore=!0,r.controller.dataController.filterByValue(x,b),r.restoreScrollPosition()}),ne.appendChild(R),_.appendChild(y),ne.appendChild(_),ne.appendChild(L),E.insertBefore(ne,H),this.elements.searchInput=L,this.elements.searchSelect=y,this.savedSearch.restore&&(this.elements.searchInput.value=this.savedSearch.value,this.elements.searchSelect.value=this.savedSearch.columnIndex)}else this.elements.searchInput=void 0,this.elements.searchSelect=void 0;E._primaryColumns=q,E._primaryRows=Y,E._primaryCells=se,E._primaryLeftColumns=re,E._listing=m,this.recalculateSizes(E),this.savedSearch.restore&&(this.elements.searchInput.focus(),_e(this.elements.searchInput,this.savedSearch.value.length)),typeof this.controller.CONFIG.triggers.contentRendered=="function"&&this.controller.CONFIG.triggers.contentRendered(this.controller)},LightPivotTable}();
