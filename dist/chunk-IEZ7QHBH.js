import{a as re}from"./chunk-6OR4LJEB.js";import{a as ge}from"./chunk-KT3LOAOA.js";import{b as fe}from"./chunk-IQA3UVDV.js";import{b as ae,c as se,d as ce,e as de,f as pe,g as he,h as me,j as ue}from"./chunk-B4QVGKBN.js";import{D as ee,F as te,G as ie,H as ne,I as oe,J as le,h as $}from"./chunk-ACIE3XUP.js";import{Ab as q,Cb as M,Db as z,Ea as j,Eb as R,Fb as T,Gb as A,Hb as r,Ib as s,Ic as X,Jb as b,Kc as Z,Nb as O,Rb as w,Sb as c,Vb as U,Xb as Y,Yb as G,Zb as J,ab as l,ac as B,bb as C,bc as u,cc as y,dc as V,ec as I,fa as W,fc as S,gc as k,ia as L,lc as K,qa as h,qc as x,ra as m,rb as F,rc as v,tb as N,ub as H,vb as Q,xb as P,zb as D}from"./chunk-ZEAAPN4P.js";import"./chunk-MG3ERZGY.js";var _e=["dateFilter"],xe=()=>[import("./chunk-47WHPMM7.js").then(o=>o.DateFilterComponent)];function ve(o,p){o&1&&b(0,"dsw-date-filter",null,0)}function Ce(o,p){o&1&&b(0,"div",9)}function be(o,p){o&1&&(F(0,ve,2,0)(1,Ce,1,0),N(2,0,xe,null,1),Q(),H())}function we(o,p){if(o&1){let e=O();r(0,"div",13)(1,"span",18)(2,"input",19),k("ngModelChange",function(t){h(e);let n=c(2);return S(n.model.isAll,t)||(n.model.isAll=t),m(t)}),w("click",function(t){h(e);let n=c(2);return m(n.setAll(t))}),s(),r(3,"label",20),u(4),x(5,"i18n"),s()(),r(6,"span",18)(7,"input",21),k("ngModelChange",function(t){h(e);let n=c(2);return S(n.model.isExclude,t)||(n.model.isExclude=t),m(t)}),s(),r(8,"label",22),u(9),x(10,"i18n"),s()(),r(11,"span")(12,"input",23),k("ngModelChange",function(t){h(e);let n=c(2);return S(n.model.isInterval,t)||(n.model.isInterval=t),m(t)}),s(),r(13,"label",24),u(14),x(15,"i18n"),s()()()}if(o&2){let e=c(2);l(),P("hidden",e.model.isInterval),l(),I("ngModel",e.model.isAll),l(2),y(v(5,8,"all")),l(2),P("hidden",e.model.isInterval),l(),I("ngModel",e.model.isExclude),l(2),y(v(10,10,"exclude")),l(3),I("ngModel",e.model.isInterval),l(2),y(v(15,12,"interval"))}}function ye(o,p){if(o&1&&(r(0,"option",26),u(1),s()),o&2){let e=p.$implicit;P("ngValue",e.path),l(),y(e.name)}}function Pe(o,p){if(o&1&&(r(0,"option",26),u(1),s()),o&2){let e=p.$implicit;P("ngValue",e.path),l(),y(e.name)}}function Fe(o,p){if(o&1){let e=O();r(0,"div",14)(1,"div")(2,"label"),u(3),x(4,"i18n"),s(),r(5,"select",25),k("ngModelChange",function(t){h(e);let n=c(2);return S(n.model.from,t)||(n.model.from=t),m(t)}),T(6,ye,2,2,"option",26,R),s()(),r(8,"div")(9,"label"),u(10),x(11,"i18n"),s(),r(12,"select",25),k("ngModelChange",function(t){h(e);let n=c(2);return S(n.model.to,t)||(n.model.to=t),m(t)}),T(13,Pe,2,2,"option",26,R),s()()()}if(o&2){let e=c(2);l(3),y(v(4,4,"from")),l(2),I("ngModel",e.model.from),l(),A(e.model.values),l(4),y(v(11,6,"to")),l(2),I("ngModel",e.model.to),l(),A(e.model.values)}}function Me(o,p){if(o&1){let e=O();r(0,"div",27),w("click",function(t){h(e);let n=c(2);return m(n.setAll(t))}),b(1,"input",28),r(2,"div"),u(3,"Default"),s()()}if(o&2){let e=c(2);l(),P("checked",e.model.isAll)}}function Ie(o,p){if(o&1&&(r(0,"div"),u(1),s()),o&2){let e=c().$implicit;l(),y(e.info)}}function Se(o,p){if(o&1){let e=O();r(0,"div",27),w("click",function(t){let n=h(e).$implicit,_=c(2);return m(_.toggleRow(n,t))}),r(1,"input",29,2),w("click",function(t){let n=h(e).$implicit,_=B(2),d=c(2);return n.checked=_.checked,m(d.onItemSelect(t))}),s(),r(3,"div"),u(4),F(5,Ie,2,1,"div"),s()()}if(o&2){let e=p.$implicit,i=c(2);l(),D("readonly",i.isRadio),P("type",i.isRadio?"radio":"checkbox")("checked",e.checked),l(2),q(e.default?"bold":""),D("selected",e.checked),l(),V("",e.name," "),l(),M(e.info?5:-1)}}function ke(o,p){o&1&&(r(0,"div",17),b(1,"img",30),s())}function Oe(o,p){if(o&1){let e=O();r(0,"div",10),b(1,"img",11),r(2,"input",12,1),x(4,"i18n"),k("ngModelChange",function(t){h(e);let n=c();return S(n.model.search,t)||(n.model.search=t),m(t)}),w("search",function(){h(e);let t=B(3),n=c();return m(n.onSearch(t.value))})("keyup",function(){h(e);let t=B(3),n=c();return m(n.onSearch(t.value))})("keydown.enter",function(){h(e);let t=c();return m(t.searchFilters())}),s()(),F(5,we,16,14,"div",13)(6,Fe,15,8,"div",14),r(7,"div",15),F(8,Me,4,1,"div",16),T(9,Se,6,10,"div",16,z),x(11,"selectedFirst"),F(12,ke,2,0,"div",17),s()}if(o&2){let e=c();l(2),U("placeholder",v(4,7,"search")),I("ngModel",e.model.search),l(3),M(e.isRadio?-1:5),l(),M(e.model.isInterval?6:-1),l(),P("hidden",e.model.isInterval),l(),M(e.hasDefault?8:-1),l(),A(v(11,9,e.model.values)),l(3),M(e.model.isLoading?12:-1)}}var Ve=(()=>{class o{transform(e){return Array.isArray(e)?e.sort((i,t)=>i.checked===t.checked?0:i.checked?-1:1):e}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275pipe=L({name:"selectedFirst",type:o,pure:!0,standalone:!0})}}return o})(),$e=(()=>{class o{constructor(e,i,t,n,_,d,g,a,f){this.ss=e,this.el=i,this.ds=t,this.dbs=n,this.fs=_,this.es=d,this.us=g,this.cdr=a,this.locale=f,this.model={search:"",isLoading:!1,filter:void 0,values:[],isAll:!1,isExclude:!1,isInterval:!1,from:"",to:""},this.isRelatedFilters=!1,this.restoreValuesOnClose=!0,this.datePipe=new $(f);let E=this.ss.getAppSettings();this.isRelatedFilters=E.isRelatedFilters===void 0?!0:E.isRelatedFilters}get isDateFilter(){return!!this.model?.filter?.isDate}get isRadio(){return this.model?.filter?.type==="radioSet"||this.model?.filter?.action==="applyVariable"}get hasDefault(){return this.model?.filter?.type==="radioSet"&&this.model?.filter?.action!=="applyVariable"}ngAfterViewInit(){this.fitFiltersIntoScreen(),this.initializeDateFilter()}fitFiltersIntoScreen(){let e=this.el?.nativeElement;if(!e)return;let i=e.getBoundingClientRect(),t=window.innerHeight;if(i.top+i.height>t){let n=t-i.top,_=i.top-26-4-4;if(t-i.top<200&&_>n){let d=t-i.top+30+4,g=t-d-i.height;e.style.maxHeight=i.height+g-20+"px",e.style.top="",e.style.bottom=d+"px"}else{let d=i.top+i.height-t;e.style.maxHeight=i.height-d-20+"px"}}}initialize(e,i,t){this.widget=e,this.model.filter=i,!i.isDate&&this.isRelatedFilters?this.requestRelatedFilters(i):this.prepareFilters(),this.model.isAll=!this.isAnyChecked(),this.model.isExclude=i.isExclude,this.model.isInterval=i.isInterval,this.model.filter.values?.length&&(this.originalValues=this.model.filter.values)}ngOnInit(){}requestRelatedFilters(e){let i=this.getDataSource();if(this.prepareFilters(),!i)return;let t=[],n=this.fs.items,_=n.filter(a=>!a.isInterval&&a.targetProperty!==this.model.filter?.targetProperty&&a.value!==""),d=[];_.forEach(a=>{let f=a.value.toString();a.isExclude&&(f=f.split("|").map(E=>E+=".%NOT").join("|")),a.isInterval&&(f=f.replace("|",":")),a.value.toString().indexOf("|")!==-1&&(f="{"+f.replace(/\|/g,",")+"}"),d.push({Filter:a.targetProperty,Value:f})}),n.find(a=>a.targetProperty===this.model?.filter?.targetProperty)?.values?.filter(a=>!a._saved)?.length&&(this.model.isLoading=!0,this.ds.searchFilters("",i,d,[this.model.filter?.targetProperty]).catch(a=>this.onError(a,a.status)).then(a=>{this.onFilterValuesReceived(a),this.onSearch("")}).finally(()=>{this.model.isLoading=!1,this.cdr.detectChanges()}))}getDataSource(){let e="";try{if(this.widget.type.toLowerCase()===te.const.emptyWidgetClass){let i=this.model.filter?.source||"";e=this.dbs.getWidgets().filter(n=>n.name===i)[0]?.dataSource||""}else e=this.widget.dataSource}catch{e=""}return e}prepareFilters(){this.fs.filtersChanged=!1,this.model.values=[];for(let e=0;e<this.model.filter?.values.length;e++)this.model.values.push(this.model.filter?.values[e]);this.model.values.length!==0&&(this.model.values[this.model.filter?.fromIdx]?this.model.from=this.model.values[this.model.filter?.fromIdx].path:this.model.from=this.model.values[0].path,this.model.values[this.model.filter?.toIdx]?this.model.to=this.model.values[this.model.filter?.toIdx].path:this.model.to=this.model.values[0].path),setTimeout(()=>{this.fitFiltersIntoScreen()})}onSearch(e){if(e==="")this.model.values=this.model.filter?.values;else{let i=e.toLowerCase();this.model.values=[];for(let t=0;t<this.model.filter?.values.length;t++)this.model.filter?.values[t].name.toString().toLowerCase().indexOf(i)!==-1&&this.model.values.push(this.model.filter?.values[t])}}toggleRow(e,i){if(i.target.tagName!=="INPUT"){for(let t=0;t<this.model.filter?.values.length;t++)this.model.filter.values[t].checked=!1;e.checked=!0,this.model.isAll=!e.checked}}isIntervalControlsVisible(){return this.model.isInterval===!0}onItemSelect(e){this.model.isAll=!this.isAnyChecked()}setAll(e){this.model.isAll=!0,this.model.isExclude=!1,this.model.isInterval=!1;for(let i=0;i<this.model.filter?.values.length;i++)this.model.filter.values[i].checked=!1}isAnyChecked(){for(let e=0;e<this.model.filter?.values.length;e++)if(this.model.filter?.values[e].checked)return!0;return!1}searchFilters(){let e=this.getDataSource();if(!e)return;let i=this.model.search;i&&(this.model.isLoading=!0,this.ds.searchFilters(i,e).catch(t=>this.onError(t,t.status)).then(t=>{this.onFilterValuesReceived(t),this.onSearch(i)}))}onFilterValuesReceived(e,i=!1){if(this.model.isLoading=!1,!e)return;let t=e.children.filter(g=>g.path===this.model.filter?.targetProperty);if(t.length===0)return;let n=t[0];if(!n.children||n.children.length===0)return;let _=this.model.filter?.values.slice(),d=[];n.children.forEach(g=>{let a=_.find(f=>f?.path===g?.path||!isNaN(g?.path)&&parseInt(f?.path,10)===g?.path);a&&Object.assign(g,a),d.push(g)}),d.length&&this.model.filter&&(this.model.filter.values=[...d],this.originalValues=structuredClone(d))}onError(e,i){this.model.isLoading=!1,this.es.show(`Error ${i.toString()}`)}removeFilter(){this.model.filter&&(this.model.filter.isInterval=!1),delete this.model.filter?.fromIdx,delete this.model.filter?.toIdx,this.clearSelectedItems(),this.fs.applyFilter(this.model.filter),this.restoreValuesOnClose=!1,this.close()}clearSelectedItems(){for(let e=0;e<this.model.filter?.values.length;e++)this.model.filter.values[e].checked=!1}restoreSelectionState(){this.originalValues?.length&&(this.model.filter.values=structuredClone(this.originalValues))}acceptFilter(){if(this.model.filter.isExclude=this.model.isExclude,this.model.filter.isInterval=this.model.isInterval,this.model.filter.isInterval?(this.model.filter.fromIdx=this.model.values.findIndex(e=>e.path===this.model.from),this.model.filter.toIdx=this.model.values.findIndex(e=>e.path===this.model.to)):(delete this.model.filter.from,delete this.model.filter.to),this.model.filter.isDate){this.model.filter.isInterval=!1,delete this.model.filter.from,delete this.model.filter.to;let e=this.dateFilter.getValues();this.model.filter.values=e.map(i=>{let t=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2);return{name:this.datePipe.transform(i,"dd MMM yyyy"),path:`&[${t}]`,checked:!0}}),e.length===2&&(this.model.filter.isInterval=!0,this.model.filter.fromIdx=0,this.model.filter.toIdx=1)}this.fs.applyFilter(this.model.filter),this.fs.filtersChanged=!0,this.restoreValuesOnClose=!1,this.close()}close(){this._modal?.close()}initializeDateFilter(){if(!this.model?.filter?.isDate||!this.dateFilter)return;let e=this.model?.filter?.value;if(!e)return;let i=e.split("|").map(t=>this.createDate(t));this.dateFilter.setDateRange(i[0],i[1])}createDate(e){return this.us.toDate(e.replace("&[","").replace("]",""))}ngOnDestroy(){this.restoreValuesOnClose&&this.restoreSelectionState()}static{this.\u0275fac=function(i){return new(i||o)(C(le),C(j),C(ne),C(fe),C(ge),C(ie),C(oe),C(Z),C(X))}}static{this.\u0275cmp=W({type:o,selectors:[["dsw-filter-popup"]],viewQuery:function(i,t){if(i&1&&Y(_e,5),i&2){let n;G(n=J())&&(t.dateFilter=n.first)}},hostVars:2,hostBindings:function(i,t){i&2&&D("date-filter",t.isDateFilter)},inputs:{_modal:"_modal"},standalone:!0,features:[K],decls:15,vars:10,consts:[["dateFilter",""],["sr",""],["inp",""],[1,"footer"],[1,"btn","default",3,"click"],["src","assets/img/icons/icon-check.svg",1,"ico","ico-accept"],[1,"btn",3,"click"],["src","assets/img/icons/icon-reload.svg",1,"ico","ico-accept"],["src","assets/img/icons/icon-close.svg",1,"ico","ico-close"],[1,"datepicker-placeholder"],[1,"header"],["src","assets/img/icons/icon-search.svg"],["type","search","dswAutoFocus","desktop",3,"ngModelChange","search","keyup","keydown.enter","placeholder","ngModel"],[1,"checks-container"],[1,"interval-container"],[1,"values-list",3,"hidden"],[1,"value-row"],[1,"spinner"],[3,"hidden"],["id","all","type","checkbox",3,"ngModelChange","click","ngModel"],["for","all"],["id","exclude","type","checkbox",3,"ngModelChange","ngModel"],["for","exclude"],["id","interval","type","checkbox",3,"ngModelChange","ngModel"],["for","interval"],[3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"value-row",3,"click"],["type","radio","name","filter-item",3,"checked"],["name","filter-item",3,"click","type","checked"],["src","assets/img/spinner.svg"]],template:function(i,t){i&1&&(F(0,be,4,0)(1,Oe,13,11),r(2,"div",3)(3,"button",4),w("click",function(){return t.acceptFilter()}),b(4,"img",5),u(5),x(6,"i18n"),s(),r(7,"button",6),w("click",function(){return t.removeFilter()}),b(8,"img",7),u(9),x(10,"i18n"),s(),r(11,"button",6),w("click",function(){return t.close()}),b(12,"img",8),u(13),x(14,"i18n"),s()()),i&2&&(M(t.model.filter!=null&&t.model.filter.isDate?0:1),l(5),V(" ",v(6,4,"accept")," "),l(4),V(" ",v(10,6,"dismiss")," "),l(4),V(" ",v(14,8,"close")," "))},dependencies:[ue,he,me,se,ae,pe,ce,de,re,ee,Ve],styles:["[_ngcontent-%COMP%]:root{--cl-bg: #F5F5F5;--cl-accent: #1A73E8;--cl-btn-hover: #76abf1;--cl-hover: #E8F0FE;--cl-txt: #555555;--input-border-radius: 13px;--cl-btn-main: #5cb85c;--cl-btn-main-txt: #fff;--cl-btn-main-border: #4cae4c;--cl-btn-main-hover: #6eca6e;--cl-btn-secondary: #e6e6e6;--cl-btn-secondary-txt: #cccccc;--cl-btn-secondary-border: #b4b2b2;--cl-btn-secondary-hover: #dbdbdb;--icon-filter: none;--cl1: #b6e6ff;--cl2: #f7bfb7;--cl3: #bceca8;--cl4: #fff9a8;--cl5: #ffc593;--cl6: #f9b1ab;--cl7: #9de7fb;--cl8: #a8b8f9;--cl9: #9df1ae;--cl-header-bg: #FFFFFF;--cl-header-border: #F5F5F5;--cl-header-txt: #606367;--cl-header-ico: var(--cl-header-txt);--cl-header-btn-active: var(--cl-header-bg);--cl-header-btn-hover: var(--cl-bg);--cl-header-btn-hover-darken: var(--cl-hover);--header-height: 64px;--menu-item-icon-filter: none;--cl-sidebar-bg: #F5F5F5;--cl-sidebar-txt: #606367;--tile-border: none;--tile-border-radius: 10px;--tile-header-height: 28px;--cl-modal-bg: white;--fc0: #606367;--fc1: black;--fc2: red;--fc3: white;--fc4: green;--fc5: blue;--cl-widget-bg: white;--cl-widget-header-btn-active: #A9FFA1;--cl-widget-header-border: none;--cl-text-widget-font: #6b6464;--cl-widget-header-bg: var(--cl-header-bg);--cl-widget-header-txt: var(--cl-header-txt);--cl-widget-filter-txt: #606367;--cl-widget-filter-bg: var(--cl-header-bg);--widget-header-btn-opacity: 1;--widget-header-btn-filter: none;--widget-header-btn-active-filter: contrast(.7) sepia(1) brightness(1) hue-rotate(-898deg) contrast(9);--cl-input-bg: white;--cl-input-border: #EBEBEA;--cl-check-border: #606367;--cl-input-placeholder: rgba(96, 99, 103, .6);--cl-input-text: #606367;--cl-input-height: 26px;--cl-pivot-cell-border: rgb(208, 208, 208);--cl-pivot-cell-hover: #FFF7D7;--pivot-row-hover: inset 0 0 30px #fff5b9;--sidebar-width: 322px;--cl-scrollbar: #606367}[_nghost-%COMP%]{position:absolute;-webkit-user-select:none;user-select:none;display:flex;flex-direction:column;width:340px;background-color:var(--cl-widget-filter-bg);filter:drop-shadow(0px 0px 10px rgba(0,0,0,.1));border-radius:10px;padding:20px 20px 63px}@media (max-width: 576px){[_nghost-%COMP%]{left:0!important;width:100vw;display:flex;flex-direction:column;padding-top:4px}}.date-filter[_nghost-%COMP%]{padding:0 0 45px;width:auto}.header[_ngcontent-%COMP%]{position:relative;margin-bottom:10px}.header[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{position:absolute;pointer-events:none;top:5px}.header[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:100%;border:none;color:#606367;height:24px;border-bottom:1px solid #EBEBEA;padding-left:16px;border-radius:0}.header[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:focus, .header[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:active{border:none;border-bottom:1px solid var(--cl-accent);outline:none}.values-list[_ngcontent-%COMP%]{overflow:auto;max-height:280px;color:var(--cl-txt)}.value-row[_ngcontent-%COMP%]{display:flex;padding:5px 0;cursor:pointer;align-items:center;color:var(--cl-widget-filter-txt)}.value-row[_ngcontent-%COMP%]:hover{background-color:var(--cl-hover);color:var(--cl-header-txt)}@media (max-width: 576px){.value-row[_ngcontent-%COMP%]{padding:0;display:flex}}.value-row[_ngcontent-%COMP%] > div.selected[_ngcontent-%COMP%]{color:var(--cl-accent)}input[type=search][_ngcontent-%COMP%]{width:116px}@media (max-width: 576px){input[type=search][_ngcontent-%COMP%]{width:100%;height:calc(100% - 8px);background-color:transparent;border:none;box-shadow:none}}input[_ngcontent-%COMP%]:focus{outline:1px solid var(--cl-accent);outline-offset:-1px}input[type=checkbox][_ngcontent-%COMP%], input[type=radio][_ngcontent-%COMP%]{flex-grow:0;margin-right:5px}input[type=checkbox][_ngcontent-%COMP%], input[type=radio][_ngcontent-%COMP%]{cursor:pointer}input[type=checkbox][_ngcontent-%COMP%]:focus, input[type=radio][_ngcontent-%COMP%]:focus{outline:none}@media (max-width: 576px){input[type=checkbox][_ngcontent-%COMP%], input[type=radio][_ngcontent-%COMP%]{height:34px;margin-right:4px;margin-left:4px}}.checks-container[_ngcontent-%COMP%]{color:var(--cl-widget-filter-txt);display:flex;padding-bottom:12px}.checks-container[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:flex;margin-right:12px;align-items:center}.ico[_ngcontent-%COMP%]{opacity:.7;vertical-align:middle}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center}.interval-container[_ngcontent-%COMP%]{padding:4px;color:var(--cl-txt)}.interval-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{margin-bottom:10px}.readonly[_ngcontent-%COMP%]{pointer-events:none}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;width:100%;display:flex;justify-content:flex-end;border-top:1px solid #EBEBEA}.footer[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%]{height:44px;padding:0 10px;border:none;box-shadow:none;background:transparent;color:#606367;display:flex;align-items:center;transition:filter .3s linear}.footer[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{margin-right:6px}.footer[_ngcontent-%COMP%] > .btn.default[_ngcontent-%COMP%]{color:var(--cl-accent)}.footer[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%]:hover{filter:contrast(3)}.footer[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%]:focus, .footer[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%]:active{border:none;outline:none}.footer[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%]:last-child{padding-right:20px}.datepicker-placeholder[_ngcontent-%COMP%]{width:400px;height:268px}"],changeDetection:0})}}return o})();export{$e as FilterPopupComponent,Ve as SelectedFirstPipe};
