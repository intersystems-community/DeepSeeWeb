/** LightPivotTable
 ** A lightweight pivot table for MDX2JSON source for InterSystems Cache
 ** @author ZitRo
 ** @version 1.8.14
 ** @license Apache 2.0
 ** @see https://github.com/ZitRos/LightPivotTable
 **/LightPivotTable=function(){var DataController=function(t,r){if(r&&typeof r!="function")throw new Error("dataChangeTrigger parameter must be a function");this._dataStack=[],this.controller=t,this.pushData(),this.dataChangeTrigger=r,this.SUMMARY_SHOWN=!1};DataController.prototype.isValidData=function(t){return t.dimensions instanceof Array&&t.dimensions[0]instanceof Array&&!t.dimensions[0].length&&(t.dimensions[0]=[{}]),t.dimensions instanceof Array&&t.dimensions[0]instanceof Array&&t.dataArray instanceof Array&&typeof t.info=="object"&&t.info.cubeName},DataController.prototype.pushData=function(){var t;this._dataStack.push(t={data:null,SUMMARY_SHOWN:this.SUMMARY_SHOWN,SORT_STATE:{column:null,order:-1}}),this.SORT_STATE=t.SORT_STATE},DataController.prototype.popData=function(){if(!(this._dataStack.length<2)){var t=this._dataStack[this._dataStack.length-2];this._dataStack.pop(),this.SUMMARY_SHOWN=t.SUMMARY_SHOWN,this.SORT_STATE=t.SORT_STATE}},DataController.prototype.getData=function(){return this._dataStack[this._dataStack.length-1].data||{}},DataController.prototype.setData=function(t){if(!this.isValidData(t)){console.error("Invalid data to set.",t);return}return this._dataStack[this._dataStack.length-1].data=t,this.setLeftHeaderColumnsNumber(t),this.pivotDataProcess(t),this.resetDimensionProps(),this.resetConditionalFormatting(),this.resetRawData(),this.modifyRawData(t),this.postDataProcessing(t),t.info.mdxType==="drillthrough"&&this.setDrillThroughHandler(this.controller.pivotView.listingClickHandler.bind(this.controller.pivotView)),this._trigger(),t},DataController.prototype.pivotDataProcess=function(t){var r=this.controller.getPivotProperty(["rowTotals"]);typeof r=="boolean"&&(this.controller.CONFIG.showSummary=r)},DataController.prototype.setDrillThroughHandler=function(t){this._dataStack[this._dataStack.length-1].data.info.drillThroughHandler=t},DataController.prototype.resetDimensionProps=function(){var t,r,i;if(!(t=this._dataStack[this._dataStack.length-1].data)){console.error("Unable to get dimension props for given data set.");return}r=[],i=[];var n=function(o){var a,u={};for(a in o)u[a]=o[a];return u},l=function(o,a,u){var h,p,m;if(a.children&&a.children.length>0)for(m in a.children)p=n(u),h=a.children[m],h.format&&(p.format=h.format),h.style&&(p.style=(p.style||"")+h.style),h.summary&&(p.summary=h.summary),h.total&&(p.summary=(h.total||"").toLowerCase().replace(/:.*/,"")),h.type&&(p.type=h.type),l(o,h,p);else o.push(n(u))};l(r,{children:t.dimensions[0]},{}),l(i,{children:t.dimensions[1]},{}),t.columnProps=r,t.rowProps=i},DataController.prototype.getTypeByValue=function(t){return isNaN(t)?(t+"").match(/[0-9]{2}\.[0-9]{2}\.[0-9]{2,4}/)?{type:"date",comparator:function(r){var i=r.split(".");return new Date(i[2],i[1],i[0])}}:Date.parse(t)?{type:"date",comparator:function(r){return new Date(r)}}:{type:"string"}:{type:"number"}},DataController.prototype.postDataProcessing=function(t){var r,i;if(!(!t||!t.rawData||!t.rawData[t.info.topHeaderRowsNumber]))for(t.columnProps||(t.columnProps=[]),i=t.info.leftHeaderColumnsNumber;r=t.rawData[t.info.topHeaderRowsNumber][i];i++)t.columnProps[i]||(t.columnProps[i]={}),t.columnProps[i].$FORMAT=this.getTypeByValue(r.value)},DataController.prototype.resetConditionalFormatting=function(){var t,r,i,n,l,o,a,u={},h;if(!(t=this._dataStack[this._dataStack.length-1].data)){console.error("Unable to get conditional formatting for given data set.");return}if(!this.controller.CONFIG.pivotProperties){t.conditionalFormatting=u;return}(r=this.controller.CONFIG.pivotProperties.colorScale)&&(r.indexOf("custom:")>-1?(l=r.split(":")[1].split(","),n={r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])},l=r.split(":")[2].split(","),i={r:parseInt(l[0]),g:parseInt(l[1]),b:parseInt(l[2])}):(l=r.split("-to-"),i=this.controller.pivotView.colorNameToRGB(l[0]),n=this.controller.pivotView.colorNameToRGB(l[1])),u.colorScale={from:n,to:i,min:o=Math.min.apply(Math,t.dataArray||[]),max:a=Math.max.apply(Math,t.dataArray||[]),diff:a-o,invert:(n.r+n.b+n.g)/3<128}),h=this.controller.CONFIG.pivotProperties.formatRules||[],h.length&&typeof this.controller.CONFIG.conditionalFormattingOn>"u"&&(this.controller.CONFIG.conditionalFormattingOn=!0);for(var p in h)u[h[p].range]||(u[h[p].range]=[]),u[h[p].range].push(h[p]);t.conditionalFormatting=u},DataController.prototype.TOTAL_FUNCTIONS={isNumber:function(t){return t==""?!1:isFinite(t)},totalSUM:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;t[h]&&t[h][p]&&this.isNumber(t[h][p].value)&&(a+=parseFloat(t[h][p].value)||0)}return a},totalAVG:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;if(!this.isNumber(t[h][p].value)){a=0;break}a+=parseFloat(t[h][p].value)||0}return a/(i-r)||""},totalCOUNT:function(t,r,i,n,l,o){for(var a=0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;t[h][p].value&&a++}return a},totalMIN:function(t,r,i,n,l,o){for(var a=1/0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;this.isNumber(t[h][p].value)&&t[h][p].value<a&&(a=t[h][p].value)}return a},totalMAX:function(t,r,i,n,l,o){for(var a=-1/0,u=r;u<i;u++){var h=typeof o>"u"?u:o,p=typeof n>"u"?u:n;this.isNumber(t[h][p].value)&&t[h][p].value>a&&(a=t[h][p].value)}return a},totalPERCENTAGE:function(t,r,i,n,l,o){var a=[],u,h;for(u=l;u<(typeof n>"u"?t.length:t[0].length);u++)a.push(this.totalSUM(t,r,i,typeof n>"u"?n:u,l,typeof o>"u"?o:u));return h=a.reduce(function(p,m){return p+m}),(a[(typeof o>"u"?n:o)-l]/h*100||0).toFixed(2)+"%"},totalNONE:function(){return""}},DataController.prototype.setLeftHeaderColumnsNumber=function(t){function r(i,n){if(!(i.children instanceof Array))return n;for(var l=n+1,o=0;o<i.children.length;o++)n=Math.max(r(i.children[o],l),n);return n}t.info.leftHeaderColumnsNumber=r({children:t.dimensions[1]||[]},0)},DataController.prototype.resetRawData=function(){var t="font-weight: bold;text-align: right;",r,i,n,l,o,a=this;if(!(r=this._dataStack[this._dataStack.length-1].data))return console.error("Unable to create raw data for given data set."),null;var u=[],h=[],p=2,m=[],y=a.controller.CONFIG.pivotProperties&&a.controller.CONFIG.pivotProperties.hideMeasures===2,_=function(N){return Object.keys(N[0]).map(function(f){return N.map(function(E){return E[f]})})},x=function(N,f,E){U(u,f,E,!0);var d,O=0;for(d in u)u[d].length>O&&(O=u[d].length);for(d in u)for(var V=u[d].length;V<O;V++)u[d].push(u[d][u[d].length-1]);u=_(u)},b=function(N,f){a.controller.CONFIG.pivotProperties&&(a.controller.CONFIG.pivotProperties.columnHeaderStyle&&f?N.style=a.controller.CONFIG.pivotProperties.columnHeaderStyle:a.controller.CONFIG.pivotProperties.rowHeaderStyle&&!f&&(N.style=a.controller.CONFIG.pivotProperties.rowHeaderStyle))},A=function(N,f){typeof f>"u"&&(f=0);function E(d,O){if(d.children){var V=0;for(var $ in d.children)V=Math.max(V,E(d.children[$],O+1));return V}else return d.type==="msr"&&y?O-1:O}return N.reduce(function(d,O){return Math.max(d,E(O,1))},f)},U=function(N,f,E,d,O,V){var $,B,k;E||(E=[]);for(var M in f)$=p,O<V&&!(f[M].children&&f[M].children.length)&&(f[M].children=[{}],k=!0),f[M].children&&f[M].children.length?(k?k=!1:p++,B={group:$,source:f[M],isCaption:!0,value:f[M].caption||""},b(B,d),U(N,f[M].children,E.concat(B),d,O&&O+1,V)):(B={group:p,source:f[M],isCaption:!0,value:f[M].caption||""},b(B,d),N.push(f[M].type==="msr"&&y?E:E.concat(B)),p++)},z=function(N){if(!a.controller.CONFIG.pivotProperties)return N;var f,E,d,O=N[0].length,V=a.controller.getPivotProperty(["columnLevels"]),$=a.controller.getPivotProperty(["rowLevels"]),B={},k={},M=function(Z,I){if(!(typeof I>"u"))for(var v in I.childLevels)I.childLevels[v]&&I.childLevels[v].spec&&(Z[(I.childLevels[v].spec||"").replace(/[^.]*$/,"")]={style:I.childLevels[v].levelStyle||"",headStyle:I.childLevels[v].levelHeaderStyle||""}),M(I.childLevels[v])};for(d in V)M(B,{childLevels:[V[d]]}),M(k,{childLevels:[$[d]]});for(E=0;E<N.length;E++)for(f=0;f<O;f++){if(!N[E][f].isCaption){O=f;break}if(N[E][f].source&&N[E][f].source.path){var j=r.info.topHeaderRowsNumber>E?B:k;for(d in j)if(N[E][f].source.path.indexOf(d)>=0){N[E][f].isCaption?j[d].headStyle&&(N[E][f].style=(N[E][f].style||"")+j[d].headStyle||""):j[d].style&&(N[E][f].style=(N[E][f].style||"")+j[d].style||"");break}}}return N};r.dimensions[0].length&&x(u,r.dimensions[0]),r.dimensions[1].length&&U(h,r.dimensions[1],void 0,void 0,1,A(r.dimensions[1])),h[0]&&(o=(h[0][h[0].length-1]||{source:{}}).source.dimension);var P=(u[0]||[]).length,W=h.length||r.info.rowCount||0,G=u.length||r.info.colCount||0,F=(h[0]||[]).length,c=!!this.controller.CONFIG.attachTotals;for(n=0;n<G+W;n++)for(m[n]||(m[n]=[]),l=0;l<F+P;l++)l<F?n<G?(m[n][l]={group:1,isCaption:!0,value:this.controller.getPivotProperty(["showRowCaption"])===!1?"":this.controller.CONFIG.caption||o||(r.info||{}).cubeName||""},b(m[n][l],!1)):m[n][l]=h[n-G][l]:n<G?m[n][l]=u[n][l-F]:m[n][l]={value:r.dataArray[P*(n-G)+l-F]};for(r.info.topHeaderRowsNumber=G,r.info.SUMMARY_SHOWN=!1,r.info.leftHeaderColumnsNumber=F,this.SUMMARY_SHOWN=!1,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!1,g=0;g<r.info.leftHeaderColumnsNumber;g++)r.columnProps.unshift({});for(g=0;g<r.info.topHeaderRowsNumber;g++)r.rowProps.unshift({});var s=function(N,f){var E=a.controller.getPivotProperty(["rowTotalAgg"])||"sum",d=a.controller.getPivotProperty(["columnTotalAgg"])||"sum",O=f?"rowProps":"columnProps";if(!r[O][N]&&!(f?d:E))return a.TOTAL_FUNCTIONS.totalSUM;switch((r[O][N]||{}).summary||(f?d:E)){case"count":return a.TOTAL_FUNCTIONS.totalSUM;case"avg":return a.TOTAL_FUNCTIONS.totalAVG;case"min":return a.TOTAL_FUNCTIONS.totalMIN;case"max":return a.TOTAL_FUNCTIONS.totalMAX;case"pct":return a.TOTAL_FUNCTIONS.totalPERCENTAGE;case"none":return a.TOTAL_FUNCTIONS.totalNONE;default:return a.TOTAL_FUNCTIONS.totalSUM}};if(this.controller.CONFIG.showSummary&&m.length-r.info.topHeaderRowsNumber>1&&(m[m.length-1][0]||{}).isCaption){r.info.SUMMARY_SHOWN=!0,this.SUMMARY_SHOWN=!0,this._dataStack[this._dataStack.length-1].SUMMARY_SHOWN=!0,i=[],l=m.length-2;for(var g in m[l])m[l][g].isCaption?(i[g]={group:p,isCaption:!0,source:{},noDrillDown:!0,value:pivotLocale.get(0)},b(i[g],!1)):i[g]={value:s(parseInt(g)).call(this.TOTAL_FUNCTIONS,m,G,m.length,g,r.info.leftHeaderColumnsNumber),style:t};p++,c?(m.splice(r.info.topHeaderRowsNumber,0,i),r.info.topHeaderRowsNumber++):m.push(i)}if(this.controller.getPivotProperty(["columnTotals"])&&m.length-r.info.topHeaderRowsNumber>1&&r.info.leftHeaderColumnsNumber>0){var S=++p,w;for(w=0;w<r.info.topHeaderRowsNumber;w++)m[w].push({group:S,isCaption:!0,value:pivotLocale.get(0)});for(w=r.info.topHeaderRowsNumber;w<m.length;w++)m[w].push({isCaption:!0,value:s(w,!0).call(this.TOTAL_FUNCTIONS,m,r.info.leftHeaderColumnsNumber,m[w].length,void 0,r.info.leftHeaderColumnsNumber,w),style:t})}return m=z(m),r.rawData=r._rawDataOrigin=m,r.rawData},DataController.prototype._trigger=function(){this.dataChangeTrigger&&this.dataChangeTrigger()},DataController.prototype.sortByColumn=function(t){var r=this._dataStack[this._dataStack.length-1].data,i=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,n;this.SORT_STATE.column!==t&&(a=this.SORT_STATE.order=0);var l=r._rawDataOrigin.slice(r.info.topHeaderRowsNumber,r._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!i?1:0)),o=r.info.leftHeaderColumnsNumber+t,a=this.SORT_STATE.order===-1?1:this.SORT_STATE.order===1?0:-1;this.SORT_STATE.order=a,this.SORT_STATE.column=t;for(var u in r.rawData[r.info.topHeaderRowsNumber-i-1])r.rawData[r.info.topHeaderRowsNumber-i-1][u].className&&delete r.rawData[r.info.topHeaderRowsNumber-i-1][u].className;if(a===0){r.rawData=r._rawDataOrigin,this.modifyRawData(r),this._trigger();return}a=-a,typeof(n=((r.columnProps[t]||{}).$FORMAT||{}).comparator)=="function"?l.sort(function(h,p){return n(p[o].value)>n(h[o].value)?a:n(p[o].value)<n(h[o].value)?-a:0}):l.sort(function(h,p){return p[o].value>h[o].value?a:p[o].value<h[o].value?-a:0}),r.rawData=r._rawDataOrigin.slice(0,r.info.topHeaderRowsNumber).concat(l).concat(this.SUMMARY_SHOWN&&!i?[r._rawDataOrigin[r._rawDataOrigin.length-1]]:[]),r.rawData[r.info.topHeaderRowsNumber-i-1][r.info.leftHeaderColumnsNumber+t].className=a===0?"":a===1?"lpt-sortDesc":"lpt-sortAsc",this.modifyRawData(r),this._trigger()},DataController.prototype.filterByValue=function(t,r){var i=this._dataStack[this._dataStack.length-1].data,n=this.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,l=i._rawDataOrigin.slice(i.info.topHeaderRowsNumber,i._rawDataOrigin.length-(this.SUMMARY_SHOWN&&!n?1:0)),o=null;try{o=new RegExp(t,"i")}catch{try{o=new RegExp(t.replace(/([()[{*+.$^\\|?])/g,"\\$1"),"i")}catch{return}}l=l.filter(function(a){return(a[r].value||"").toString().match(o)}),i.rawData=i._rawDataOrigin.slice(0,i.info.topHeaderRowsNumber).concat(l).concat(this.SUMMARY_SHOWN&&!n?[i._rawDataOrigin[i._rawDataOrigin.length-1]]:[]),this.modifyRawData(i),this._trigger()},DataController.prototype.modifyRawData=function(t){var r=-1;this.controller.CONFIG.showRowNumbers&&!t.info.leftHeaderColumnsNumber&&(t.rawData[0]&&t.rawData[0][0].special?t.rawData.forEach(function(n){n[0].value=++r===0?"#":r,n[0].isCaption=r===0}):(t.rawData.forEach(function(n){n.unshift({value:++r===0?"#":r,isCaption:r===0,special:!0,noClick:!0})}),t.columnProps instanceof Array&&t.columnProps.unshift({}),t.info.colCount++));var i=t.info.topHeaderRowsNumber-1;for(r=t.info.leftHeaderColumnsNumber;r<t.rawData[i].length;r++)t.rawData[i][r].style="min-width:"+(this.controller.getPivotProperty(["cellWidth"])||100)+"px;"+(t.rawData[i][r].style?t.rawData[i][r].style:"")};var DataSource=function(t,r,i,n){this.SOURCE_URL=t.MDX2JSONSource||location.host+":"+location.port+"/"+(location.pathname.split("/")||[])[1],this.NAMESPACE=t.namespace,this.USERNAME=t.username,this.PASSWORD=t.password,this.LPT=i,this.GLOBAL_CONFIG=r,this.SEND_COOKIES=t.sendCookies||!1,this.DRILL_LEVEL=typeof n!="number"?1:n,this.BASIC_MDX=t.basicMDX,this.DATA_SOURCE_PIVOT=t.pivot||"",this.FILTERS=[]};DataSource.prototype._post=function(url,data,callback){var xhr=new XMLHttpRequest,self=this;xhr.open("POST",url),this.SEND_COOKIES&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){var handler;xhr.readyState===4&&(handler=self.LPT.CONFIG.triggers.responseHandler,typeof handler=="function"&&handler.call(self.LPT,{url,status:xhr.status,xhr})),xhr.readyState===4&&xhr.status===200?callback(function(){try{return JSON.parse(xhr.responseText)||{}}catch(e){try{var temp=null;return eval("temp="+xhr.responseText),temp}catch(t){return{error:"<h1>Unable to parse server response</h1><p>"+xhr.responseText+"</p>"}}}}()):xhr.readyState===4&&xhr.status!==200&&callback({error:xhr.responseText||pivotLocale.get(3)+"<br/>"+xhr.status+": "+xhr.statusText})},this.USERNAME&&this.PASSWORD&&xhr.setRequestHeader("Authorization","Basic "+btoa(this.USERNAME+":"+this.PASSWORD)),xhr.send(JSON.stringify(data))},DataSource.prototype._convert=function(t){var r;if(typeof t!="object"||t.error)return{error:t.error||!0};try{return r={dimensions:[t.Cols[0].tuples,t.Cols[1]?t.Cols[1].tuples:[{caption:""}]],dataArray:t.Data,info:t.Info},r}catch(i){return console.error("Error while parsing data:",i),{error:t.error||!0}}},DataSource.prototype.setFilter=function(t){this.FILTERS.push(t)},DataSource.prototype.clearFilters=function(){this.FILTERS=[]},DataSource.prototype.getCurrentData=function(t){for(var r=this,i=this._convert,n=this.BASIC_MDX,l=new MDXParser,o=l.mdxType(n),a={state:0,data:{},pivotData:{}},u=0;u<this.FILTERS.length;u++)n=l.applyFilter(n,this.FILTERS[u]);typeof this.GLOBAL_CONFIG.rowCount=="number"&&(n=l.applyRowCount(n,this.GLOBAL_CONFIG.rowCount));var h=function(){var y=a.pivotData;r.GLOBAL_CONFIG.pivotProperties=a.pivotData,y.rowAxisOptions&&(y.rowAxisOptions.drilldownSpec&&(r.GLOBAL_CONFIG.DrillDownExpression=r.GLOBAL_CONFIG.DrillDownExpression||y.rowAxisOptions.drilldownSpec.split("^")),(y.rowAxisOptions.levelFormat||y.columnAxisOptions&&y.columnAxisOptions.levelFormat)&&(r.GLOBAL_CONFIG.formatNumbers=r.GLOBAL_CONFIG.formatNumbers||y.columnAxisOptions.levelFormat||y.rowAxisOptions.levelFormat))},p=function(){var y=a.data;if(o==="drillthrough")t(function(_){var x=_.children||[],b=[],A,U,z;if(!x.length)return{error:pivotLocale.get(4)};for(U in x[0])b.push({caption:U});A={Cols:[{tuples:b},{tuples:[]}],Data:[],Info:{colCount:8,cubeClass:"No cube class",cubeName:"No cube name",leftHeaderColumnsNumber:0,rowCount:x.length,topHeaderRowsNumber:b.length,mdxType:o}};for(U in x)for(z in x[U])A.Data.push(x[U][z]);return i(A)}(y));else if(o==="mdx"){if(!y||!y.Data||!y.Data.length||!y.Cols||!y.Data.length&&!((y.Cols[0]||{}).tuples||[]).length&&!((y.Cols[1]||{}).tuples||[]).length)return t({error:pivotLocale.get(4)});t(r._convert(y))}else t({error:"Unrecognised MDX type: "+n||!0})},m=function(){r.LPT.CONFIG.logs&&console.log("LPT MDX request:",n);var y=function(_){r.LPT.pivotView.removeMessage(),a.data=_,a.state++,p()};if(r.DRILL_LEVEL===0&&r.LPT.CONFIG.initialData){y(r.LPT.CONFIG.initialData);return}r._post(r.SOURCE_URL+"/"+(o==="drillthrough"?"MDXDrillthrough":"MDX")+(r.NAMESPACE?"?Namespace="+r.NAMESPACE:""),{MDX:n},y)};r.LPT.pivotView.displayLoading(),this.DATA_SOURCE_PIVOT?this._post(this.SOURCE_URL+"/DataSource"+(r.NAMESPACE?"?Namespace="+r.NAMESPACE:""),{DataSource:this.DATA_SOURCE_PIVOT},function(y){a.pivotData=y,a.state++,h(),m()}):(r.GLOBAL_CONFIG.pivotProperties={},m())};var ExcelExport=function(){};ExcelExport.prototype.exportTableHTML=function(){var t="data:application/vnd.ms-excel;base64,",r='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',i=function(l){return window.btoa(unescape(encodeURIComponent(l)))},n=function(l,o){return l.replace(/{(\w+)}/g,function(a,u){return o[u]})};return function(l,o){var a={worksheet:o||"Worksheet",table:l};console.log(t+i(n(r,a))),window.location.href=t+i(n(r,a))}}(),ExcelExport.prototype.exportXLS=function(){var t=document.getElementsByClassName("lpt")[0],r=t.getElementsByClassName("lpt-tableBlock")[0].getElementsByTagName("table")[0].innerHTML,i=t.getElementsByClassName("lpt-topHeader")[0].getElementsByTagName("table")[0].innerHTML.replace(/<tr>/,"<tr><th colspan='2'></th>"),n=t.getElementsByClassName("lpt-leftHeader")[0].getElementsByTagName("thead")[0].innerHTML,l=n.match("<tr>(.*)</tr>")[1].split("</tr><tr>"),o=0;r=r.replace(/<tr>/g,function(){return"<tr>"+l[o++]}),console.log(i+r),this.exportTableHTML(i+r,"test")};var LightPivotTable=function(t){var r=this;typeof t!="object"&&(t={}),this.normalizeConfiguration(t),this._dataSourcesStack=[],this.DRILL_LEVEL=-1,this.CONFIG=t,this.VERSION="".concat("1.8.14")||"[NotBuilt]",this.CONTROLS={},this.mdxParser=new MDXParser,this.pivotView=new PivotView(this,t.container),this.dataSource=this.pushDataSource(t.dataSource),this.dataController=new DataController(this,function(){r.dataIsChanged.call(r)}),this.init()};LightPivotTable.prototype.refresh=function(){var t=this,r;if(!this.dataSource.BASIC_MDX){console.log("Unable to refresh: no basic MDX set.");return}if(this.clearFilters(),this.CONFIG.defaultFilterSpecs instanceof Array)for(r in this.CONFIG.defaultFilterSpecs)this.setFilter(this.CONFIG.defaultFilterSpecs[r]);this.dataSource.getCurrentData(function(i){t.dataController.isValidData(i)?t.dataController.setData(i):t.pivotView.displayMessage(i.error||pivotLocale.get(2))})},LightPivotTable.prototype.changeBasicMDX=function(t){for(var r=this._dataSourcesStack.length-1;r>0;r--)this.popDataSource(),this.pivotView.popTable(),this.dataController.popData();this.CONFIG.dataSource.basicMDX=t,this.dataSource.BASIC_MDX=t,this.refresh()},LightPivotTable.prototype.setRowCount=function(t){this.CONFIG.rowCount=t},LightPivotTable.prototype.getActualMDX=function(){var t=this.dataSource.BASIC_MDX,r=new MDXParser,i=this.dataSource.FILTERS;for(var n in i)t=r.applyFilter(t,i[n]);return typeof this.CONFIG.rowCount=="number"&&(t=r.applyRowCount(t,this.CONFIG.rowCount)),t},LightPivotTable.prototype.isListing=function(){return(this.dataController.getData().info||{}).leftHeaderColumnsNumber===0},LightPivotTable.prototype.getSelectedRows=function(){var t=[],r=this.pivotView.selectedRows,i;for(i in r)r[i]&&t.push(+i);return t},LightPivotTable.prototype.getRowsValues=function(t){if(typeof t>"u")return[];if(t instanceof Array||(t=[t]),t.length===0)return[];for(var r=this.dataController.getData(),i=[],n=0;n<t.length;n++)i.push(r.rawData[t[n]-1+(r.info.topHeaderRowsNumber||1)]);return i},LightPivotTable.prototype.getModel=function(){return this.dataController.getData()},LightPivotTable.prototype.updateSizes=function(){this.pivotView.updateSizes()},LightPivotTable.prototype.setFilter=function(t){this.dataSource.setFilter(t)},LightPivotTable.prototype.clearFilters=function(){this.dataSource.clearFilters()},LightPivotTable.prototype.pushDataSource=function(t){var r;return this.DRILL_LEVEL++,this._dataSourcesStack.push(r=new DataSource(t||{},this.CONFIG,this,this.DRILL_LEVEL)),this.dataSource=r,r},LightPivotTable.prototype.popDataSource=function(t){this._dataSourcesStack.length<2||(this.DRILL_LEVEL--,this._dataSourcesStack.pop(),t||this.dataController.popData(),this.dataSource=this._dataSourcesStack[this._dataSourcesStack.length-1])},LightPivotTable.prototype.dataIsChanged=function(){this.pivotView.dataChanged(this.dataController.getData())},LightPivotTable.prototype.tryDrillDown=function(t){var r=this,i,n={};for(var l in r.CONFIG.dataSource)n[l]=r.CONFIG.dataSource[l];this.CONFIG.DrillDownExpression&&!(this.CONFIG.DrillDownExpression instanceof Array)&&(this.CONFIG.DrillDownExpression=[this.CONFIG.DrillDownExpression]),(this.CONFIG.DrillDownExpression||[])[this.DRILL_LEVEL]?n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,t,this.CONFIG.DrillDownExpression[this.DRILL_LEVEL])||this.dataSource.BASIC_MDX:n.basicMDX=this.mdxParser.drillDown(this.dataSource.BASIC_MDX,t)||this.dataSource.BASIC_MDX,i=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=i.FILTERS,this.dataSource.getCurrentData(function(o){r.dataController.isValidData(o)&&o.dataArray.length>0&&o.dimensions[1]&&o.dimensions[1][0]&&(o.dimensions[1][0].caption||o.dimensions[1][0].dimension||o.dimensions[1][0].path)?(r.pivotView.pushTable(),r.dataController.pushData(),r.dataController.setData(o),typeof r.CONFIG.triggers.drillDown=="function"&&r.CONFIG.triggers.drillDown.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX,path:o.dimensions[1][0].path||""})):r.popDataSource(!0)})},LightPivotTable.prototype.tryDrillThrough=function(t){var r=this,i,n={};for(var l in r.CONFIG.dataSource)n[l]=r.CONFIG.dataSource[l];const o=this.CONFIG.controls?.find(a=>a.action==="showListing")?.targetProperty;n.basicMDX=this.mdxParser.drillThrough(this.dataSource.BASIC_MDX,t,o)||this.dataSource.basicMDX,i=this.dataSource,this.pushDataSource(n),this.dataSource.FILTERS=i.FILTERS,this.dataSource.getCurrentData(function(a){r.dataController.isValidData(a)&&a.dataArray.length>0?(r.pivotView.pushTable({disableConditionalFormatting:!0}),r.dataController.pushData(),r.dataController.setData(a),typeof r.CONFIG.triggers.drillThrough=="function"&&r.CONFIG.triggers.drillThrough.call(r,{level:r.DRILL_LEVEL,mdx:n.basicMDX})):r.popDataSource(!0)})},LightPivotTable.prototype.getPivotProperty=function(t){if(this.CONFIG.pivotProperties){t instanceof Array||(t=[]);var r=this.CONFIG.pivotProperties;for(t=t.reverse();t.length&&typeof r<"u";)r=r[t.pop()];return r}},LightPivotTable.prototype.attachTrigger=function(t,r){if(typeof r!="function"){console.warn("LPT.addTrigger: pass the trigger as a second argument.");return}this.CONFIG.triggers[t]=r},LightPivotTable.prototype.normalizeConfiguration=function(t){typeof t.columnResizing>"u"&&(t.columnResizing=!0),typeof t.pagination>"u"&&(t.pagination=200),typeof t.enableSearch>"u"&&(t.enableSearch=!0),typeof t.stretchColumns>"u"&&(t.stretchColumns=!0),typeof t.enableListingSelect>"u"&&(t.enableListingSelect=!0),typeof t.showListingRowsNumber>"u"&&(t.showListingRowsNumber=!0),t.triggers||(t.triggers={}),t.dataSource||(t.dataSource={})},LightPivotTable.prototype.init=function(){var t=this;this.CONTROLS.drillThrough=function(){t.pivotView._drillThroughClickHandler.call(t.pivotView)},this.CONTROLS.customDrillThrough=function(r){if(!(r instanceof Array)){console.error('Parameter "filters" must be array of strings.');return}t.tryDrillThrough.call(t,r)},this.CONTROLS.back=function(){t.pivotView._backClickHandler.call(t.pivotView)},this.CONFIG.locale&&pivotLocale.setLocale(this.CONFIG.locale),this.refresh()};var MDXParser=function(){};MDXParser.prototype._warnMDX=function(t,r){console.warn(`MDX is not parsed:

%s

`+(r?"("+r+")":""),t)},MDXParser.prototype.makeSetExpressionFromFilter=function(t){return t.match(/^\([^\),]*,[^\)]*\)$/)?"NONEMPTYCROSSJOIN"+t.slice(0,t.length-1)+".children)":t+".children"},MDXParser.prototype.prependNonEmpty=function(t){return t.match(/^\s*non\s+empty/i)?t:"NON EMPTY "+t},MDXParser.prototype.applyRowCount=function(t,r){return t.replace(/\s*on\s*0\s*,\s*(?:non\s*empty\s*)?(.*)\s*on\s*1/i,function(i,n){return typeof r<"u"?" ON 0, NON EMPTY HEAD("+n+", "+r+") ON 1":i})},MDXParser.prototype.drillDown=function(t,r,i){if(!r)return/]\s+ON\s+1/i.test(t)?t=t.replace(/]\s+ON\s+1/i,"].children ON 1"):(this._warnMDX(t,"no filter specified"),"");var n=t.split(/(select\s*)(.*?)(\s*from)/ig);if(n.length<4)return this._warnMDX(t),"";var l=n[n.length-3],o=l.split(/(\s*ON\s*[01]\s*,?\s*)/i);if(o.length<2)return this._warnMDX(t,"DrillDown is impossible"),"";var a=-1;if(o.map(function(m,y){return m.match(/\s*ON\s*[01]\s*,?\s*/i)&&(a=y-1),m}),a===-1)return this._warnMDX(t,"DrillDown is impossible"),"";let u="";const h=o[a].match(/ORDER\((.*?)\,/);h&&h[0]&&(u=h[0]),u?o[a]=(i||o[a]).replace(u,"ORDER("+this.makeSetExpressionFromFilter(r)+","):o[a]=this.prependNonEmpty(i||this.makeSetExpressionFromFilter(r));for(var p in o)o[p].length===1&&o[p](parseInt(p),1);return n[n.length-3]=o.join(""),this.applyFilter(n.join(""),r)},MDXParser.prototype.drillThrough=function(t,r,i){var n=t.slice(t.lastIndexOf("FROM ")),l="DRILLTHROUGH SELECT "+n;for(var o in r)l=this.applyFilter(l,r[o]);return i&&(l+=` %LISTING [${i}]`),l},MDXParser.prototype.mdxType=function(t){var r=t.toLowerCase(),i=r.indexOf("drillthrough"),n=r.indexOf("select");return i>-1?"drillthrough":n>-1?"mdx":"unknown"},MDXParser.prototype.applyFilter=function(t,r){return t+(r?" %FILTER "+r:"")};/*!
 * numeral.js
 * version : 1.5.3
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */var numeral=function(){var t,r="1.5.3",i={},n="en",l=null,o="0,0",a=3,u=",",h=".",p=new RegExp("(\\d)(?=(\\d{"+a+"})+(?!\\d))","g");function m(c){this._value=c}function y(c,s,g,S){var w=Math.pow(10,s),N,f;return f=(g(c*w)/w).toFixed(s),S&&(N=new RegExp("0{1,"+S+"}$"),f=f.replace(N,"")),f}function _(c,s,g){var S;return s.indexOf("$")>-1?S=b(c,s,g):s.indexOf("%")>-1?S=A(c,s,g):s.indexOf(":")>-1?S=U(c,s):S=P(c._value,s,g),S}function x(c,s){var g=s,S,w,N,f,E=["KB","MB","GB","TB","PB","EB","ZB","YB"],d=!1,O;if(s.indexOf(":")>-1)c._value=z(s);else if(s===l)c._value=0;else{for(i[n].delimiters.decimal!=="."&&(s=s.replace(/\./g,"").replace(i[n].delimiters.decimal,".")),S=new RegExp("[^a-zA-Z]"+i[n].abbreviations.thousand+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),w=new RegExp("[^a-zA-Z]"+i[n].abbreviations.million+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),N=new RegExp("[^a-zA-Z]"+i[n].abbreviations.billion+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),f=new RegExp("[^a-zA-Z]"+i[n].abbreviations.trillion+"(?:\\)|(\\"+i[n].currency.symbol+")?(?:\\))?)?$"),O=0;O<=E.length&&(d=s.indexOf(E[O])>-1?Math.pow(1024,O+1):!1,!d);O++);c._value=(d||1)*(g.match(S)?Math.pow(10,3):1)*(g.match(w)?Math.pow(10,6):1)*(g.match(N)?Math.pow(10,9):1)*(g.match(f)?Math.pow(10,12):1)*(s.indexOf("%")>-1?.01:1)*((s.split("-").length+Math.min(s.split("(").length-1,s.split(")").length-1))%2?1:-1)*Number(s.replace(/[^0-9\.]+/g,"")),c._value=d?Math.ceil(c._value):c._value}return c._value}function b(c,s,g){var S=s.indexOf("$"),w=s.indexOf("("),N=s.indexOf("-"),f="",E,d;return s.indexOf(" $")>-1?(f=" ",s=s.replace(" $","")):s.indexOf("$ ")>-1?(f=" ",s=s.replace("$ ","")):s=s.replace("$",""),d=P(c._value,s,g),S<=1?d.indexOf("(")>-1||d.indexOf("-")>-1?(d=d.split(""),E=1,(S<w||S<N)&&(E=0),d.splice(E,0,i[n].currency.symbol+f),d=d.join("")):d=i[n].currency.symbol+f+d:d.indexOf(")")>-1?(d=d.split(""),d.splice(-1,0,f+i[n].currency.symbol),d=d.join("")):d=d+f+i[n].currency.symbol,d}function A(c,s,g){var S="",w,N=c._value*100;return s.indexOf(" %")>-1?(S=" ",s=s.replace(" %","")):s=s.replace("%",""),w=P(N,s,g),w.indexOf(")")>-1?(w=w.split(""),w.splice(-1,0,S+"%"),w=w.join("")):w=w+S+"%",w}function U(c){var s=Math.floor(c._value/60/60),g=Math.floor((c._value-s*60*60)/60),S=Math.round(c._value-s*60*60-g*60);return s+":"+(g<10?"0"+g:g)+":"+(S<10?"0"+S:S)}function z(c){var s=c.split(":"),g=0;return s.length===3?(g=g+Number(s[0])*60*60,g=g+Number(s[1])*60,g=g+Number(s[2])):s.length===2&&(g=g+Number(s[0])*60,g=g+Number(s[1])),Number(g)}function P(c,s,g){var S=!1,w=!1,N=!1,f="",E=!1,d=!1,O=!1,V=!1,$=!1,B="",k="",M=Math.abs(c),j=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],Z,I,v,C,Y,ce,T="",re=!1;if(c===0&&l!==null)return l;if(s.indexOf("(")>-1?(S=!0,s=s.slice(1,-1)):s.indexOf("+")>-1&&(w=!0,s=s.replace(/\+/g,"")),s.indexOf("a")>-1&&(E=s.indexOf("aK")>=0,d=s.indexOf("aM")>=0,O=s.indexOf("aB")>=0,V=s.indexOf("aT")>=0,$=E||d||O||V,s.indexOf(" a")>-1?(f=" ",s=s.replace(" a","")):s=s.replace("a",""),M>=Math.pow(10,12)&&!$||V?(f=f+i[n].abbreviations.trillion,c=c/Math.pow(10,12)):M<Math.pow(10,12)&&M>=Math.pow(10,9)&&!$||O?(f=f+i[n].abbreviations.billion,c=c/Math.pow(10,9)):M<Math.pow(10,9)&&M>=Math.pow(10,6)&&!$||d?(f=f+i[n].abbreviations.million,c=c/Math.pow(10,6)):(M<Math.pow(10,6)&&M>=Math.pow(10,3)&&!$||E)&&(f=f+i[n].abbreviations.thousand,c=c/Math.pow(10,3))),s.indexOf("b")>-1){for(s.indexOf(" b")>-1?(B=" ",s=s.replace(" b","")):s=s.replace("b",""),v=0;v<=j.length;v++)if(Z=Math.pow(1024,v),I=Math.pow(1024,v+1),c>=Z&&c<I){B=B+j[v],Z>0&&(c=c/Z);break}}return s.indexOf("o")>-1&&(s.indexOf(" o")>-1?(k=" ",s=s.replace(" o","")):s=s.replace("o",""),k=k+i[n].ordinal(c)),s.indexOf("[.]")>-1&&(N=!0,s=s.replace("[.]",".")),C=c.toString().split(".")[0],Y=s.split(".")[1],ce=s.indexOf(","),Y?(Y.indexOf("[")>-1?(Y=Y.replace("]",""),Y=Y.split("["),T=y(c,Y[0].length+Y[1].length,g,Y[1].length)):T=y(c,Y.length,g),C=T.split(".")[0],T.split(".")[1].length?T=(h||i[n].delimiters.decimal)+T.split(".")[1]:T="",N&&Number(T.slice(1))===0&&(T="")):C=y(c,null,g),C.indexOf("-")>-1&&(C=C.slice(1),re=!0),ce>-1&&(C=C.toString().replace(p,"$1"+(u||i[n].delimiters.thousands))),s.indexOf(".")===0&&(C=""),(S&&re?"(":"")+(!S&&re?"-":"")+(!re&&w?"+":"")+C+T+(k||"")+(f||"")+(B||"")+(S&&re?")":"")}t=function(c){return t.isNumeral(c)?c=c.value():c===0||typeof c>"u"?c=0:Number(c)||(c=t.fn.unformat(c)),new m(Number(c))},t.version=r,t.isNumeral=function(c){return c instanceof m},t.language=function(c,s){if(!c)return n;if(c&&!s){if(!i[c])throw new Error("Unknown language : "+c);n=c}return(s||!i[c])&&W(c,s),t},t.languageData=function(c){if(!c)return i[n];if(!i[c])throw new Error("Unknown language : "+c);return i[c]},t.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(c){var s=c%10;return~~(c%100/10)===1?"th":s===1?"st":s===2?"nd":s===3?"rd":"th"},currency:{symbol:"$"}}),t.zeroFormat=function(c){l=typeof c=="string"?c:null},t.defaultFormat=function(c){o=typeof c=="string"?c:"0.0"};function W(c,s){i[c]=s}typeof Array.prototype.reduce!="function"&&(Array.prototype.reduce=function(c,s){"use strict";if(this===null||typeof this>"u")throw new TypeError("Array.prototype.reduce called on null or undefined");if(typeof c!="function")throw new TypeError(c+" is not a function");var g,S,w=this.length>>>0,N=!1;for(1<arguments.length&&(S=s,N=!0),g=0;w>g;++g)this.hasOwnProperty(g)&&(N?S=c(S,this[g],g,this):(S=this[g],N=!0));if(!N)throw new TypeError("Reduce of empty array with no initial value");return S});function G(c){var s=c.toString().split(".");return s.length<2?1:Math.pow(10,s[1].length)}function F(){var c=Array.prototype.slice.call(arguments);return c.reduce(function(s,g){var S=G(s),w=G(g);return S>w?S:w},-1/0)}t.setup=function(c,s,g){c!==h&&(h=c),s!==u&&(u=s),g!==a&&(a=g,p=new RegExp("(\\d)(?=(\\d{"+a+"})+(?!\\d))","g"))},t.fn=m.prototype={clone:function(){return t(this)},format:function(c,s){return _(this,c||o,s!==void 0?s:Math.round)},unformat:function(c){return Object.prototype.toString.call(c)==="[object Number]"?c:x(this,c||o)},value:function(){return this._value},valueOf:function(){return this._value},set:function(c){return this._value=Number(c),this},add:function(c){var s=F.call(null,this._value,c);function g(S,w,N,f){return S+s*w}return this._value=[this._value,c].reduce(g,0)/s,this},subtract:function(c){var s=F.call(null,this._value,c);function g(S,w,N,f){return S-s*w}return this._value=[c].reduce(g,this._value*s)/s,this},multiply:function(c){function s(g,S,w,N){var f=F(g,S);return g*f*(S*f)/(f*f)}return this._value=[this._value,c].reduce(s,1),this},divide:function(c){function s(g,S,w,N){var f=F(g,S);return g*f/(S*f)}return this._value=[this._value,c].reduce(s),this},difference:function(c){return Math.abs(t(this._value).subtract(c).value())}},this.numeral=t},PivotLocale=function(t){this.LOCALE="",this.DEFAULT_LOCALE="en",this.setLocale(t||(navigator.language||"").substr(0,2)||(navigator.browserLanguage||this.DEFAULT_LOCALE).substring(0,2))};PivotLocale.prototype.LOCALES=[{ru:"\u0412\u0441\u0435\u0433\u043E",en:"Total",de:"Summe",cs:"Celkem"},{ru:"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043E\u0431\u0440\u0430\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435",en:"Unable to render data",de:"Daten k\xF6nnen nicht rendern",cs:"Nebylo mo\u017En\xE9 zobrazit data"},{ru:"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F.",en:"Invalid data to display.",de:"Nicht korrekt Informationen angezeigt werden soll.",cs:"Nevhodn\xE1 data k zobrazen\xED"},{ru:"\u0412\u043E\u0437\u043D\u0438\u043A\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.",en:"Error while trying to retrieve data from server.",de:"Beim Abrufen der Daten vom Server ist ein Fehler aufgetreten.",cs:"Chyba p\u0159i pokusu o z\xEDsk\xE1n\xED dat ze serveru"},{ru:"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F.",en:"No data to display.",de:"Keine Daten zum anzeigen.",cs:"\u017D\xE1dn\xE1 data k zobrazen\xED"}],PivotLocale.prototype.setLocale=function(t){var r,i=[];if(t=t.toLowerCase(),this.LOCALES[0].hasOwnProperty(t))this.LOCALE=t;else{for(r in this.LOCALES[0])i.push(r);console.warn("LightPivot: locale "+t+" is not supported. Currently localized: "+i.join(", ")+"."),this.LOCALE="en"}},PivotLocale.prototype.get=function(t){return(this.LOCALES[t]||{})[this.LOCALE]||"{not localized: "+t+"}"};var pivotLocale=new PivotLocale,PivotView=function(t,r){if(!(r instanceof HTMLElement))throw new Error('Please, provide HTMLElement instance "container" into pivot table configuration.');this.tablesStack=[],this.selectedRows={},numeral.call(this),this.elements={container:r,base:document.createElement("div"),tableContainer:void 0,messageElement:void 0,searchSelect:void 0,searchInput:void 0},this.pagination=null,this.savedScroll={x:0,y:0},this.FIXED_COLUMN_SIZES=[],this.PAGINATION_BLOCK_HEIGHT=20,this.ANIMATION_TIMEOUT=500,this.SEARCH_ENABLED=!1,this.SEARCHBOX_LEFT_MARGIN=191,this.savedSearch={restore:!1,value:"",columnIndex:0},this.controller=t,this.SCROLLBAR_WIDTH=function(){var i=document.createElement("div");i.style.visibility="hidden",i.style.width="100px",i.style.msOverflowStyle="scrollbar",document.body.appendChild(i);var n=i.offsetWidth;i.style.overflow="scroll";var l=document.createElement("div");l.style.width="100%",i.appendChild(l);var o=l.offsetWidth;return i.parentNode.removeChild(i),n-o}(),this.init()};return PivotView.prototype.init=function(){var t=this,r=this.elements;r.base.className="lpt",r.base.setAttribute("LPTVersion",this.controller.VERSION),r.container.appendChild(r.base),this.pushTable(),this.displayLoading(),window.addEventListener("resize",function(){t.updateSizes.call(t)}),this._=function(){t.displayMessage('<a href="https://github.com/ZitRos/LightPivotTable">LIGHT PIVOT TABLE v'+t.controller.VERSION+'</a><br/>by <a href="https://plus.google.com/+NikitaSavchenko">Nikita Savchenko</a><br/>for dear users of products of <a href="http://www.intersystems.com/">InterSystems Corporation</a><br/>Hope you enjoy it!',!0)}},PivotView.prototype.getCellElement=function(t,r,i){var n=this.tablesStack[this.tablesStack.length-1].element,l,o,a,u,h=function(p,m,y){var _=[],x,b,A,U,z,P,W;for(W=0;W<p.rows.length;W++)for(x=p.rows[W],P=0;P<x.cells.length;P++){for(b=x.cells[P],A=P;_[W]&&_[W][A];++A);for(U=A;U<A+b.colSpan;++U)for(z=W;z<W+b.rowSpan;++z)_[z]||(_[z]=[]),_[z][U]=!0;if(A<=m&&m<A+b.colSpan&&W<=y&&y<W+b.rowSpan)return b}return null};if(i){if(l=n.getElementsByClassName("lpt-topHeader")[0],!l||(l=l.getElementsByTagName("table")[0],!l)||(o=0,[].slice.call(l.rows).forEach(function(p){o+=p.rowSpan||1}),u=n.getElementsByClassName("lpt-leftHeader")[0],!l)||(u=u.getElementsByTagName("table")[0],!l))return null;if(a=0,(this.getCurrentTableData().element||{})._listing||[].slice.call((u.rows[0]||{cells:[]}).cells).forEach(function(p){a+=p.colSpan||1}),t<a&&r<o)return n.getElementsByClassName("lpt-headerValue")[0]||null;if(t>=a&&r<o)return(h(l,t-a,r)||{childNodes:[null]}).childNodes[0];if(t<a&&r>=o)return(h(u,t,r-o)||{childNodes:[null]}).childNodes[0];t-=a,r-=o}return l=n.getElementsByClassName("lpt-tableBlock")[0],!l||(l=l.getElementsByTagName("table")[0],!l)?null:((l.rows[r]||{cells:[]}).cells[t]||{childNodes:[null]}).childNodes[0]},PivotView.prototype.getTableSize=function(t){var r,i=0,n=0,l=this.tablesStack[this.tablesStack.length-1].element;return r=l.getElementsByClassName("lpt-tableBlock")[0],!r||(r=r.getElementsByTagName("table")[0],!r)?0:([].slice.call(r.rows).forEach(function(o){n+=o.rowSpan||1}),[].slice.call((r.rows[0]||{cells:[]}).cells).forEach(function(o){i+=o.colSpan||1}),t?(r=l.getElementsByClassName("lpt-topHeader")[0],!r||(r=r.getElementsByTagName("table")[0],!r)||([].slice.call(r.rows).forEach(function(o){n+=o.rowSpan||1}),r=l.getElementsByClassName("lpt-leftHeader")[0],!r)||(r=r.getElementsByTagName("table")[0],!r)?0:((this.getCurrentTableData().element||{})._listing||[].slice.call((r.rows[0]||{cells:[]}).cells).forEach(function(o){i+=o.colSpan||1}),{width:i,height:n})):{width:i,height:n})},PivotView.prototype.displayLoading=function(){this.displayMessage(this.controller.CONFIG.loadingMessageHTML||'<div class="lpt-spinner"><div></div><div></div><div></div><div></div><div></div></div>')},PivotView.prototype.updateSizes=function(){for(var t in this.tablesStack)this.recalculateSizes(this.tablesStack[t].element)},PivotView.prototype._updateTablesPosition=function(t){for(var r=0;r<this.tablesStack.length;r++)this.tablesStack[r].element.style.left=(1+(t||0)+r-this.tablesStack.length)*100+"%"},PivotView.prototype.getCurrentTableData=function(){return this.tablesStack[this.tablesStack.length-1]},PivotView.prototype.pushTable=function(t){var r=this,i,n=document.createElement("div");n.className="tableContainer",this.tablesStack.length&&(this.tablesStack[this.tablesStack.length-1].FIXED_COLUMN_SIZES=this.FIXED_COLUMN_SIZES,this.tablesStack[this.tablesStack.length-1].savedSearch=this.savedSearch,this.tablesStack[this.tablesStack.length-1].selectedRows=this.selectedRows,this.savedSearch={restore:!1,value:"",columnIndex:0},n.style.left="100%"),this.tablesStack.push({element:n,opts:t||{},pagination:i={on:!1,rows:1/0,page:0,pages:0}}),this.FIXED_COLUMN_SIZES=[],this.selectedRows={},this.elements.base.appendChild(n),this.elements.tableContainer=n,this.pagination=i,setTimeout(function(){r._updateTablesPosition()},30)},PivotView.prototype.popTable=function(){var t;if(!(this.tablesStack.length<2)){this.FIXED_COLUMN_SIZES=[],this._updateTablesPosition(1);var r=this.tablesStack.pop();this.pagination=(t=this.tablesStack[this.tablesStack.length-1]).pagination,t.FIXED_COLUMN_SIZES&&(this.FIXED_COLUMN_SIZES=t.FIXED_COLUMN_SIZES),t.savedSearch&&(this.savedSearch=t.savedSearch),t.selectedRows&&(this.selectedRows=t.selectedRows),setTimeout(function(){r.element.parentNode.removeChild(r.element)},this.ANIMATION_TIMEOUT),this.elements.tableContainer=this.tablesStack[this.tablesStack.length-1].element}},PivotView.prototype.saveScrollPosition=function(){var t;this.elements.tableContainer&&(t=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(this.savedScroll.x=t[0].scrollLeft,this.savedScroll.y=t[0].scrollTop)},PivotView.prototype.restoreScrollPosition=function(){var t;this.elements.tableContainer&&(t=this.elements.tableContainer.getElementsByClassName("lpt-tableBlock"))&&(t[0].scrollLeft=this.savedScroll.x,t[0].scrollTop=this.savedScroll.y)},PivotView.prototype.dataChanged=function(t){var r=t.rawData.length-t.info.topHeaderRowsNumber;this.controller.CONFIG.pagination&&(this.pagination.on=!0),this.pagination.rows=this.controller.CONFIG.pagination||1/0,this.selectedRows={},this.pagination.page=0,this.pagination.pages=Math.ceil(r/this.pagination.rows),this.pagination.pages<2&&(this.pagination.on=!1),this.renderRawData(t)},PivotView.prototype._columnClickHandler=function(t){this.saveScrollPosition(),this.controller.dataController.sortByColumn(t),this.restoreScrollPosition()},PivotView.prototype._rowClickHandler=function(t,r){var i=!0;if(typeof this.controller.CONFIG.triggers.rowClick=="function"){var n=this.controller.getRowsValues([t])[0].slice(this.controller.dataController.getData().info.leftHeaderColumnsNumber);i=this.controller.CONFIG.triggers.rowClick(t,n,r)}i!==!1&&this.controller.tryDrillDown(r.source.path)},PivotView.prototype._pageSwitcherHandler=function(t){this.pagination.page=t,this.saveScrollPosition(),this.renderRawData(this.controller.dataController.getData()),this.restoreScrollPosition()},PivotView.prototype._backClickHandler=function(t){t&&(t.cancelBubble=!0,t.stopPropagation()),this.removeMessage(),this.popTable(),this.controller.popDataSource(),typeof this.controller.CONFIG.triggers.back=="function"&&this.controller.CONFIG.triggers.back.call(this.controller,{level:this.controller.DRILL_LEVEL})},PivotView.prototype._drillThroughClickHandler=function(t){this.controller.tryDrillThrough(),t&&(t.cancelBubble=!0,t.stopPropagation())},PivotView.prototype._getSelectedText=function(){var t="";return typeof window.getSelection<"u"?t=window.getSelection().toString():typeof document.selection<"u"&&document.selection.type=="Text"&&(t=document.selection.createRange().text),t},PivotView.prototype._cellClickHandler=function(t,r,i,n,l){var o=this.controller.dataController.getData(),a=[],u,h,p=!0,m,y=this.controller.CONFIG.showSummary&&this.controller.CONFIG.attachTotals?1:0;if(!this._getSelectedText()&&!(typeof this.controller.CONFIG.triggers.cellSelected=="function"&&(m=this.controller.CONFIG.triggers.cellSelected.call(this.controller,{x:r-o.info.leftHeaderColumnsNumber,y:i-o.info.topHeaderRowsNumber,leftHeaderColumnsNumber:o.info.leftHeaderColumnsNumber,topHeaderRowsNumber:o.info.topHeaderRowsNumber}),m===!1))){try{u=o.rawData[i][o.info.leftHeaderColumnsNumber-1].source.path,h=o.rawData[o.info.topHeaderRowsNumber-1-y][r].source.path}catch{this.controller.CONFIG.logs&&console.warn("Unable to get filters for cell (%d, %d)",r,i)}u&&a.push(u),h&&a.push(h),this.controller.CONFIG.drillDownTarget?window.location=location.origin+location.pathname+"?DASHBOARD="+encodeURIComponent(this.controller.CONFIG.drillDownTarget)+"&SETTINGS=FILTER:"+encodeURIComponent(a.join("~"))+";":(typeof this.controller.CONFIG.triggers.cellDrillThrough=="function"&&(p=this.controller.CONFIG.triggers.cellDrillThrough({event:n,filters:a,cellData:t,x:r,y:i},o)),typeof l=="function"&&(p=!(l({event:n,filters:a,cellData:t,x:r,y:i},o)===!1||p===!1)),p!==!1&&this.controller.tryDrillThrough(a))}},PivotView.prototype.copyToClipboard=function(t){var r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",t),document.body.appendChild(r),r.select();var i=!1;try{i=document.execCommand("copy")}catch(n){console.log("Copy error: "+n)}return document.body.removeChild(r),i},PivotView.prototype.listingClickHandler=function(t,r){if(r.info.leftHeaderColumnsNumber!==0){console.warn("Listing handler called not for a listing!");return}var i=this.controller.CONFIG.triggerEvent||"click",n=this,l=function(b){return document.createElement(b)},o=l("div"),a=r.rawData[0].map(function(b){return b.value+(b.source&&b.source.title?"("+b.source.title+")":"")}),u=r.rawData[t.y].map(function(b){return b.value});o.className="lpt-hoverMessage",o.style.fontSize="12pt",o.style.opacity=0;for(var h,p,m,y,_,x=0;x<a.length;x++)h=l("div"),_=l("span"),p=l("div"),m=l("hr"),y=l("div"),y.className="lpt-icon-copy",y.title="Copy",y.style.marginRight="6px",_.className="lpt-messageHead",_.textContent=a[x],p.className="lpt-messageBody",h.style.marginBottom=".3em",u[x]!==""?p.textContent=u[x]:p.innerHTML="&nbsp;",h.appendChild(y),h.appendChild(_),o.appendChild(h),o.appendChild(p),o.appendChild(m),y.addEventListener(i,function(b){return function(A){n.copyToClipboard(b)===!1&&alert("Your browser does not support dynamic content copying."),A.preventDefault(),A.cancelBubble=!0,A.preventBubble=!0}}(u[x]));return this.elements.base.appendChild(o),setTimeout(function(){o&&(o.style.opacity=1)},1),o.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){n._getSelectedText()||n.removeMessage()}),!1},PivotView.prototype.displayMessage=function(t,r){this.removeMessage();var i=this,n=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div");n.className="central lpt-hoverMessage",n.style.opacity=0,o.innerHTML=t,l.appendChild(o),n.appendChild(l),this.elements.base.appendChild(n),setTimeout(function(){n&&(n.style.opacity=1)},1),r&&n.addEventListener(this.controller.CONFIG.triggerEvent||"click",function(){i.removeMessage()})},PivotView.prototype.removeMessage=function(){var t,r;if((t=this.elements.base.getElementsByClassName("lpt-hoverMessage")).length)for(r in t)t[r].parentNode&&t[r].parentNode.removeChild(t[r])},PivotView.prototype._matchCondition=function(t,r,i){var n=parseFloat(t);switch(r){case"=":return n==i;case"<>":return n!=i;case">":return n>i;case">=":return n>=i;case"<":return n<i;case"<=":return n<=i;case"IN":return i.toString().indexOf(n)!==-1;case"BETWEEN":return n>=i.split(",")[0]&&n<=i.split(",")[1];case"IS NULL":return!n;default:return console.error('Formatting error: unknown format operator "'+r+'"'),!1}},PivotView.prototype.applyConditionalFormatting=function(t,r,i,n){var l=t[""]||[],o,a,u,h,p,m;l=l.concat(t[r]||[]),(p=r.split(",")).length===2&&(l=l.concat(t[p[0]]||[],t[p[0]+","]||[],t[","+p[1]]||[]));for(o in l)if(u=l[o],!!this._matchCondition(i,u.operator,u.value)){if(u.style&&n.setAttribute("style",(n.getAttribute("style")||"")+u.style),u.icon){for(n.textContent="",h='<div style="overflow: hidden; height: 16px;">',m=parseInt(u.iconCount)||1,a=0;a<m;a++)h+='<img alt="*" style="padding-right:2px; height: 100%;" src="'+u.icon+'"/>';n.innerHTML=h+"</div>"}u.text&&(n.textContent=u.text)}},PivotView.prototype.colorNameToRGB=function(t){var r=function(i,n,l){return{r:i,g:n,b:l}};switch(t){case"red":return r(255,0,0);case"green":return r(0,255,0);case"blue":return r(0,0,255);case"purple":return r(102,0,153);case"salmon":return r(255,140,105);case"white":return r(255,255,255);case"black":return r(0,0,0);case"gray":return r(128,128,128);default:return r(255,255,255)}},PivotView.prototype.selectRow=function(t,r){if(t?this.selectedRows[r]=1:delete this.selectedRows[r],typeof this.controller.CONFIG.triggers.rowSelect=="function"){var i=this.controller.getSelectedRows();this.controller.CONFIG.triggers.rowSelect(i,this.controller.getRowsValues(i))}},PivotView.prototype.recalculateSizes=function(t){var r=t.parentNode,i=22;try{var n=this,l=this.controller.CONFIG.triggerEvent||"click",o=t.getElementsByClassName("lpt-headerValue")[0];if(!o)return;var a=t.getElementsByClassName("lpt-header")[0],u=t.getElementsByClassName("lpt-topHeader")[0],h=t.getElementsByTagName("table")[0],p=h.offsetWidth,m=u.getElementsByTagName("thead")[0],y=t.getElementsByClassName("lpt-leftHeader")[0],_=y.getElementsByTagName("thead")[0],x=t.getElementsByClassName("lpt-tableBlock")[0],b=x.getElementsByTagName("table")[0],A=x.getElementsByTagName("tbody")[0],U=t.getElementsByClassName("lpt-searchInput")[0],z=U?t.offsetWidth-this.SEARCHBOX_LEFT_MARGIN:0,P=x.getElementsByTagName("tr")[0],W=t.getElementsByClassName("lpt-pageSwitcher")[0];m.childNodes[0]&&m.childNodes[0].lastChild._extraCell&&m.childNodes[0].removeChild(m.childNodes[0].lastChild),_.lastChild&&_.lastChild._extraTr&&_.removeChild(_.lastChild);var G=(W?this.PAGINATION_BLOCK_HEIGHT:0)+(this.SEARCH_ENABLED?this.PAGINATION_BLOCK_HEIGHT:0),F=Math.max(y.offsetWidth,a.offsetWidth),c=u.offsetHeight;u.style.marginLeft=F+"px";var s=t.offsetHeight,g=s-c-G,S=a.offsetWidth,w=_.offsetHeight===0,N=Math.max(_.offsetHeight,A.offsetHeight)>g&&this.SCROLLBAR_WIDTH>0,f=m.offsetWidth>u.offsetWidth-(N?this.SCROLLBAR_WIDTH:0);!N&&f&&(N=Math.max(_.offsetHeight,A.offsetHeight)>g-this.SCROLLBAR_WIDTH&&this.SCROLLBAR_WIDTH>0);var E=N&&!w,d,O,V=[],$=[],B=[],k,M=!1,j=function(){!n.controller.CONFIG.stretchColumns&&N&&!f||(M=!0,O=document.createElement("th"),O.className="lpt-extraCell",O.style.minWidth=n.SCROLLBAR_WIDTH+"px",O.style.width=n.SCROLLBAR_WIDTH+"px",O.rowSpan=m.childNodes.length,O._extraCell=!0,m.childNodes[0].appendChild(O))};if(N&&m.childNodes[0]&&j(),t._primaryColumns)for(k in t._primaryColumns)V.push(t._primaryColumns[k].offsetWidth);else console.warn("No _primaryColumns property in container, cell sizes won't be fixed.");if(t._primaryRows&&t._primaryCells){for(k in t._primaryRows)$.push(t._primaryRows[k].offsetHeight);for(k in t._primaryCells)B.push(t._primaryCells[k].offsetHeight)}else console.warn("No _primaryRows property in container, cell sizes won't be fixed.");var Z=[].slice.call(y.getElementsByTagName("th")).map(function(I){return{el:I.getElementsByTagName("div")[0],height:I.getElementsByTagName("div")[0].offsetHeight}});if(t.parentNode.removeChild(t),u.style.marginLeft=F+"px",x.style.marginLeft=F+"px",y.style.height=s-c-G+"px",y.style.width=F+"px",S>F&&(y.style.width=S+"px"),x.style.height=s-c-G-1+"px",a.style.height=c+"px",a.style.width=F+"px",this.controller.CONFIG.stretchColumns||(h.style.width="auto",b.style.width=f?"100%":p+"px"),E&&(O=document.createElement("tr"),O.appendChild(d=document.createElement("th")),_.appendChild(O),d.__i=0,d.addEventListener(l,function(){d.__i++,d.style.background="#"+Math.max(18-d.__i*3,0).toString(16)+"FF7D7",d.__i>5&&n._()}),O._extraTr=!0,d.colSpan=_.childNodes.length,d.style.height=(this.SCROLLBAR_WIDTH?this.SCROLLBAR_WIDTH+1:0)+"px"),U&&(U.style.width=z+"px"),P)for(k in P.childNodes)P.childNodes[k].tagName==="TD"&&(P.childNodes[k].style.width=V[k]+"px");t._primaryRows.forEach(function(I,v){t._primaryCells[v].style.height=t._primaryRows[v].style.height=Math.max($[v]||$[v-1]||i,B[v]||B[v-1]||i)+"px"}),Z.forEach(function(I){I.el.style.height=parseInt(I.height)+"px"}),r.appendChild(t),Math.max(_.offsetHeight,A.offsetHeight)>g&&this.SCROLLBAR_WIDTH>0&&!M&&j()}catch(I){console.error("Error when fixing sizes.","ERROR:",I)}},PivotView.prototype.getUnixDateFromCacheFormat=function(t){function r(m,y){var _=new Date(m);return _.setDate(m.getDate()+y),_}function i(m){var y=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],_=Date.parse(m);if(!isNaN(_))return _;if(m.split("-").length==2){var x=m.split("-"),b=y.indexOf(x[0].toLowerCase());if(b!=-1)return Date.parse((b+1).toString()+"/01/"+x[1])}else if(m.split(" ").length==2){var A=m.split(" ")[1].split(":").length;if(A===0&&(m+=":00"),_=Date.parse(m.replace(/-/g,"/")),!isNaN(_))return _}return 0}if(t===""&&t===void 0||t===null)return null;var n=t.toString();if(n.length==4||n.indexOf("-")!=-1||n.indexOf(" ")!=-1)return i(t);if(n.length==6){var l=n.substr(0,4),o=n.substr(4,2);return Date.parse(new Date(parseInt(l),parseInt(o)-1,1))}if(n.length==5&&!isNaN(parseInt(n))){var a=new Date(1840,11,31),u=n.toString().split(","),h=parseInt(u[0]),p=null;return u.length>1&&(p=parseInt(u[1])),a=r(a,parseInt(h)),p&&a.setSeconds(p),Date.parse(a)}else return i(t)},PivotView.prototype.renderRawData=function(t){if(!t.rawData||!t.rawData[0]||!t.rawData[0][0]){this.displayMessage("<h1>"+pivotLocale.get(1)+"</h1><p>"+JSON.stringify(t)+"</p>");return}var r=this,i=t.rawData,n=t.info,l=t.columnProps,o=t.rowProps,a=t.conditionalFormatting?t.conditionalFormatting.colorScale:void 0,u=this.controller.CONFIG.triggerEvent||"click",h=n.SUMMARY_SHOWN&&this.controller.CONFIG.attachTotals?1:0,p=!!this.controller.CONFIG.columnResizing,m=n.leftHeaderColumnsNumber===0,y=m&&this.controller.CONFIG.enableSearch,_=this.controller.CONFIG.enableListingSelect,x=!!this.controller.CONFIG.columnResizeAnimation,b=this.elements.tableContainer,A=document.createElement("div"),U=document.createElement("div"),z=document.createElement("div"),P=document.createElement("div"),W=document.createElement("div"),G=document.createElement("div"),F=document.createElement("div"),c=document.createElement("table"),s=document.createElement("thead"),g=document.createElement("table"),S=document.createElement("thead"),w=document.createElement("table"),N=document.createElement("tbody"),f=this.pagination.on||m&&this.controller.CONFIG.showListingRowsNumber,E=f?document.createElement("div"):null,d=f?[]:null,O=E?document.createElement("div"):null,V=y?document.createElement("div"):null,$=y?document.createElement("span"):null,B=y?document.createElement("select"):null,k=y?document.createElement("span"):null,M=y?document.createElement("input"):null,j=y?function(){for(var L=[],D=n.leftHeaderColumnsNumber,X=n.topHeaderRowsNumber-1-h,R=D;R<i[X].length;R++)L.push({value:i[X][R].value,source:i[X][R].source,columnIndex:R});return L}():null,Z={},I,v,C,Y=null,ce,T,re=[],ue=[],pe=[],oe,ne,he,fe,de;this.SEARCH_ENABLED=y,this.numeral.setup(n.decimalSeparator||".",n.numericGroupSeparator||",",n.numericGroupSize||3);var me=function(L,D,X){if(typeof L=="string")L[L.length-1]==="%"&&!isNaN(parseFloat(L))||(D.parentNode.className+=" formatLeft"),D.innerHTML=(L||"").replace(/(https?|ftp):\/\/[^\s]+/ig,function(Q){return"<a href='"+Q+"' target='"+(r.controller.CONFIG.linksTarget||"_blank")+"' onclick='var e=event||window.event;e.stopPropagation();e.cancelBubble=true;'>"+Q+"</a>"});else if(m)D.textContent=L;else if(X==="%date%"){var R=new Date(r.getUnixDateFromCacheFormat(L));if(isNaN(R.getTime())){D.textContent=L;return}D.textContent=R.getHours()+R.getMinutes()+R.getSeconds()===0?R.toLocaleDateString():R.toLocaleString()}else X?D.textContent=L&&r.numeral(L).format(X):L?D.textContent=r.numeral(L).format(L%1===0?"#,###":"#,###.##"):D.textContent=L},Ce=function(L,D){var X;L.createTextRange?(X=L.createTextRange(),X.move("character",D),X.select()):L.setSelectionRange(D,D)},ye=function(L,D){var X=0,R=0,J=function(K){K.cancelBubble=!0,K.preventDefault(),L.style.width=L.style.minWidth=X-R+K.pageX+"px",x&&(r.saveScrollPosition(),r.recalculateSizes(b),r.restoreScrollPosition())},Q=function(K){K.cancelBubble=!0,K.preventDefault(),L.style.width=L.style.minWidth=(r.FIXED_COLUMN_SIZES[D]=X-R+K.pageX)+"px",r.saveScrollPosition(),r.recalculateSizes(b),r.restoreScrollPosition(),document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",Q)};L.addEventListener("mousedown",function(K){(K.target||K.srcElement)===L&&(K.cancelBubble=!0,K.preventDefault(),X=L.offsetWidth,R=K.pageX,document.addEventListener("mousemove",J),document.addEventListener("mouseup",Q))})};for(this.removeMessage();b.firstChild;)b.removeChild(b.firstChild);var ge=function(L,D,X,R,J){var Q=J===S,K,ae,ee,H,le,ie;function ve(q){for(var te=q.checked;q=q.parentNode;)if(q.tagName==="TR"){q.classList[te?"add":"remove"]("lpt-selectedRow"),r.elements.tableContainer.querySelector(".lpt-tableBlock table").rows[q.rowIndex].classList[te?"add":"remove"]("lpt-selectedRow");break}}if(L===D&&_){for(C=X;C<R;C++)ee=document.createElement("tr"),H=document.createElement("td"),ie=document.createElement("input"),ie.setAttribute("type","checkbox"),ie.checked=!!r.selectedRows[C],ie.checked&&function(q){setTimeout(function(){ve(q)},1)}(ie),H.setAttribute("style","padding: 0 !important;"),ie.addEventListener("click",function(q){return function(te){var se=te.srcElement||te.target;te.preventDefault(),te.cancelBubble=!0,setTimeout(function(){se.checked=!se.checked,r.selectRow.call(r,se.checked,q),ve(se)},1)}}(C)),H.appendChild(ie),ee.appendChild(H),ue.push(H),J.appendChild(ee);return}for(C=X;C<R;C++){for(v=L;v<D;v++)ae=!0,(K=Z.hasOwnProperty(i[C][v].group))&&(v>0&&i[C][v-1].group===i[C][v].group&&(ae=!1,Z[i[C][v].group].element.colSpan=v-Z[i[C][v].group].x+1),C>0&&i[C-1][v].group===i[C][v].group&&(ae=!1,Z[i[C][v].group].element.rowSpan=C-Z[i[C][v].group].y+1),H=Z[i[C][v].group].element),(!K||ae)&&(ee||(ee=document.createElement("tr")),ee.appendChild(H=document.createElement(i[C][v].isCaption?"th":"td")),i[C][v].source&&i[C][v].source.title&&H.setAttribute("title",i[C][v].source.title),le=document.createElement("div"),i[C][v].value?le.textContent=i[C][v].value:le.innerHTML="&nbsp;",H.appendChild(le),i[C][v].style&&H.setAttribute("style",i[C][v].style),n.leftHeaderColumnsNumber===0&&r.controller.CONFIG.listingColumnMinWidth&&(H.style.minWidth=r.controller.CONFIG.listingColumnMinWidth+"px"),n.leftHeaderColumnsNumber>0&&r.controller.CONFIG.maxHeaderWidth&&(H.style.maxWidth=r.controller.CONFIG.maxHeaderWidth+"px",H.style.whiteSpace="normal",H.style.wordWrap="normal"),i[C][v].className&&(H.className=i[C][v].className),i[C][v].group&&(Z[i[C][v].group]={x:v,y:C,element:H}),i[C][v].isCaption||me(i[C][v].value,H,o[C].format||l[v].format)),Q&&v===D-1&&(ue.push(H),H.addEventListener(u,function(q,te){return function(){r._rowClickHandler.call(r,q,te)}}(C,i[C][v]))),!Q&&C===R-1-h&&!H._hasSortingListener&&(H._hasSortingListener=!1,i[C][v].noClick||H.addEventListener(u,function(q){return function(){r._columnClickHandler.call(r,q)}}(v-n.leftHeaderColumnsNumber)),H.className=(H.className||"")+" lpt-clickable"),!Q&&C===R-1&&(r.FIXED_COLUMN_SIZES[v]&&(H.style.minWidth=H.style.width=r.FIXED_COLUMN_SIZES[v]+"px"),p&&(ye(H,v),H.className+=" lpt-resizableColumn"),re.push(H));ee&&J.appendChild(ee),ee=null}};for(W.textContent="",i[0][0].style&&!m&&W.setAttribute("style",i[0][0].style),this.tablesStack.length>1&&!this.controller.CONFIG.hideButtons&&(W.className+="back ",W.addEventListener(u,function(L){r._backClickHandler.call(r,L)})),n.leftHeaderColumnsNumber>0&&r.controller.CONFIG.maxHeaderWidth&&(z.style.maxWidth=r.controller.CONFIG.maxHeaderWidth*n.leftHeaderColumnsNumber+"px",z.style.whiteSpace="normal",z.style.wordWrap="normal"),(this.controller.CONFIG.hideButtons||this.tablesStack.length<2)&&n.leftHeaderColumnsNumber===0&&(W.style.display="none"),ge(n.leftHeaderColumnsNumber,i[0].length,0,n.topHeaderRowsNumber,s),ge(0,n.leftHeaderColumnsNumber,he=n.topHeaderRowsNumber+(this.pagination.page*this.pagination.rows||0),fe=this.pagination.on?Math.min(he+this.pagination.rows,i.length):i.length,S),C=he;C<fe;C++){for(Y=document.createElement("tr"),v=n.leftHeaderColumnsNumber;v<i[0].length;v++)ne=this.controller.getPivotProperty(["cellStyle"])||"",Y.appendChild(T=document.createElement("td")),T.appendChild(de=document.createElement("div")),v===n.leftHeaderColumnsNumber&&pe.push(T),me(i[C][v].value,de,o[C]&&o[C].format||l[v].format),a&&!(n.SUMMARY_SHOWN&&i.length-1===C)&&(oe=(parseFloat(i[C][v].value)-a.min)/a.diff,ne+="background:rgb("+ +Math.round((a.to.r-a.from.r)*oe+a.from.r)+","+Math.round((a.to.g-a.from.g)*oe+a.from.g)+","+Math.round((a.to.b-a.from.b)*oe+a.from.b)+");"+(a.invert?"color: white;":"")),(l[v].style||o[C]&&o[C].style)&&(ne+=(o[C]&&o[C].style||"")+(o[C]&&o[C].style?" ":"")+(l[v].style||"")),i[C][v].style&&(ne+=i[C][v].style),this.controller.CONFIG.conditionalFormattingOn&&!(n.SUMMARY_SHOWN&&i.length-1===C)&&!this.getCurrentTableData().opts.disableConditionalFormatting&&this.applyConditionalFormatting(t.conditionalFormatting,C-n.topHeaderRowsNumber+1+","+(v-n.leftHeaderColumnsNumber+1),i[C][v].value,T),ne&&T.setAttribute("style",(T.getAttribute("style")||"")+ne),T.addEventListener(u,function(L,D,X){return function(R){r._cellClickHandler.call(r,X,L,D,R,n.drillThroughHandler)}}(v,C,i[C][v]));N.appendChild(Y)}if(F.addEventListener("scroll",function(){if(F._ISE){F._ISE=!1;return}P.scrollLeft=F.scrollLeft,G.scrollTop=F.scrollTop,P._ISE=!0,G._ISE=!0}),G.className="lpt-leftHeader",P.className="lpt-topHeader",this.controller.CONFIG.enableHeadersScrolling&&(G.className=G.className+" lpt-scrollable-y",P.className=P.className+" lpt-scrollable-x",G.addEventListener("scroll",function(){if(G._ISE){G._ISE=!1;return}F.scrollTop=G.scrollTop,F._ISE=!0}),P.addEventListener("scroll",function(){if(P._ISE){P._ISE=!1;return}F.scrollLeft=P.scrollLeft,F._ISE=!0})),F.className="lpt-tableBlock",z.className="lpt-header",A.className="lpt-topSection",U.className="lpt-bottomSection",W.className+="lpt-headerValue",w.appendChild(N),F.appendChild(w),g.appendChild(S),G.appendChild(g),c.appendChild(s),P.appendChild(c),z.appendChild(W),A.appendChild(z),A.appendChild(P),U.appendChild(G),U.appendChild(F),b.appendChild(A),b.appendChild(U),this.controller.CONFIG.stretchColumns||(c.style.width="auto"),E){E.className="lpt-pageSwitcher",d=function(D,X){for(var R=0,J=[D];D>1;)D=Math.max(1,D-(R||1)),J.unshift(D),R=R*R+1;for(R=0,D=J[J.length-1];D<X;)D=Math.min(X,D+(R||1)),J.push(D),R=R*R+1;return J}(this.pagination.page+1,this.pagination.pages),this.controller.CONFIG.showListingRowsNumber&&(T=document.createElement("div"),Y=document.createElement("span"),Y.className="lpt-icon-rows",T.className="lpt-bottomInfo",T.appendChild(Y),Y=document.createElement("span"),Y.textContent=t.rawData.length-(t.info.topHeaderRowsNumber||0)-(t.info.SUMMARY_SHOWN?1:0),T.appendChild(Y),O.appendChild(T));for(I in d)I=parseInt(I),T=document.createElement("span"),d[I]===this.pagination.page+1&&(T.className="lpt-active"),T.textContent=d[I],function(L){T.addEventListener(u,function(){r._pageSwitcherHandler.call(r,L-1)})}(d[I]),O.appendChild(T),d[I+1]&&d[I]+1!==d[I+1]&&(T=document.createElement("span"),T.className="lpt-pageSpacer",O.appendChild(T));E.appendChild(O),b.appendChild(E)}if(y){$.className="lpt-searchIcon",k.className="lpt-searchSelectOuter",V.className="lpt-searchBlock",M.className="lpt-searchInput",B.className="lpt-searchSelect";for(I in j)T=document.createElement("option"),T.setAttribute("value",j[I].columnIndex.toString()),T.textContent=j[I].value,B.appendChild(T);M.addEventListener("input",function(){var L=parseInt(B.options[B.selectedIndex].value),D=M.value;r.saveScrollPosition(),r.savedSearch.value=D,r.savedSearch.columnIndex=L,r.savedSearch.restore=!0,r.controller.dataController.filterByValue(D,L),r.restoreScrollPosition()}),V.appendChild($),k.appendChild(B),V.appendChild(k),V.appendChild(M),b.insertBefore(V,A),this.elements.searchInput=M,this.elements.searchSelect=B,this.savedSearch.restore&&(this.elements.searchInput.value=this.savedSearch.value,this.elements.searchSelect.value=this.savedSearch.columnIndex)}else this.elements.searchInput=void 0,this.elements.searchSelect=void 0;b._primaryColumns=re,b._primaryRows=ue,b._primaryCells=pe,b._listing=m,this.recalculateSizes(b),this.savedSearch.restore&&(this.elements.searchInput.focus(),Ce(this.elements.searchInput,this.savedSearch.value.length)),typeof this.controller.CONFIG.triggers.contentRendered=="function"&&this.controller.CONFIG.triggers.contentRendered(this.controller)},LightPivotTable}();
