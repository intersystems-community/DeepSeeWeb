import{H as K,f as H,x as J}from"./chunk-JIOS6KUH.js";import{$a as o,Ba as $,Bb as x,Bc as B,Cb as w,Da as M,Db as h,Eb as d,F as A,Fb as T,Ib as R,Jb as f,Nb as m,Ob as l,Tb as D,Ub as E,Vb as S,Wb as Q,Xb as O,Zb as k,ab as g,cc as V,dc as I,ec as N,fa as F,gb as j,kc as W,pa as z,qa as u,ra as p,rb as b,tb as v,vb as y,xb as P,y as L,yb as _}from"./chunk-ZKAUCJHV.js";import{h as q}from"./chunk-DEPBX7UX.js";var Y=["elements"],ee=i=>({tab:i,edit:null});function te(i,r){if(i&1){let c=f();h(0,"div",4,0),m("click",function(){let t=u(c).$implicit,n=l();return p(n.tabClick(t))}),O(2),d()}if(i&2){let c=r.$implicit,e=l();y("hidden-offscreen",c.hidden)("active",e.currentTab===c),o(2),k(" ",c.text," ")}}function ie(i,r){if(i&1){let c=f();h(0,"div",5),m("click",function(t){u(c);let n=l();return p(n.onOpenTabsClick(t))}),T(1,"img",6),d()}}function ne(i,r){if(i&1){let c=f();h(0,"div",8),m("click",function(){let t=u(c).$implicit,n=l(2);return p(n.tabClick(t))}),O(1),d()}if(i&2){let c=r.$implicit,e=l(2);y("active",e.currentTab===c),v("routerLink","./")("queryParams",e.useQuery?I(5,ee,c.id):void 0),o(),k(" ",c.text," ")}}function re(i,r){if(i&1&&(h(0,"div",3),x(1,ne,2,7,"div",7,P().trackByIdentity,!0),d()),i&2){let c=l();o(),w(c.hiddenTabs)}}var ce=37;var U=(()=>{let r=class r{constructor(e,t,n){this.el=e,this.cd=t,this.zone=n,this.tabs=[],this.useQuery=!1,this.currentTabChange=new M,this.isMoreButtonVisible=!1,this.isOpened=!1,this.trackByIdentity=(a,s)=>s.id,this.zone.runOutsideAngular(()=>{this.subClick=L(window,"click").subscribe(a=>{let s=a.target;for(;s;){if(s.classList.contains("btn-more"))return;if(!s.parentElement)break;s=s.parentElement}this.isOpened=!1}),this.subResize=L(window,"resize").pipe(A(50)).subscribe(a=>{this.recalcTabsVisibility(!0)})})}get hiddenTabs(){return this.tabs.filter(e=>e.hidden)}tabClick(e){this.currentTab=e,this.currentTabChange.emit(this.currentTab)}scrollToTabs(){this.el.nativeElement.scrollIntoView()}ngAfterViewInit(){this.recalcTabsVisibility()}ngOnChanges(e){let t=e.tabs;if(t.previousValue!==t.currentValue||t.previousValue?.length!==t.currentValue?.length){if(this.isArraysEqual(t.previousValue,t.currentValue))return;setTimeout(()=>{this.recalcTabsVisibility()})}}recalcTabsVisibility(e=!1){if(!this.elements)return;let t=this.el.nativeElement.offsetWidth,n=this.elements.toArray().map(s=>s.nativeElement),a=0;this.isMoreButtonVisible=!1,n.forEach((s,C)=>{let Z=C===n.length-1,G=s.getBoundingClientRect();a+=G.width,a>t+8-(Z?0:ce)?(this.tabs[C].hidden=!0,this.isMoreButtonVisible=!0):this.tabs[C].hidden=!1}),e&&this.cd.detectChanges()}ngOnDestroy(){this.subClick&&this.subClick.unsubscribe(),this.subResize&&this.subResize.unsubscribe()}onOpenTabsClick(e){this.isOpened=!this.isOpened}isArraysEqual(e,t){if(!e||!t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}};r.\u0275fac=function(t){return new(t||r)(g($),g(B),g(j))},r.\u0275cmp=F({type:r,selectors:[["dsw-tabs"]],viewQuery:function(t,n){if(t&1&&D(Y,5),t&2){let a;E(a=S())&&(n.elements=a)}},inputs:{tabs:"tabs",currentTab:"currentTab",useQuery:"useQuery"},outputs:{currentTabChange:"currentTabChange"},standalone:!0,features:[z,V],decls:4,vars:2,consts:[["elements",""],[1,"tab",3,"hidden-offscreen","active"],[1,"tab","btn-more"],[1,"dropdown"],[1,"tab",3,"click"],[1,"tab","btn-more",3,"click"],["src","/assets/img/more-horiz.svg"],["queryParamsHandling","merge",3,"active","routerLink","queryParams"],["queryParamsHandling","merge",3,"click","routerLink","queryParams"]],template:function(t,n){t&1&&(x(0,te,3,5,"div",1,n.trackByIdentity,!0),b(2,ie,2,0,"div",2)(3,re,3,0,"div",3)),t&2&&(w(n.tabs),o(2),_(n.isMoreButtonVisible?2:-1),o(),_(n.isOpened?3:-1))},dependencies:[J],styles:['[_ngcontent-%COMP%]:root{--cl-bg: #F5F5F5;--cl-accent: #1A73E8;--cl-btn-hover: #76abf1;--cl-hover: #E8F0FE;--cl-txt: #555555;--input-border-radius: 13px;--cl-btn-main: #5cb85c;--cl-btn-main-txt: #fff;--cl-btn-main-border: #4cae4c;--cl-btn-main-hover: #6eca6e;--cl-btn-secondary: #e6e6e6;--cl-btn-secondary-txt: #cccccc;--cl-btn-secondary-border: #b4b2b2;--cl-btn-secondary-hover: #dbdbdb;--icon-filter: none;--cl1: #b6e6ff;--cl2: #f7bfb7;--cl3: #bceca8;--cl4: #fff9a8;--cl5: #ffc593;--cl6: #f9b1ab;--cl7: #9de7fb;--cl8: #a8b8f9;--cl9: #9df1ae;--cl-header-bg: #FFFFFF;--cl-header-border: #F5F5F5;--cl-header-txt: #606367;--cl-header-ico: var(--cl-header-txt);--cl-header-btn-active: var(--cl-header-bg);--cl-header-btn-hover: var(--cl-bg);--cl-header-btn-hover-darken: var(--cl-hover);--header-height: 64px;--menu-item-icon-filter: none;--cl-sidebar-bg: #F5F5F5;--cl-sidebar-txt: #606367;--tile-border: none;--tile-border-radius: 10px;--tile-header-height: 28px;--cl-modal-bg: white;--fc0: #606367;--fc1: black;--fc2: red;--fc3: white;--fc4: green;--fc5: blue;--cl-widget-bg: white;--cl-widget-header-btn-active: #A9FFA1;--cl-widget-header-border: none;--cl-text-widget-font: #6b6464;--cl-widget-header-bg: var(--cl-header-bg);--cl-widget-header-txt: var(--cl-header-txt);--cl-widget-filter-txt: #606367;--cl-widget-filter-bg: var(--cl-header-bg);--widget-header-btn-opacity: 1;--widget-header-btn-filter: none;--widget-header-btn-active-filter: contrast(.7) sepia(1) brightness(1) hue-rotate(-898deg) contrast(9);--cl-input-bg: white;--cl-input-border: #EBEBEA;--cl-check-border: #606367;--cl-input-placeholder: rgba(96, 99, 103, .6);--cl-input-text: #606367;--cl-input-height: 26px;--cl-pivot-cell-border: rgb(208, 208, 208);--cl-pivot-cell-hover: #FFF7D7;--pivot-row-hover: inset 0 0 30px #fff5b9;--sidebar-width: 322px;--cl-scrollbar: #606367}[_nghost-%COMP%]{position:relative;font-family:Oxygen;font-style:normal;font-weight:400;font-size:16px;line-height:24px;text-transform:uppercase;word-break:break-word;-webkit-user-select:none;user-select:none;color:var(--cl-input-text);text-align:center;display:flex;min-width:0;margin-bottom:10px;width:100%}[_nghost-%COMP%]:after{content:"";display:block;width:100%;height:1px;background-color:var(--cl-input-border);position:absolute;bottom:0}.tab[_ngcontent-%COMP%]{outline:none;cursor:pointer;position:relative;flex-shrink:0;padding-left:8px;padding-right:8px;padding-bottom:2px}.tab[_ngcontent-%COMP%]:first-child{margin-left:-8px}.tab.hidden-offscreen[_ngcontent-%COMP%]{position:absolute;left:-100000px;top:-100000px;visibility:hidden}.tab[_ngcontent-%COMP%]:after{display:none;position:absolute;content:" ";width:calc(100% - 16px);z-index:1;border-radius:4px}.tab.active[_ngcontent-%COMP%]:after{height:4px;background:var(--cl-accent)}.tab.active[_ngcontent-%COMP%]{color:var(--cl-input-text)}.tab.active[_ngcontent-%COMP%]:after{display:block}.tab[_ngcontent-%COMP%]:hover:not(.active){color:var(--cl-input-text)}.tab[_ngcontent-%COMP%]:hover:not(.active):after{display:block;background:var(--cl-input-text)}.btn-more[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding-left:16px;padding-right:16px;margin-left:auto}.btn-more[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:7px;opacity:.4}.dropdown[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 4px);right:0;background-color:#fff;display:flex;flex-direction:column;box-shadow:0 0 10px #0000001f;border-radius:4px;z-index:1;overflow:hidden}.dropdown[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:6px 16px}.dropdown[_ngcontent-%COMP%] > div.active[_ngcontent-%COMP%]{background-color:var(--cl-bg);color:var(--cl-input-text)}'],changeDetection:0});let i=r;return i})();var ae=["table"],oe=i=>({data:i,level:0}),le=(i,r)=>({data:i,level:r});function se(i,r){i&1&&T(0,"img",9)}function de(i,r){if(i&1){let c=f();h(0,"div",8),m("click",function(){let t=u(c).$implicit,n=l().level,a=l();return p(a.selectRow(t,n))}),b(1,se,1,0,"img",9),O(2),d()}if(i&2){let c=r.$implicit,e=l().level,t=l();y("selected",t.selected[e]===c),o(),_(c.children!=null&&c.children.length?1:-1),o(),k(" ",c.name," ")}}function he(i,r){if(i&1&&x(0,de,3,4,"div",7,P().trackByIndex,!0),i&2){let c=r.data;w(c)}}function be(i,r){i&1&&R(0)}function ue(i,r){i&1&&R(0)}function pe(i,r){if(i&1&&(h(0,"div"),b(1,ue,1,0,"ng-container",5),d()),i&2){let c=r.$implicit,e=r.$index;l();let t=Q(3);o(),v("ngTemplateOutlet",t)("ngTemplateOutletContext",N(2,le,c.children,e+1))}}function ge(i,r){i&1&&(h(0,"div",6),T(1,"img",10),d())}var Be=(()=>{let r=class r{constructor(e,t){this.ds=e,this.cd=t,this.select=new M,this.isLoading=!0,this.tabs=[{id:"pivot",text:"Pivot tables"},{id:"kpi",text:"KPI"},{id:"worksheets",text:"Worksheets"},{id:"metrics",text:"Metrics"}],this.currentTab=this.tabs[0],this.data=[],this.filteredData=[],this.selected=[],this.trackByIndex=(n,a)=>n}ngOnInit(){this.requestData(),this.subSearch=this._modal?.search.subscribe(e=>{this.applyFiltering(e)})}selectRow(e,t){if(!e.children){this.select.emit(e),this._modal?.close();return}this.selected[t]=e,this.selected.splice(t+1,this.selected.length-t),this.scrollToLast()}requestData(e){return q(this,null,function*(){e||(e=this.currentTab),this.isLoading=!0,this.ds.requestListOfDataSources(e.id).then(t=>{this.retrieveData(t)}).catch(t=>{console.error(t)}).finally(()=>{this.isLoading=!1,this.cd.detectChanges()})})}ngOnDestroy(){clearTimeout(this.scrollTimeout),this.subSearch?.unsubscribe()}retrieveData(e){this.data=e.children,this.selected=[],this.applyFiltering()}scrollToLast(){clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{let e=this.table.nativeElement,t=this.table.nativeElement.children[0].offsetWidth;e.scroll({left:this.selected.length*t,behavior:"smooth"})},10)}applyFiltering(e=""){if(e=e.toString(),e===""){this.filteredData=this.data,this.cd.detectChanges();return}this.selected=[],this.filteredData=JSON.parse(JSON.stringify(this.data)),this.filterItems(this.filteredData,e.toLowerCase()),this.scrollToLast(),this.cd.detectChanges()}filterItems(e,t){let n=[];return e.forEach(a=>{if(!(a.children?.length&&this.filterItems(a.children,t))&&!a.name.toLowerCase().includes(t)){n.push(a);return}}),n.forEach(a=>{e.splice(e.indexOf(a),1)}),!!e.length}};r.\u0275fac=function(t){return new(t||r)(g(K),g(B))},r.\u0275cmp=F({type:r,selectors:[["dsw-ds-sel-dialog"]],viewQuery:function(t,n){if(t&1&&D(ae,5),t&2){let a;E(a=S())&&(n.table=a.first)}},inputs:{_modal:"_modal"},outputs:{select:"select"},standalone:!0,features:[V],decls:11,vars:8,consts:[["items",""],["table",""],[1,"header"],[3,"currentTabChange","tabs","currentTab","useQuery"],[1,"table"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"dsw-spinner"],[1,"row",3,"selected"],[1,"row",3,"click"],["src","assets/img/widget-icons/folder-1.svg"],["src","assets/img/spinner.svg"]],template:function(t,n){if(t&1){let a=f();h(0,"section",2)(1,"dsw-tabs",3),m("currentTabChange",function(C){return u(a),p(n.requestData(C))}),d()(),b(2,he,2,0,"ng-template",null,0,W),h(4,"section",4,1)(6,"div"),b(7,be,1,0,"ng-container",5),d(),x(8,pe,2,5,"div",null,n.trackByIndex,!0),b(10,ge,2,0,"div",6),d()}if(t&2){let a=Q(3);o(),v("tabs",n.tabs)("currentTab",n.currentTab)("useQuery",!1),o(6),v("ngTemplateOutlet",a)("ngTemplateOutletContext",I(6,oe,n.filteredData)),o(),w(n.selected),o(2),_(n.isLoading?10:-1)}},dependencies:[U,H],styles:['@charset "UTF-8";[_ngcontent-%COMP%]:root{--cl-bg: #F5F5F5;--cl-accent: #1A73E8;--cl-btn-hover: #76abf1;--cl-hover: #E8F0FE;--cl-txt: #555555;--input-border-radius: 13px;--cl-btn-main: #5cb85c;--cl-btn-main-txt: #fff;--cl-btn-main-border: #4cae4c;--cl-btn-main-hover: #6eca6e;--cl-btn-secondary: #e6e6e6;--cl-btn-secondary-txt: #cccccc;--cl-btn-secondary-border: #b4b2b2;--cl-btn-secondary-hover: #dbdbdb;--icon-filter: none;--cl1: #b6e6ff;--cl2: #f7bfb7;--cl3: #bceca8;--cl4: #fff9a8;--cl5: #ffc593;--cl6: #f9b1ab;--cl7: #9de7fb;--cl8: #a8b8f9;--cl9: #9df1ae;--cl-header-bg: #FFFFFF;--cl-header-border: #F5F5F5;--cl-header-txt: #606367;--cl-header-ico: var(--cl-header-txt);--cl-header-btn-active: var(--cl-header-bg);--cl-header-btn-hover: var(--cl-bg);--cl-header-btn-hover-darken: var(--cl-hover);--header-height: 64px;--menu-item-icon-filter: none;--cl-sidebar-bg: #F5F5F5;--cl-sidebar-txt: #606367;--tile-border: none;--tile-border-radius: 10px;--tile-header-height: 28px;--cl-modal-bg: white;--fc0: #606367;--fc1: black;--fc2: red;--fc3: white;--fc4: green;--fc5: blue;--cl-widget-bg: white;--cl-widget-header-btn-active: #A9FFA1;--cl-widget-header-border: none;--cl-text-widget-font: #6b6464;--cl-widget-header-bg: var(--cl-header-bg);--cl-widget-header-txt: var(--cl-header-txt);--cl-widget-filter-txt: #606367;--cl-widget-filter-bg: var(--cl-header-bg);--widget-header-btn-opacity: 1;--widget-header-btn-filter: none;--widget-header-btn-active-filter: contrast(.7) sepia(1) brightness(1) hue-rotate(-898deg) contrast(9);--cl-input-bg: white;--cl-input-border: #EBEBEA;--cl-check-border: #606367;--cl-input-placeholder: rgba(96, 99, 103, .6);--cl-input-text: #606367;--cl-input-height: 26px;--cl-pivot-cell-border: rgb(208, 208, 208);--cl-pivot-cell-hover: #FFF7D7;--pivot-row-hover: inset 0 0 30px #fff5b9;--sidebar-width: 322px;--cl-scrollbar: #606367}[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:hidden}.header[_ngcontent-%COMP%]{flex-shrink:0}.table[_ngcontent-%COMP%]{position:relative;flex:1 1 100%;min-width:800px;min-height:0;display:flex;white-space:nowrap;overflow:hidden}.table[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex-shrink:0;flex-grow:1;flex-basis:25%;border-right:1px solid var(--cl-input-border);overflow:auto;min-width:25%;width:25%}.table[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px;height:4px}.table[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ebebea}.table[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:0;background:#1c1d2066}.table[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{position:sticky;left:0;z-index:2;background:#fff}.row[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;padding:5px 4px;cursor:pointer;align-items:center;color:var(--cl-widget-filter-txt);max-width:25em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;position:relative}.row[_ngcontent-%COMP%]:hover{background-color:var(--cl-hover);color:var(--cl-header-txt)}.row.selected[_ngcontent-%COMP%]{color:var(--cl-accent);background-color:var(--cl-sidebar-bg)}.row[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{height:18px;vertical-align:text-top;margin-right:2px}'],changeDetection:0});let i=r;return i})();export{Be as DataSourceSelectorDialog};
